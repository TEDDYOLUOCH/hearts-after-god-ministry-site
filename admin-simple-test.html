<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Admin Test - Hearts After God Ministry</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <!-- Header -->
  <header class="bg-gradient-to-r from-[#2046B3] to-[#7C3AED] text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <img src="assets/images/WhatsApp Image 2025-07-04 at 17.27.34_37ced412.jpg" alt="Ministry Logo" class="h-10 w-10 rounded-full shadow-lg border-2 border-[#FDBA17]">
          <div>
            <h1 class="text-xl font-bold">Simple Admin Test</h1>
            <p class="text-sm text-gray-200">Hearts After God Ministry</p>
          </div>
        </div>
        <div class="flex items-center gap-4">
          <div class="text-right">
            <p class="text-sm font-medium" id="admin-name">Admin User</p>
            <p class="text-xs text-gray-200">Super Administrator</p>
          </div>
          <button id="logout-btn" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded-lg text-sm transition-colors">
            Logout
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <div class="bg-white rounded-xl shadow-lg p-8">
      <h2 class="text-2xl font-bold text-[#2046B3] mb-6">Admin Dashboard Test</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
          <h3 class="text-lg font-semibold text-blue-800 mb-2">Authentication Status</h3>
          <p class="text-blue-600" id="auth-status">Checking...</p>
        </div>
        
        <div class="bg-green-50 p-6 rounded-lg border border-green-200">
          <h3 class="text-lg font-semibold text-green-800 mb-2">User Info</h3>
          <p class="text-green-600" id="user-info">Loading...</p>
        </div>
        
        <div class="bg-purple-50 p-6 rounded-lg border border-purple-200">
          <h3 class="text-lg font-semibold text-purple-800 mb-2">Backend Status</h3>
          <p class="text-purple-600" id="backend-status">Checking...</p>
        </div>
      </div>
      
      <div class="bg-gray-50 p-6 rounded-lg">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Test Actions</h3>
        <div class="flex gap-4">
          <button id="test-backend" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
            Test Backend
          </button>
          <button id="test-users" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
            List Users
          </button>
          <button id="clear-session" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
            Clear Session
          </button>
        </div>
      </div>
      
      <div class="mt-6 bg-black text-green-400 p-4 rounded text-sm font-mono h-64 overflow-y-auto" id="console-output">
        <!-- Console output will appear here -->
      </div>
    </div>
  </div>

  <script src="assets/js/discipleship-backend.js"></script>
  <script>
    function log(message, type = 'info') {
      const consoleOutput = document.getElementById('console-output');
      const timestamp = new Date().toLocaleTimeString();
      const color = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-yellow-400';
      consoleOutput.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
      console.log(message);
    }
    
    function updateStatus() {
      const authStatus = document.getElementById('auth-status');
      const userInfo = document.getElementById('user-info');
      const backendStatus = document.getElementById('backend-status');
      const adminName = document.getElementById('admin-name');
      
      // Check authentication
      const loggedInUser = localStorage.getItem('discipleship_logged_in_user');
      if (loggedInUser) {
        const user = JSON.parse(loggedInUser);
        authStatus.textContent = '✓ Authenticated';
        authStatus.className = 'text-green-600';
        userInfo.textContent = `${user.name} (${user.role})`;
        adminName.textContent = user.name;
        log(`User authenticated: ${user.name} (${user.role})`, 'success');
      } else {
        authStatus.textContent = '✗ Not Authenticated';
        authStatus.className = 'text-red-600';
        userInfo.textContent = 'No user logged in';
        log('No user logged in', 'error');
      }
      
      // Check backend
      if (window.DiscipleshipBackend) {
        backendStatus.textContent = '✓ Backend Available';
        backendStatus.className = 'text-green-600';
        log('Backend is available', 'success');
      } else {
        backendStatus.textContent = '✗ Backend Not Available';
        backendStatus.className = 'text-red-600';
        log('Backend is not available', 'error');
      }
    }
    
    // Authentication check
    document.addEventListener('DOMContentLoaded', function() {
      log('Page loaded, checking authentication...');
      
      // Check if user is logged in and is admin
      const loggedInUser = localStorage.getItem('discipleship_logged_in_user');
      
      if (!loggedInUser) {
        log('No user logged in, redirecting to login', 'error');
        window.location.href = 'admin-dashboard.html';
        return;
      }
      
      const user = JSON.parse(loggedInUser);
      log(`Logged in user: ${user.name} (${user.role})`, 'info');
      
      if (user.role !== 'admin') {
        log('User is not admin, redirecting to user dashboard', 'error');
        window.location.href = 'admin-dashboard.html';
        return;
      }
      
      log('Admin authentication successful!', 'success');
      updateStatus();
      
      // Test backend button
      document.getElementById('test-backend').addEventListener('click', function() {
        log('Testing backend functionality...');
        if (window.DiscipleshipBackend) {
          const users = window.DiscipleshipBackend.getAllUsers();
          log(`Backend test successful. Found ${users.length} users.`, 'success');
        } else {
          log('Backend not available!', 'error');
        }
      });
      
      // List users button
      document.getElementById('test-users').addEventListener('click', function() {
        log('Listing all users...');
        if (window.DiscipleshipBackend) {
          const users = window.DiscipleshipBackend.getAllUsers();
          users.forEach(user => {
            log(`- ${user.name} (${user.email}) - ${user.role}`, 'info');
          });
        } else {
          log('Backend not available!', 'error');
        }
      });
      
      // Clear session button
      document.getElementById('clear-session').addEventListener('click', function() {
        log('Clearing session...', 'info');
        localStorage.removeItem('discipleship_logged_in_user');
        updateStatus();
        log('Session cleared', 'success');
      });
      
      // Logout button
      document.getElementById('logout-btn').addEventListener('click', function() {
        if (confirm('Are you sure you want to logout?')) {
          log('Logging out...', 'info');
          localStorage.removeItem('discipleship_logged_in_user');
          window.location.href = 'admin-dashboard.html';
        }
      });
    });
  </script>
</body>
</html> 