<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Discipleship Dashboard | Hearts After God Ministry</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Your discipleship journey dashboard: track progress, access resources, connect with mentors, and more.">
</head>
<body class="bg-gradient-to-br from-[#F3E8FF] via-[#FEF3C7] to-white min-h-screen flex flex-col">
  <!-- ===================== -->
  <!-- Header / Navbar      -->
  <!-- ===================== -->
  <header class="w-full flex items-center justify-between px-4 py-3 bg-white shadow-md">
    <div class="flex items-center gap-3">
      <img src="assets/images/WhatsApp Image 2025-07-04 at 17.27.34_37ced412.jpg" alt="Logo" class="h-10 w-10 rounded-full border-2 border-[#FDBA17]">
      <span class="font-extrabold text-[#7C3AED] text-xl">Hearts After God Ministry</span>
    </div>
    <div class="flex items-center gap-4">
      <span class="hidden md:inline text-gray-700 font-medium">Welcome, <span class="font-bold" id="user-name">Disciple</span></span>
      <img src="https://ui-avatars.com/api/?name=Disciple&background=7C3AED&color=fff" alt="User Avatar" class="h-9 w-9 rounded-full border-2 border-[#7C3AED]">
    </div>
  </header>

  <main class="flex-1 w-full max-w-5xl mx-auto px-2 md:px-6 py-6">
    <!-- ===================== -->
    <!-- Welcome & Progress   -->
    <!-- ===================== -->
    <section class="bg-white rounded-2xl shadow-lg p-6 md:p-10 mb-8 flex flex-col md:flex-row items-center gap-8 border-t-4 border-[#7C3AED]">
      <div class="flex-1 text-center md:text-left">
        <h1 class="text-2xl md:text-3xl font-extrabold text-[#7C3AED] mb-2">Welcome, <span id="user-name-hero">Disciple</span>!</h1>
        <p class="text-gray-700 mb-3">Track your discipleship journey, access resources, connect with your mentor, and grow in faith.</p>
        <div class="flex flex-wrap gap-4 justify-center md:justify-start">
          <div class="bg-gradient-to-r from-[#7C3AED] to-[#FDBA17] text-white px-4 py-2 rounded-lg font-bold shadow">Progress: <span id="progress-percent">40%</span></div>
          <div class="bg-gradient-to-r from-[#FDBA17] to-[#7C3AED] text-white px-4 py-2 rounded-lg font-bold shadow">Modules: <span id="modules-completed">4/10</span></div>
          <div class="bg-gradient-to-r from-[#2046B3] to-[#7C3AED] text-white px-4 py-2 rounded-lg font-bold shadow">Next: <span id="next-module">Prayer & Devotion</span></div>
        </div>
      </div>
      <div class="flex flex-col items-center">
        <img src="https://ui-avatars.com/api/?name=Disciple&background=7C3AED&color=fff" alt="User Avatar" class="h-24 w-24 rounded-full border-4 border-[#FDBA17] shadow mb-2">
        <span class="text-[#7C3AED] font-bold">Discipleship Participant</span>
      </div>
    </section>

    <!-- ===================== -->
    <!-- Progress Visualization -->
    <!-- ===================== -->
    <section class="mb-10">
      <h2 class="text-xl font-bold text-[#7C3AED] mb-4">Your Progress</h2>
      <div class="flex flex-col md:flex-row gap-6 items-center">
        <div class="flex-1 flex flex-col items-center">
          <div class="relative w-32 h-32 mb-2">
            <svg class="absolute top-0 left-0 w-full h-full" viewBox="0 0 120 120">
              <circle cx="60" cy="60" r="54" fill="none" stroke="#F3E8FF" stroke-width="12"/>
              <circle cx="60" cy="60" r="54" fill="none" stroke="#7C3AED" stroke-width="12" stroke-dasharray="339.292" stroke-dashoffset="203.575" stroke-linecap="round"/>
            </svg>
            <span class="absolute inset-0 flex items-center justify-center text-3xl font-extrabold text-[#7C3AED]">40%</span>
          </div>
          <span class="text-gray-600">Course Completed</span>
        </div>
        <div class="flex-1 flex flex-col gap-2">
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded-full bg-[#7C3AED]"></span>
            <span class="font-medium text-gray-700">Completed Modules:</span>
            <span class="font-bold text-[#7C3AED]">4/10</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded-full bg-[#FDBA17]"></span>
            <span class="font-medium text-gray-700">Next Module:</span>
            <span class="font-bold text-[#FDBA17]">Prayer & Devotion</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded-full bg-[#2046B3]"></span>
            <span class="font-medium text-gray-700">Certificates Earned:</span>
            <span class="font-bold text-[#2046B3]">0</span>
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== -->
    <!-- Resource Downloads   -->
    <!-- ===================== -->
    <section class="mb-10">
      <h2 class="text-xl font-bold text-[#7C3AED] mb-4">Resource Downloads</h2>
      <div id="resource-list" class="grid md:grid-cols-2 gap-6"></div>
    </section>
    <script>
    async function loadResources() {
      const res = await fetch('get-resources.php');
      const data = await res.json();
      const container = document.getElementById('resource-list');
      container.innerHTML = '';
      if (data.resources && data.resources.length) {
        data.resources.forEach(resource => {
          container.innerHTML += `
            <div class="bg-white rounded-xl shadow p-6 flex flex-col items-start border-l-4 border-[#7C3AED] w-full">
              <div class="flex items-center gap-3 mb-2">
                <svg class="w-8 h-8 text-[#7C3AED]" fill="currentColor" viewBox="0 0 24 24"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.828A2 2 0 0 0 19.414 7L15 2.586A2 2 0 0 0 13.586 2H6zm7 1.414L18.586 9H15a2 2 0 0 1-2-2V3.414zM6 4h6v3a4 4 0 0 0 4 4h3v11a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4zm2 7v2h2v-2H8zm0 4v2h6v-2H8z"/></svg>
                <h3 class="font-bold text-[#7C3AED] text-lg">${resource.title}</h3>
              </div>
              <p class="text-gray-600 mb-3">${resource.description || ''}</p>
              <a href="${resource.file_path}" download class="w-full flex items-center justify-center gap-2 px-6 py-3 bg-[#7C3AED] text-white font-bold rounded-full shadow-lg hover:bg-[#FDBA17] hover:text-[#2046B3] transition text-lg mt-2" aria-label="Download ${resource.title}">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2M7 10l5 5m0 0l5-5m-5 5V4"/></svg>
                Download ${resource.file_type ? resource.file_type.toUpperCase() : ''}
              </a>
            </div>
          `;
        });
      } else {
        container.innerHTML = '<div class="text-gray-500">No resources available at this time.</div>';
      }
    }
    document.addEventListener('DOMContentLoaded', loadResources);
    </script>

    <!-- ===================== -->
    <!-- Quick Actions         -->
    <!-- ===================== -->
    <section class="mb-10">
      <h2 class="text-xl font-bold text-[#7C3AED] mb-4">Quick Actions</h2>
      <div class="flex flex-wrap gap-4 justify-center md:justify-start">
        <a href="https://chat.whatsapp.com/F1BIzqQTulA5t5XlUDLWhK" target="_blank" class="inline-flex items-center gap-2 px-6 py-3 bg-green-500 text-white font-bold rounded-full shadow hover:bg-green-600 transition focus:outline-none focus:ring-4 focus:ring-green-300">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/></svg>
          WhatsApp Group
        </a>
        <a href="mailto:bonnie@ministry.org" class="inline-flex items-center gap-2 px-6 py-3 bg-[#FDBA17] text-[#2046B3] font-bold rounded-full shadow hover:bg-[#7C3AED] hover:text-white transition">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 12H8m8 0a4 4 0 1 0-8 0 4 4 0 0 0 8 0zm-8 0v4m8-4v4"/></svg>
          Contact Mentor
        </a>
      </div>
    </section>

    <!-- ===================== -->
    <!-- Modules Overview      -->
    <!-- ===================== -->
    <section class="mb-10">
      <h2 class="text-xl font-bold text-[#7C3AED] mb-4">Learning Modules</h2>
      <div id="modules-list" class="grid md:grid-cols-2 gap-6"></div>
      <div id="assessment-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl p-8 max-w-lg w-full relative">
          <button onclick="closeAssessmentModal()" class="absolute top-2 right-2 text-2xl text-gray-400 hover:text-[#7C3AED]">&times;</button>
          <h3 id="assessment-title" class="text-2xl font-bold text-[#7C3AED] mb-4"></h3>
          <form id="assessment-form" class="space-y-4"></form>
          <div id="assessment-result" class="mt-4 text-lg font-bold text-green-600 hidden"></div>
        </div>
      </div>
    </section>
    <script>
    async function loadModules() {
      const res = await fetch('get-modules.php');
      const data = await res.json();
      const container = document.getElementById('modules-list');
      container.innerHTML = '';
      if (data.modules && data.modules.length) {
        data.modules.forEach(module => {
          container.innerHTML += `
            <div class="bg-white rounded-xl shadow p-5 border-l-4 border-[#7C3AED] flex flex-col cursor-pointer hover:shadow-2xl transition" onclick="openAssessmentModal(${module.id}, '${module.title.replace(/'/g, "\'")}')">
              <h3 class="font-bold text-[#7C3AED] mb-1">${module.title}</h3>
              <p class="text-gray-700 mb-2">${module.description || ''}</p>
              <span class="text-xs text-gray-400 font-bold mb-2 module-status">Click to take assessment</span>
            </div>
          `;
        });
      } else {
        container.innerHTML = '<div class="text-gray-500">No modules available at this time.</div>';
      }
    }
    document.addEventListener('DOMContentLoaded', loadModules);

    async function openAssessmentModal(moduleId, moduleTitle) {
      document.getElementById('assessment-modal').classList.remove('hidden');
      document.getElementById('assessment-title').textContent = moduleTitle + ' - Assessment';
      const res = await fetch('get-assessment.php?module_id=' + moduleId);
      const data = await res.json();
      const form = document.getElementById('assessment-form');
      const resultDiv = document.getElementById('assessment-result');
      resultDiv.classList.add('hidden');
      resultDiv.textContent = '';
      form.innerHTML = '';
      if (data.questions && data.questions.length) {
        data.questions.forEach((q, idx) => {
          form.innerHTML += `
            <div>
              <label class="font-semibold text-gray-700">${idx+1}. ${q.question}</label>
              ${q.answer_type === 'multiple_choice' && q.options ? q.options.map(opt => `<div><label><input type='radio' name='q${q.id}' value='${opt}' class='mr-2'>${opt}</label></div>`).join('') : `<input type='text' name='q${q.id}' class='w-full px-3 py-2 border rounded mt-1'>`}
            </div>
          `;
        });
        form.innerHTML += `<button type="submit" class="mt-4 px-6 py-2 bg-[#7C3AED] text-white rounded-full font-bold shadow hover:bg-[#FDBA17] hover:text-[#2046B3] transition">Submit Assessment</button>`;
        form.onsubmit = async function(e) {
          e.preventDefault();
          // For demo, only handle first question
          const firstQ = data.questions[0];
          const answer = form['q'+firstQ.id].value;
          const payload = {user_id: 1, assessment_id: firstQ.id, answer: answer, score: null};
          const resp = await fetch('submit-assessment.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
          });
          const respData = await resp.json();
          if (respData.success) {
            resultDiv.textContent = 'Assessment submitted!';
            resultDiv.classList.remove('hidden');
          } else {
            resultDiv.textContent = 'Error: ' + (respData.error || 'Unknown error');
            resultDiv.classList.remove('hidden');
            resultDiv.classList.add('text-red-600');
          }
        };
      } else {
        form.innerHTML = '<div class="text-gray-500">No assessment for this module.</div>';
      }
    }
    function closeAssessmentModal() {
      document.getElementById('assessment-modal').classList.add('hidden');
    }
    </script>

    <!-- ===================== -->
    <!-- Recent Activity       -->
    <!-- ===================== -->
    <section class="mb-10">
      <h2 class="text-xl font-bold text-[#7C3AED] mb-4">Recent Activity</h2>
      <div class="bg-white rounded-xl shadow p-6 flex flex-col gap-3 border-l-4 border-[#FDBA17]">
        <div class="flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-[#7C3AED]"></span>
          <span class="text-gray-700">Completed <span class="font-bold">Day 1: I Am a Child of God</span></span>
          <span class="ml-auto text-xs text-gray-400">2 days ago</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-[#FDBA17]"></span>
          <span class="text-gray-700">Started <span class="font-bold">Day 2: My New Friend, The Holy Spirit</span></span>
          <span class="ml-auto text-xs text-gray-400">1 day ago</span>
        </div>
        <!-- Add more activity items as needed -->
      </div>
    </section>

    <!-- ===================== -->
    <!-- Mentor Section        -->
    <!-- ===================== -->
    <section class="mb-10">
      <h2 class="text-xl font-bold text-[#7C3AED] mb-4">Your Mentor</h2>
      <div id="mentor-info" class="flex flex-col md:flex-row gap-6 items-center"></div>
    </section>
    <script>
    async function loadMentor() {
      // Replace with actual user_id from session/auth
      const res = await fetch('get-mentor.php?user_id=1');
      const data = await res.json();
      const container = document.getElementById('mentor-info');
      if (data.mentor) {
        container.innerHTML = `
          <div class="flex items-center gap-4 bg-white rounded-xl shadow p-5 border-l-4 border-[#7C3AED] flex-1">
            <img src="${data.mentor.photo || 'assets/images/leadership/Bonnie Onduso.jpg'}" alt="Mentor" class="h-16 w-16 rounded-full border-4 border-[#FDBA17] shadow">
            <div>
              <h3 class="font-bold text-[#7C3AED] text-lg mb-1">${data.mentor.name}</h3>
              <p class="text-gray-600 text-sm mb-1">${data.mentor.bio || ''}</p>
              <a href="mailto:${data.mentor.email}" class="text-[#2046B3] underline text-sm">${data.mentor.email}</a>
            </div>
          </div>
          <div class="flex flex-col gap-2 flex-1">
            <button onclick="requestMentorChange()" class="px-4 py-2 bg-[#7C3AED] text-white rounded-full font-bold shadow hover:bg-[#FDBA17] hover:text-[#2046B3] transition">Request Mentor Change</button>
            <a href="mailto:${data.mentor.email}" class="px-4 py-2 bg-[#FDBA17] text-[#2046B3] rounded-full font-bold shadow hover:bg-[#7C3AED] hover:text-white transition text-center">Message Mentor</a>
          </div>
        `;
      } else {
        container.innerHTML = '<div class="text-gray-500">No mentor assigned yet.</div>';
      }
    }
    document.addEventListener('DOMContentLoaded', loadMentor);

    function requestMentorChange() {
      const reason = prompt('Why do you want to change your mentor?');
      if (!reason) return;
      fetch('request-mentor-change.php', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({user_id: 1, reason})
      }).then(res => res.json()).then(data => {
        if (data.success) alert('Request sent!');
        else alert('Error: ' + (data.error || 'Unknown error'));
      });
    }
    </script>

    <!-- ===================== -->
    <!-- Graduation & Certificate -->
    <!-- ===================== -->
    <section class="mb-10">
      <h2 class="text-xl font-bold text-[#7C3AED] mb-4">Graduation & Certificate</h2>
      <div id="graduation-info" class="bg-white rounded-xl shadow p-6 flex flex-col items-center border-l-4 border-[#FDBA17]"></div>
    </section>
    <script>
    async function loadGraduation() {
      // Replace with actual user_id from session/auth
      const res = await fetch('get-graduation.php?user_id=1');
      const data = await res.json();
      const container = document.getElementById('graduation-info');
      if (data.graduation) {
        container.innerHTML = `
          <div class="text-center">
            <div class="text-2xl font-bold text-[#7C3AED] mb-2">Congratulations!</div>
            <div class="text-gray-700 mb-2">You graduated on <span class="font-semibold">${new Date(data.graduation.graduation_date).toLocaleDateString()}</span>.</div>
            <a href="${data.graduation.certificate_path}" target="_blank" class="inline-block px-6 py-3 bg-[#7C3AED] text-white font-bold rounded-full shadow hover:bg-[#FDBA17] hover:text-[#2046B3] transition text-lg mt-2">Download Certificate</a>
          </div>
        `;
      } else {
        container.innerHTML = '<div class="text-gray-500">You have not graduated yet. Complete all modules and assessments to earn your certificate!</div>';
      }
    }
    document.addEventListener('DOMContentLoaded', loadGraduation);
    </script>

    <!-- ===================== -->
    <!-- Advanced Pathways    -->
    <!-- ===================== -->
    <section class="mb-10">
      <h2 class="text-xl font-bold text-[#7C3AED] mb-4">Advanced Discipleship Pathways</h2>
      <div id="pathways-list" class="grid md:grid-cols-2 gap-6"></div>
    </section>
    <script>
    async function loadPathways() {
      const res = await fetch('get-pathways.php');
      const data = await res.json();
      const container = document.getElementById('pathways-list');
      container.innerHTML = '';
      if (data.pathways && data.pathways.length) {
        data.pathways.forEach(pathway => {
          container.innerHTML += `
            <div class="bg-white rounded-xl shadow p-6 flex flex-col items-start border-l-4 border-[#2046B3] w-full">
              <h3 class="font-bold text-[#2046B3] text-lg mb-2">${pathway.name}</h3>
              <p class="text-gray-600 mb-3">${pathway.description || ''}</p>
              <button onclick="enrollPathway(${pathway.id})" class="px-6 py-2 bg-[#2046B3] text-white font-bold rounded-full shadow hover:bg-[#FDBA17] hover:text-[#2046B3] transition">Enroll</button>
            </div>
          `;
        });
      } else {
        container.innerHTML = '<div class="text-gray-500">No advanced pathways available at this time.</div>';
      }
    }
    document.addEventListener('DOMContentLoaded', loadPathways);

    function enrollPathway(pathwayId) {
      fetch('enroll-pathway.php', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({user_id: 1, pathway_id: pathwayId})
      }).then(res => res.json()).then(data => {
        if (data.success) {
          alert('Enrolled successfully!');
          loadPathways();
        } else {
          alert('Error: ' + (data.error || 'Unknown error'));
        }
      });
    }
    </script>
  </main>
</body>
</html> 