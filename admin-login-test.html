<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login Test - Hearts After God Ministry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
      <div class="flex justify-center mb-6">
        <img src="assets/images/WhatsApp Image 2025-07-04 at 17.27.34_37ced412.jpg" alt="Hearts After God Ministry Logo" class="h-20 w-20 rounded-full border-4 border-[#FDBA17] shadow-lg" />
      </div>
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Admin Login Test</h1>
            <p class="text-gray-600">Testing authentication on mobile devices</p>
        </div>

        <div id="test-results" class="mb-6 p-4 bg-gray-50 rounded-lg">
            <h3 class="font-semibold text-gray-900 mb-2">Test Results:</h3>
            <div id="results-content" class="text-sm text-gray-600">
                Running tests...
            </div>
        </div>

        <form id="login-form" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" id="email" value="admin@heartsaftergod.org" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                <input type="password" id="password" value="admin123" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none">
            </div>
            <button type="submit" 
                    class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all">
                Test Login
            </button>
        </form>

        <div class="mt-6 text-center">
            <button onclick="runDiagnostics()" 
                    class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                Run Diagnostics
            </button>
        </div>

        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
            <h4 class="font-semibold text-blue-900 mb-2">Admin Credentials:</h4>
            <p class="text-sm text-blue-800">
                <strong>Email:</strong> admin@heartsaftergod.org<br>
                <strong>Password:</strong> admin123
            </p>
        </div>

        <div class="mt-4 p-4 bg-yellow-50 rounded-lg">
            <h4 class="font-semibold text-yellow-900 mb-2">Mobile Access:</h4>
            <p class="text-sm text-yellow-800">
                Make sure you're accessing the site using your computer's IP address, not localhost.<br>
                Example: http://192.168.1.100:8000/admin-login-test.html
            </p>
        </div>
    </div>

    <script src="assets/js/discipleship-backend.js"></script>
    <script>
        let testResults = [];

        function addTestResult(test, result, details = '') {
            const status = result ? '✅' : '❌';
            testResults.push({ test, result, details });
            updateResultsDisplay();
        }

        function updateResultsDisplay() {
            const content = document.getElementById('results-content');
            content.innerHTML = testResults.map(r => 
                `<div class="mb-1">${r.result ? '✅' : '❌'} ${r.test}${r.details ? ': ' + r.details : ''}</div>`
            ).join('');
        }

        function runDiagnostics() {
            testResults = [];
            
            // Test 1: Backend availability
            addTestResult('Backend Available', !!window.DiscipleshipBackend, 
                window.DiscipleshipBackend ? 'Backend loaded successfully' : 'Backend not found');

            if (window.DiscipleshipBackend) {
                // Test 2: localStorage
                try {
                    localStorage.setItem('test', 'test');
                    const testValue = localStorage.getItem('test');
                    localStorage.removeItem('test');
                    addTestResult('localStorage Working', testValue === 'test', 
                        testValue === 'test' ? 'localStorage is functional' : 'localStorage test failed');
                } catch (error) {
                    addTestResult('localStorage Working', false, 'localStorage error: ' + error.message);
                }

                // Test 3: Users loaded
                const users = window.DiscipleshipBackend.getAllUsers();
                addTestResult('Users Loaded', users.length > 0, 
                    `Found ${users.length} users`);

                // Test 4: Admin user exists
                const adminUser = users.find(u => u.email === 'admin@heartsaftergod.org');
                addTestResult('Admin User Exists', !!adminUser, 
                    adminUser ? 'Admin user found' : 'Admin user not found');

                // Test 5: Password hashing
                try {
                    const testHash = window.DiscipleshipBackend.hashPassword('test');
                    const testVerify = window.DiscipleshipBackend.verifyPassword('test', testHash);
                    addTestResult('Password Hashing', testVerify, 
                        testVerify ? 'Password hashing works' : 'Password verification failed');
                } catch (error) {
                    addTestResult('Password Hashing', false, 'Password hashing error: ' + error.message);
                }

                // Test 6: Authentication function
                addTestResult('Authentication Function', typeof window.DiscipleshipBackend.authenticateUser === 'function',
                    typeof window.DiscipleshipBackend.authenticateUser === 'function' ? 'Auth function available' : 'Auth function missing');
            }

            // Test 7: Browser info
            addTestResult('User Agent', true, navigator.userAgent.substring(0, 50) + '...');

            // Test 8: Screen size
            addTestResult('Screen Size', true, `${window.innerWidth}x${window.innerHeight}`);

            // Test 9: Network connection
            addTestResult('Online Status', navigator.onLine, navigator.onLine ? 'Online' : 'Offline');
        }

        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            testResults = [];
            addTestResult('Form Submitted', true, `Email: ${email}`);

            if (!window.DiscipleshipBackend) {
                addTestResult('Backend Available', false, 'Backend not loaded');
                return;
            }

            try {
                console.log('Attempting authentication...');
                const user = window.DiscipleshipBackend.authenticateUser(email, password);
                
                if (user) {
                    addTestResult('Authentication Successful', true, 
                        `Logged in as ${user.name} (${user.role})`);
                    
                    // Store login info
                    localStorage.setItem('discipleship_logged_in_user', JSON.stringify(user));
                    addTestResult('Login Stored', true, 'User data saved to localStorage');
                    
                    // Redirect to admin dashboard
                    setTimeout(() => {
                        window.location.href = 'discipleship-admin.html';
                    }, 2000);
                    
                } else {
                    addTestResult('Authentication Failed', false, 'Invalid credentials or user not found');
                    
                    // Show available users for debugging
                    const users = window.DiscipleshipBackend.getAllUsers();
                    const userEmails = users.map(u => u.email).join(', ');
                    addTestResult('Available Users', true, userEmails);
                }
            } catch (error) {
                addTestResult('Authentication Error', false, error.message);
                console.error('Authentication error:', error);
            }
        });

        // Run diagnostics on page load
        window.addEventListener('load', function() {
            setTimeout(runDiagnostics, 1000);
        });
    </script>
</body>
</html> 