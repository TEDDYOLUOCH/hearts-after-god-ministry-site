<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz System Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-[#2046B3]">Quiz System Test</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Admin Quiz Test -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-[#7C3AED]">Admin Quiz Test</h2>
                <div class="space-y-4">
                    <button onclick="testAdminQuiz()" class="w-full bg-gradient-to-r from-[#7C3AED] to-[#2046B3] text-white py-3 rounded-lg font-bold">
                        Test Admin Quiz System
                    </button>
                    <button onclick="testCreateQuiz()" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg font-bold">
                        Create Test Quiz
                    </button>
                    <button onclick="testUserQuiz()" class="w-full bg-gradient-to-r from-[#FDBA17] to-[#F59E0B] text-white py-3 rounded-lg font-bold">
                        Test User Quiz View
                    </button>
                </div>
                <div id="admin-test-results" class="mt-4 p-4 bg-gray-50 rounded-lg">
                    <p class="text-gray-600">Test results will appear here...</p>
                </div>
            </div>

            <!-- Backend Test -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-[#7C3AED]">Backend Test</h2>
                <div class="space-y-4">
                    <button onclick="testBackend()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-bold">
                        Test Backend
                    </button>
                    <button onclick="testQuizAPI()" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-lg font-bold">
                        Test Quiz API
                    </button>
                    <button onclick="testQuizSubmission()" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3 rounded-lg font-bold">
                        Test Quiz Submission
                    </button>
                    <button onclick="clearTestData()" class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-3 rounded-lg font-bold">
                        Clear Test Data
                    </button>
                </div>
                <div id="backend-test-results" class="mt-4 p-4 bg-gray-50 rounded-lg">
                    <p class="text-gray-600">Backend test results will appear here...</p>
                </div>
            </div>
        </div>

        <!-- Test Results -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4 text-[#2046B3]">Test Results</h2>
            <div id="test-results" class="space-y-2">
                <p class="text-gray-600">Run tests to see results...</p>
            </div>
        </div>
    </div>

    <script src="assets/js/discipleship-backend.js"></script>
    <script src="assets/js/admin-quiz.js"></script>
    <script src="assets/js/user-quiz.js"></script>
    <script>
        let backend = null;

        // Initialize backend
        function initBackend() {
            if (!window.DiscipleshipBackend) {
                setTimeout(initBackend, 100);
                return;
            }
            backend = new DiscipleshipBackend();
            console.log('Backend initialized for testing');
        }

        // Test admin quiz system
        function testAdminQuiz() {
            const results = document.getElementById('admin-test-results');
            results.innerHTML = '<p class="text-blue-600">Testing admin quiz system...</p>';

            try {
                if (!window.AdminQuiz) {
                    results.innerHTML = '<p class="text-red-600">❌ AdminQuiz not available</p>';
                    return;
                }

                if (!backend) {
                    results.innerHTML = '<p class="text-red-600">❌ Backend not available</p>';
                    return;
                }

                results.innerHTML = '<p class="text-green-600">✅ Admin quiz system loaded successfully</p>';
                addTestResult('Admin Quiz System', 'PASS', 'System loaded successfully');
            } catch (error) {
                results.innerHTML = `<p class="text-red-600">❌ Error: ${error.message}</p>`;
                addTestResult('Admin Quiz System', 'FAIL', error.message);
            }
        }

        // Test creating quiz
        function testCreateQuiz() {
            const results = document.getElementById('admin-test-results');
            results.innerHTML = '<p class="text-blue-600">Creating test quiz...</p>';

            try {
                if (!backend) {
                    results.innerHTML = '<p class="text-red-600">❌ Backend not available</p>';
                    return;
                }

                const testQuiz = {
                    id: 'test_quiz_' + Date.now(),
                    title: 'Test Quiz - ' + new Date().toLocaleString(),
                    description: 'This is a test quiz created by the test system.',
                    category: 'bible-study',
                    difficulty: 'medium',
                    timeLimit: 15,
                    targetUsers: 'all',
                    passingScore: 70,
                    questions: [
                        {
                            id: 'q1',
                            text: 'What is the first book of the Bible?',
                            type: 'multiple-choice',
                            options: [
                                { id: 'opt1', text: 'Genesis', isCorrect: true },
                                { id: 'opt2', text: 'Exodus', isCorrect: false },
                                { id: 'opt3', text: 'Matthew', isCorrect: false },
                                { id: 'opt4', text: 'Revelation', isCorrect: false }
                            ]
                        },
                        {
                            id: 'q2',
                            text: 'Jesus was born in Bethlehem.',
                            type: 'true-false',
                            correctAnswer: true
                        },
                        {
                            id: 'q3',
                            text: 'What is the greatest commandment according to Jesus?',
                            type: 'short-answer',
                            correctAnswer: 'Love the Lord your God with all your heart'
                        }
                    ],
                    uploadedBy: { name: 'Test Admin', email: 'test@admin.com' },
                    uploadedDate: new Date().toISOString(),
                    status: 'active',
                    attempts: 0,
                    averageScore: 0,
                    completions: 0
                };

                const result = backend.createQuiz(testQuiz);
                
                if (result.success) {
                    results.innerHTML = '<p class="text-green-600">✅ Test quiz created successfully</p>';
                    addTestResult('Create Quiz', 'PASS', 'Quiz created successfully');
                } else {
                    results.innerHTML = `<p class="text-red-600">❌ Failed to create quiz: ${result.message}</p>`;
                    addTestResult('Create Quiz', 'FAIL', result.message);
                }
            } catch (error) {
                results.innerHTML = `<p class="text-red-600">❌ Error: ${error.message}</p>`;
                addTestResult('Create Quiz', 'FAIL', error.message);
            }
        }

        // Test user quiz view
        function testUserQuiz() {
            const results = document.getElementById('admin-test-results');
            results.innerHTML = '<p class="text-blue-600">Testing user quiz view...</p>';

            try {
                if (!window.UserQuiz) {
                    results.innerHTML = '<p class="text-red-600">❌ UserQuiz not available</p>';
                    return;
                }

                // Create a test user
                const testUser = {
                    id: 'test_user_123',
                    name: 'Test User',
                    email: 'test@user.com',
                    role: 'student'
                };

                window.UserQuiz.setCurrentUser(testUser);
                
                results.innerHTML = '<p class="text-green-600">✅ User quiz system initialized</p>';
                addTestResult('User Quiz System', 'PASS', 'System initialized with test user');
            } catch (error) {
                results.innerHTML = `<p class="text-red-600">❌ Error: ${error.message}</p>`;
                addTestResult('User Quiz System', 'FAIL', error.message);
            }
        }

        // Test backend
        function testBackend() {
            const results = document.getElementById('backend-test-results');
            results.innerHTML = '<p class="text-blue-600">Testing backend...</p>';

            try {
                if (!backend) {
                    results.innerHTML = '<p class="text-red-600">❌ Backend not available</p>';
                    return;
                }

                const quizzes = backend.getAllQuizzes();
                results.innerHTML = `<p class="text-green-600">✅ Backend working. Found ${quizzes.length} quizzes</p>`;
                addTestResult('Backend', 'PASS', `Found ${quizzes.length} quizzes`);
            } catch (error) {
                results.innerHTML = `<p class="text-red-600">❌ Error: ${error.message}</p>`;
                addTestResult('Backend', 'FAIL', error.message);
            }
        }

        // Test quiz API
        function testQuizAPI() {
            const results = document.getElementById('backend-test-results');
            results.innerHTML = '<p class="text-blue-600">Testing quiz API...</p>';

            try {
                if (!backend) {
                    results.innerHTML = '<p class="text-red-600">❌ Backend not available</p>';
                    return;
                }

                // Test all quiz API methods
                const allQuizzes = backend.getAllQuizzes();
                const testUserId = 'test_user_123';
                const userQuizzes = backend.getUserQuizzes(testUserId);
                
                results.innerHTML = `
                    <p class="text-green-600">✅ Quiz API working</p>
                    <p class="text-sm text-gray-600">Total quizzes: ${allQuizzes.length}</p>
                    <p class="text-sm text-gray-600">User quizzes: ${userQuizzes.length}</p>
                `;
                addTestResult('Quiz API', 'PASS', `API methods working correctly`);
            } catch (error) {
                results.innerHTML = `<p class="text-red-600">❌ Error: ${error.message}</p>`;
                addTestResult('Quiz API', 'FAIL', error.message);
            }
        }

        // Test quiz submission
        function testQuizSubmission() {
            const results = document.getElementById('backend-test-results');
            results.innerHTML = '<p class="text-blue-600">Testing quiz submission...</p>';

            try {
                if (!backend) {
                    results.innerHTML = '<p class="text-red-600">❌ Backend not available</p>';
                    return;
                }

                const quizzes = backend.getAllQuizzes();
                if (quizzes.length === 0) {
                    results.innerHTML = '<p class="text-yellow-600">⚠️ No quizzes available. Create a quiz first.</p>';
                    addTestResult('Quiz Submission', 'SKIP', 'No quizzes available');
                    return;
                }

                const quiz = quizzes[0];
                const testUserId = 'test_user_123';
                const answers = {
                    'q1': 'opt1', // Correct answer for Genesis
                    'q2': 'true', // Correct answer for Bethlehem
                    'q3': 'Love the Lord your God with all your heart' // Correct answer
                };

                const result = backend.submitQuizAttempt(quiz.id, testUserId, answers);
                
                if (result.success) {
                    results.innerHTML = `
                        <p class="text-green-600">✅ Quiz submission successful</p>
                        <p class="text-sm text-gray-600">Score: ${result.score}%</p>
                        <p class="text-sm text-gray-600">Passed: ${result.passed ? 'Yes' : 'No'}</p>
                    `;
                    addTestResult('Quiz Submission', 'PASS', `Score: ${result.score}%, Passed: ${result.passed}`);
                } else {
                    results.innerHTML = `<p class="text-red-600">❌ Quiz submission failed: ${result.message}</p>`;
                    addTestResult('Quiz Submission', 'FAIL', result.message);
                }
            } catch (error) {
                results.innerHTML = `<p class="text-red-600">❌ Error: ${error.message}</p>`;
                addTestResult('Quiz Submission', 'FAIL', error.message);
            }
        }

        // Clear test data
        function clearTestData() {
            const results = document.getElementById('backend-test-results');
            results.innerHTML = '<p class="text-blue-600">Clearing test data...</p>';

            try {
                localStorage.removeItem('admin_quizzes');
                results.innerHTML = '<p class="text-green-600">✅ Test data cleared</p>';
                addTestResult('Clear Data', 'PASS', 'Test data cleared successfully');
            } catch (error) {
                results.innerHTML = `<p class="text-red-600">❌ Error: ${error.message}</p>`;
                addTestResult('Clear Data', 'FAIL', error.message);
            }
        }

        // Add test result
        function addTestResult(testName, status, message) {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const statusColor = status === 'PASS' ? 'text-green-600' : status === 'SKIP' ? 'text-yellow-600' : 'text-red-600';
            const statusIcon = status === 'PASS' ? '✅' : status === 'SKIP' ? '⚠️' : '❌';
            
            const resultHtml = `
                <div class="flex items-center gap-3 p-2 bg-gray-50 rounded">
                    <span class="${statusColor} font-bold">${statusIcon} ${testName}</span>
                    <span class="text-gray-600">${message}</span>
                    <span class="text-gray-400 text-sm ml-auto">${timestamp}</span>
                </div>
            `;
            
            results.insertAdjacentHTML('afterbegin', resultHtml);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initBackend();
        });
    </script>
</body>
</html> 