<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Hearts After God Ministry</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { font-family: 'Nunito', sans-serif; }
    .header-gradient { background: linear-gradient(90deg, #7C3AED 0%, #F59E0B 100%); }
    .sidebar-gradient { background: #7C3AED; height: 100vh; min-height: 100%; }
    .sidebar-link.active, .sidebar-link:hover { background: linear-gradient(90deg, #7C3AED 0%, #F59E0B 100%); color: #fff; font-weight: bold; }
    .sidebar-link { color: #fff; border-radius: 12px; padding: 12px 24px; margin: 4px 0; display: block; width: 100%; font-size: 1.1rem; transition: all 0.3s; text-align: left; }
    .sidebar-link i { margin-right: 1rem; vertical-align: middle; }
    .dashboard-card { background: #fff; border-radius: 1.5rem; box-shadow: 0 4px 24px rgba(124,58,237,0.08); border: 1px solid #eee; transition: box-shadow 0.3s; }
    .dashboard-card:hover { box-shadow: 0 8px 32px rgba(124,58,237,0.12); }
    .card-icon { background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%); border-radius: 1rem; width: 3.5rem; height: 3.5rem; display: flex; align-items: center; justify-content: center; font-size: 2rem; }
  </style>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Section IDs
        const sectionIds = [
          'dashboard', 'sermons', 'events', 'blogs', 'gallery', 'pages', 'ministries', 'users', 'comments', 'media', 'newsletter'
        ];
        // Hide all sections
        function hideAllSections() {
          sectionIds.forEach(id => {
            const el = document.getElementById(id + '-section');
            if (el) el.classList.add('hidden');
          });
        }
        // Remove active from all sidebar links
        function deactivateSidebarLinks() {
          document.querySelectorAll('.sidebar-link').forEach(link => link.classList.remove('active'));
        }
        // Show section by id
        function showSection(id) {
          hideAllSections();
          const el = document.getElementById(id + '-section');
          if (el) el.classList.remove('hidden');
        }
        // Handle sidebar clicks
        document.querySelectorAll('.sidebar-link').forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const href = this.getAttribute('href');
            if (href && href.startsWith('#')) {
              const id = href.substring(1);
              showSection(id);
              deactivateSidebarLinks();
              this.classList.add('active');
            }
          });
        });
        // Handle dashboard card clicks
        document.querySelectorAll('.dashboard-card').forEach(card => {
          card.addEventListener('click', function(e) {
            e.preventDefault();
            const href = this.getAttribute('href');
            if (href && href.startsWith('#')) {
              const id = href.substring(1);
              showSection(id);
              deactivateSidebarLinks();
              // Also highlight sidebar link
              const sidebar = document.querySelector('.sidebar-link[href="' + href + '"]');
              if (sidebar) sidebar.classList.add('active');
            }
          });
        });
        // Show dashboard by default
        showSection('dashboard');
      });
    </script>
</head>
<body class="bg-gray-50">
  <!-- Modern Dashboard Header -->
  <header class="sticky top-0 z-50 w-full bg-[#7C3AED] text-white shadow-xl">
    <div class="max-w-full flex items-center justify-between px-6 py-4">
      <div class="flex items-center gap-4">
        <img src="assets/images/logo.jpg" alt="Logo" class="h-10 w-10 rounded-full border-2 border-white shadow-md object-cover"/>
        <span class="text-2xl font-black tracking-tight">Hearts After God Ministry</span>
        <span class="ml-4 px-3 py-1 rounded-full bg-[#F59E0B] text-[#7C3AED] font-bold text-sm hidden md:inline">Admin Dashboard</span>
      </div>
      <div class="relative group">
        <button class="flex items-center gap-2 focus:outline-none">
          <div class="w-10 h-10 bg-[#F59E0B] rounded-full flex items-center justify-center text-[#2046B3] font-black text-xl">A</div>
          <span class="font-bold hidden md:inline">Administrator</span>
          <i class="fas fa-chevron-down ml-1"></i>
        </button>
        <div class="absolute right-0 mt-2 w-48 bg-white text-gray-900 rounded-lg shadow-lg py-2 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 pointer-events-none group-hover:pointer-events-auto group-focus-within:pointer-events-auto transition-all duration-200 z-50">
          <a href="#dashboard-section" class="flex items-center px-4 py-2 hover:bg-gray-100"><i class="fas fa-user-shield mr-2 text-[#7C3AED]"></i>Profile</a>
          <a href="#" class="flex items-center px-4 py-2 hover:bg-gray-100"><i class="fas fa-cog mr-2 text-[#F59E0B]"></i>Settings</a>
          <a href="#" class="flex items-center px-4 py-2 hover:bg-gray-100"><i class="fas fa-sign-out-alt mr-2 text-[#DC2626]"></i>Logout</a>
        </div>
      </div>
    </div>
  </header>
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-72 sidebar-gradient text-white flex-shrink-0 hidden md:flex flex-col py-8 px-6 sticky top-0 z-40 shadow-2xl min-h-screen h-full">
      <nav class="flex flex-col gap-2">
        <a href="#dashboard" class="sidebar-link active"><i class="fas fa-tachometer-alt"></i>Dashboard</a>
        <a href="#sermons" class="sidebar-link"><i class="fas fa-microphone"></i>Sermons</a>
        <a href="#events" class="sidebar-link"><i class="fas fa-calendar-alt"></i>Events</a>
        <a href="#blogs" class="sidebar-link"><i class="fas fa-blog"></i>Blogs</a>
        <a href="#gallery" class="sidebar-link"><i class="fas fa-images"></i>Gallery</a>
        <a href="#pages" class="sidebar-link"><i class="fas fa-file-alt"></i>Pages</a>
        <a href="#ministries" class="sidebar-link"><i class="fas fa-church"></i>Ministries</a>
        <a href="#users" class="sidebar-link"><i class="fas fa-users-cog"></i>Users</a>
        <a href="#comments" class="sidebar-link"><i class="fas fa-comments"></i>Comments</a>
        <a href="#media" class="sidebar-link"><i class="fas fa-upload"></i>Media</a>
        <a href="#newsletter" class="sidebar-link"><i class="fas fa-envelope-open-text"></i>Newsletter</a>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 p-8">
      <section id="dashboard-section" class="mb-10">
        <h2 class="text-3xl font-bold text-[#7C3AED] mb-8 flex items-center gap-3">
          <i class="fas fa-user-shield text-[#F59E0B]"></i>Administrator Controls
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          <a href="#sermons" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-microphone text-[#7C3AED]"></i></span>
            <div>
              <div class="font-bold text-lg text-[#7C3AED]">Manage Sermons</div>
              <div class="text-gray-600 text-sm">Add, edit, or remove sermons</div>
            </div>
          </a>
          <a href="#events" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-calendar-alt text-[#F59E0B]"></i></span>
            <div>
              <div class="font-bold text-lg text-[#F59E0B]">Manage Events</div>
              <div class="text-gray-600 text-sm">Add, edit, or remove events</div>
          </div>
          </a>
          <a href="#blogs" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-blog text-[#2046B3]"></i></span>
            <div>
              <div class="font-bold text-lg text-[#2046B3]">Manage Blogs</div>
              <div class="text-gray-600 text-sm">Add, edit, or remove blog posts</div>
            </div>
          </a>
          <a href="#gallery" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-images text-[#7C3AED]"></i></span>
            <div>
              <div class="font-bold text-lg text-[#7C3AED]">Manage Gallery</div>
              <div class="text-gray-600 text-sm">Add, edit, or remove images</div>
          </div>
          </a>
          <a href="#pages" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-file-alt text-[#F59E0B]"></i></span>
            <div>
              <div class="font-bold text-lg text-[#F59E0B]">Manage Pages</div>
              <div class="text-gray-600 text-sm">Add, edit, or remove site pages</div>
            </div>
          </a>
          <a href="#ministries" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-church text-[#2046B3]"></i></span>
            <div>
              <div class="font-bold text-lg text-[#2046B3]">Manage Ministries</div>
              <div class="text-gray-600 text-sm">Add, update, or remove ministries</div>
            </div>
          </a>
          <a href="#users" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-users-cog text-[#7C3AED]"></i></span>
                  <div>
              <div class="font-bold text-lg text-[#7C3AED]">Manage Users</div>
              <div class="text-gray-600 text-sm">Approve registrations, reset passwords</div>
                  </div>
          </a>
          <a href="#comments" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-comments text-[#F59E0B]"></i></span>
                  <div>
              <div class="font-bold text-lg text-[#F59E0B]">Moderate Comments</div>
              <div class="text-gray-600 text-sm">Approve, edit, or delete comments/testimonies</div>
                  </div>
          </a>
          <a href="#media" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-upload text-[#2046B3]"></i></span>
                  <div>
              <div class="font-bold text-lg text-[#2046B3]">Upload Media</div>
              <div class="text-gray-600 text-sm">Upload videos, audios, PDFs</div>
                  </div>
          </a>
          <a href="#newsletter" class="dashboard-card p-6 flex items-center gap-4 hover:shadow-xl transition-all">
            <span class="card-icon"><i class="fas fa-envelope-open-text text-[#7C3AED]"></i></span>
                  <div>
              <div class="font-bold text-lg text-[#7C3AED]">Send Newsletter</div>
              <div class="text-gray-600 text-sm">Send newsletters or announcements</div>
                  </div>
          </a>
        </div>
      </section>
      <section id="sermons-section" class="hidden">
        <div class="text-2xl font-bold text-[#7C3AED] mb-4">Sermons Management</div>
        <div class="mb-4 flex flex-wrap gap-4 items-center">
          <button onclick="filterSermons('all')" class="px-4 py-2 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#F59E0B]">All</button>
          <button onclick="filterSermons('archived')" class="px-4 py-2 bg-gray-300 text-[#7C3AED] rounded-lg font-bold hover:bg-[#F59E0B]">Archived</button>
              </div>
        <div class="mb-6">
          <form id="add-sermon-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                  <div>
              <label class="block text-sm font-semibold mb-1">Title</label>
              <input type="text" id="sermon-title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none" required />
                  </div>
                  <div>
              <label class="block text-sm font-semibold mb-1">Speaker</label>
              <input type="text" id="sermon-speaker" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none" required />
                  </div>
                  <div>
              <label class="block text-sm font-semibold mb-1">Date Preached</label>
              <input type="date" id="sermon-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none" required />
                  </div>
                  <div>
              <label class="block text-sm font-semibold mb-1">Category</label>
              <select id="sermon-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none">
                <option value="Sunday">Sunday</option>
                <option value="Youth">Youth</option>
                <option value="Revival">Revival</option>
                <option value="Women">Women</option>
                <option value="Men">Men</option>
                <option value="Children">Children</option>
                <option value="Other">Other</option>
              </select>
            </div>
              <div>
              <label class="block text-sm font-semibold mb-1">Tags (comma separated)</label>
              <input type="text" id="sermon-tags" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none" placeholder="faith, love, youth, marriage" />
              </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-semibold mb-1">Description</label>
              <textarea id="sermon-description" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none" rows="2"></textarea>
              </div>
              <div>
              <label class="block text-sm font-semibold mb-1">Sermon Media (Audio/Video)</label>
              <input type="file" id="sermon-media" accept="audio/*,video/*" class="w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none" />
              </div>
              <div>
              <label class="block text-sm font-semibold mb-1">Sermon Notes (PDF, DOCX, etc.)</label>
              <input type="file" id="sermon-notes" accept=".pdf,.doc,.docx,.txt" class="w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none" />
              </div>
              <div>
              <label class="block text-sm font-semibold mb-1">Additional Resources</label>
              <input type="file" id="sermon-resources" multiple class="w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none" />
              </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Bible References</label>
              <input type="text" id="sermon-bible" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none" placeholder="e.g. John 3:16, Romans 8:28" />
              </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Publication Status</label>
              <select id="sermon-status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#7C3AED] outline-none">
                <option value="Draft">Draft</option>
                <option value="Published">Published</option>
              </select>
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Feature on Homepage</label>
              <input type="checkbox" id="sermon-featured" class="form-checkbox h-5 w-5 text-[#7C3AED]" />
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Archive</label>
              <input type="checkbox" id="sermon-archived" class="form-checkbox h-5 w-5 text-[#7C3AED]" />
        </div>
            <div class="md:col-span-2">
              <button type="submit" class="px-8 py-2 bg-[#7C3AED] text-white font-bold rounded-lg hover:bg-[#F59E0B] transition-all w-full">Add Sermon</button>
        </div>
      </form>
    </div>
        <div class="overflow-x-auto">
          <table class="w-full bg-white rounded-xl shadow border border-gray-200">
            <thead class="bg-[#7C3AED] text-white">
              <tr>
                <th class="px-4 py-2 text-left">Title</th>
                <th class="px-4 py-2 text-left">Speaker</th>
                <th class="px-4 py-2 text-left">Date</th>
                <th class="px-4 py-2 text-left">Category</th>
                <th class="px-4 py-2 text-left">Tags</th>
                <th class="px-4 py-2 text-left">Status</th>
                <th class="px-4 py-2 text-left">Approval</th>
                <th class="px-4 py-2 text-left">Featured</th>
                <th class="px-4 py-2 text-left">Archived</th>
                <th class="px-4 py-2 text-left">Media</th>
                <th class="px-4 py-2 text-left">Notes</th>
                <th class="px-4 py-2 text-left">Resources</th>
                <th class="px-4 py-2 text-left">Bible</th>
                <th class="px-4 py-2 text-left">Views</th>
                <th class="px-4 py-2 text-left">Listens</th>
                <th class="px-4 py-2 text-left">Downloads</th>
                <th class="px-4 py-2 text-left">Engagement</th>
                <th class="px-4 py-2 text-left">Comments</th>
                <th class="px-4 py-2 text-left">Actions</th>
              </tr>
            </thead>
            <tbody id="sermons-table-body">
              <!-- Sermons will be rendered here -->
            </tbody>
          </table>
  </div>
        <!-- Comments Modal -->
        <div id="sermon-comments-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
          <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-bold text-[#7C3AED]">Sermon Comments</h3>
              <button onclick="closeSermonCommentsModal()" class="text-gray-400 hover:text-red-500 text-2xl">&times;</button>
      </div>
            <div id="sermon-comments-list">
              <ul class="space-y-2">
                <li class="border-b pb-2"><span class="font-bold">Jane Doe:</span> Powerful message!</li>
                <li class="border-b pb-2"><span class="font-bold">John Smith:</span> Blessed by this sermon.</li>
                <li class="border-b pb-2"><span class="font-bold">Mary Wanjiku:</span> Please upload the notes!</li>
              </ul>
              <div class="mt-4">
                <textarea class="w-full px-3 py-2 border rounded mb-2" placeholder="Add a comment..."></textarea>
                <button class="px-4 py-2 bg-[#7C3AED] text-white rounded font-bold">Post</button>
        </div>
        </div>
        </div>
        </div>
      </section>
      <section id="events-section" class="hidden">
        <div class="text-2xl font-bold text-[#F59E0B] mb-4">Events Management</div>
        <div class="mb-6">
          <form id="add-event-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
        <div>
              <label class="block text-sm font-semibold mb-1">Title</label>
              <input type="text" id="event-title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" required />
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Date</label>
              <input type="date" id="event-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" required />
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Time</label>
              <input type="time" id="event-time" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" required />
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Venue</label>
              <input type="text" id="event-venue" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" required />
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Theme</label>
              <input type="text" id="event-theme" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" />
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Speaker</label>
              <input type="text" id="event-speaker" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" />
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Status</label>
              <select id="event-status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none">
                <option value="Upcoming">Upcoming</option>
                <option value="Ongoing">Ongoing</option>
                <option value="Completed">Completed</option>
                <option value="Cancelled">Cancelled</option>
          </select>
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Ministry</label>
              <input type="text" id="event-ministry" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" />
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Tags (comma separated)</label>
              <input type="text" id="event-tags" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" />
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Description</label>
              <textarea id="event-description" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" rows="2"></textarea>
        </div>
        <div>
              <label class="block text-sm font-semibold mb-1">Event Poster/Image</label>
              <input type="file" id="event-image" accept="image/*" class="w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" />
          </div>
          <div>
              <label class="block text-sm font-semibold mb-1">Attachments (PDF, DOC, etc.)</label>
              <input type="file" id="event-attachments" multiple class="w-full px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" />
          </div>
          <div>
              <label class="block text-sm font-semibold mb-1">Call-to-Action Label</label>
              <input type="text" id="event-cta-label" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" placeholder="e.g. Register Now" />
          </div>
          <div>
              <label class="block text-sm font-semibold mb-1">Call-to-Action Link</label>
              <input type="url" id="event-cta-link" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#F59E0B] outline-none" placeholder="https://..." />
          </div>
            <div class="md:col-span-2">
              <button type="submit" class="px-8 py-2 bg-[#F59E0B] text-white font-bold rounded-lg hover:bg-[#7C3AED] transition-all w-full">Add Event</button>
          </div>
          </form>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full bg-white rounded-xl shadow border border-gray-200">
            <thead class="bg-[#F59E0B] text-white">
              <tr>
                <th class="px-4 py-2 text-left">Title</th>
                <th class="px-4 py-2 text-left">Date</th>
                <th class="px-4 py-2 text-left">Time</th>
                <th class="px-4 py-2 text-left">Venue</th>
                <th class="px-4 py-2 text-left">Theme</th>
                <th class="px-4 py-2 text-left">Speaker</th>
                <th class="px-4 py-2 text-left">Status</th>
                <th class="px-4 py-2 text-left">Ministry</th>
                <th class="px-4 py-2 text-left">Tags</th>
                <th class="px-4 py-2 text-left">Image</th>
                <th class="px-4 py-2 text-left">Attachments</th>
                <th class="px-4 py-2 text-left">CTA</th>
                <th class="px-4 py-2 text-left">Actions</th>
              </tr>
            </thead>
            <tbody id="events-table-body">
              <!-- Events will be rendered here -->
            </tbody>
          </table>
            </div>
        <!-- Registration Modal -->
        <div id="event-registrations-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
          <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-bold text-[#F59E0B]">Event Registrations</h3>
              <button onclick="closeRegistrationsModal()" class="text-gray-400 hover:text-red-500 text-2xl">&times;</button>
          </div>
            <div id="event-registrations-list">
              <!-- Static demo list -->
              <ul class="space-y-2">
                <li class="flex justify-between items-center border-b pb-2"><span>Jane Doe</span><span class="text-xs text-gray-500">Confirmed</span></li>
                <li class="flex justify-between items-center border-b pb-2"><span>John Smith</span><span class="text-xs text-gray-500">Pending</span></li>
                <li class="flex justify-between items-center border-b pb-2"><span>Mary Wanjiku</span><span class="text-xs text-gray-500">Confirmed</span></li>
              </ul>
              <div class="mt-4 text-right">
                <button class="px-4 py-2 bg-[#F59E0B] text-white rounded-lg font-bold hover:bg-[#7C3AED]">Export CSV</button>
        </div>
          </div>
        </div>
            </div>
      </section>
      <section id="blogs-section" class="hidden">
        <div class="text-2xl font-bold text-[#2046B3] mb-4">Blog Management</div>
        <!-- Contributor Management -->
        <div class="mb-8">
          <h3 class="text-xl font-bold text-[#2046B3] mb-2">Contributors</h3>
          <table class="w-full bg-white rounded-xl shadow border border-gray-200 mb-2">
            <thead class="bg-[#2046B3] text-white">
              <tr>
                <th class="px-4 py-2 text-left">Name</th>
                <th class="px-4 py-2 text-left">Email</th>
                <th class="px-4 py-2 text-left">Role</th>
                <th class="px-4 py-2 text-left">Status</th>
                <th class="px-4 py-2 text-left">Actions</th>
              </tr>
            </thead>
            <tbody id="contributors-table-body">
              <!-- Contributors will be rendered here -->
            </tbody>
          </table>
          <div class="text-xs text-gray-500">Activity logs and role assignments are for demo only.</div>
        </div>
        <!-- Category/Tag Management -->
        <div class="mb-8">
          <h3 class="text-xl font-bold text-[#2046B3] mb-2">Categories & Tags</h3>
          <form id="add-category-form" class="flex gap-2 mb-2">
            <input type="text" id="new-category" placeholder="Add category" class="px-3 py-2 border rounded" />
            <button type="submit" class="px-4 py-2 bg-[#2046B3] text-white rounded">Add</button>
          </form>
          <div id="categories-list" class="flex flex-wrap gap-2 mb-2"></div>
          <form id="add-tag-form" class="flex gap-2 mb-2">
            <input type="text" id="new-tag" placeholder="Add tag" class="px-3 py-2 border rounded" />
            <button type="submit" class="px-4 py-2 bg-[#2046B3] text-white rounded">Add</button>
          </form>
          <div id="tags-list" class="flex flex-wrap gap-2"></div>
        </div>
        <!-- Search/Filter Bar -->
        <div class="mb-4 flex flex-wrap gap-2 items-center">
          <input type="text" id="blog-search" placeholder="Search by keyword..." class="px-4 py-2 border rounded w-64" />
          <select id="blog-filter-status" class="px-3 py-2 border rounded">
            <option value="">All Statuses</option>
            <option value="Draft">Draft</option>
            <option value="Published">Published</option>
            <option value="Scheduled">Scheduled</option>
          </select>
          <select id="blog-filter-author" class="px-3 py-2 border rounded">
            <option value="">All Authors</option>
          </select>
          <select id="blog-filter-category" class="px-3 py-2 border rounded">
            <option value="">All Categories</option>
          </select>
        </div>
        <div class="mb-6">
          <form id="add-blog-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
            <div>
              <label class="block text-sm font-semibold mb-1">Title</label>
              <input type="text" id="blog-title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2046B3] outline-none" required />
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Author</label>
              <input type="text" id="blog-author" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2046B3] outline-none" required />
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Publish Date</label>
              <input type="date" id="blog-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2046B3] outline-none" required />
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Category</label>
              <input type="text" id="blog-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2046B3] outline-none" placeholder="e.g. Faith, Devotion, Announcements" />
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Tags (comma separated)</label>
              <input type="text" id="blog-tags" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2046B3] outline-none" placeholder="e.g. hope, prayer, testimony" />
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Status</label>
              <select id="blog-status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2046B3] outline-none">
                <option value="Draft">Draft</option>
                <option value="Published">Published</option>
                <option value="Scheduled">Scheduled</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Feature on Homepage</label>
              <input type="checkbox" id="blog-featured" class="form-checkbox h-5 w-5 text-[#2046B3]" />
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-semibold mb-1">Content</label>
              <div id="blog-content" contenteditable="true" class="w-full min-h-[120px] px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2046B3] outline-none bg-white" style="white-space:pre-wrap;"></div>
            </div>
            <div class="md:col-span-2">
              <button type="submit" class="px-8 py-2 bg-[#2046B3] text-white font-bold rounded-lg hover:bg-[#F59E0B] transition-all w-full">Add Blog Post</button>
            </div>
          </form>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full bg-white rounded-xl shadow border border-gray-200">
            <thead class="bg-[#2046B3] text-white">
              <tr>
                <th class="px-4 py-2 text-left">Title</th>
                <th class="px-4 py-2 text-left">Author</th>
                <th class="px-4 py-2 text-left">Date</th>
                <th class="px-4 py-2 text-left">Category</th>
                <th class="px-4 py-2 text-left">Tags</th>
                <th class="px-4 py-2 text-left">Status</th>
                <th class="px-4 py-2 text-left">Featured</th>
                <th class="px-4 py-2 text-left">Views</th>
                <th class="px-4 py-2 text-left">Likes</th>
                <th class="px-4 py-2 text-left">Shares</th>
                <th class="px-4 py-2 text-left">Comments</th>
                <th class="px-4 py-2 text-left">Actions</th>
              </tr>
            </thead>
            <tbody id="blogs-table-body">
              <!-- Blog posts will be rendered here -->
            </tbody>
          </table>
        </div>
        <!-- Blog Comments Modal -->
        <div id="blog-comments-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
          <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-bold text-[#2046B3]">Blog Comments</h3>
              <button onclick="closeBlogCommentsModal()" class="text-gray-400 hover:text-red-500 text-2xl">&times;</button>
            </div>
            <div id="blog-comments-list">
              <ul class="space-y-2">
                <li class="border-b pb-2"><span class="font-bold">Jane Doe:</span> Inspiring post!</li>
                <li class="border-b pb-2"><span class="font-bold">John Smith:</span> Thank you for sharing.</li>
                <li class="border-b pb-2"><span class="font-bold">Mary Wanjiku:</span> Amen!</li>
              </ul>
              <div class="mt-4">
                <textarea class="w-full px-3 py-2 border rounded mb-2" placeholder="Add a comment..."></textarea>
                <button class="px-4 py-2 bg-[#2046B3] text-white rounded font-bold">Post</button>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section id="gallery-section" class="hidden">
  <div class="text-2xl font-bold text-[#7C3AED] mb-4 flex items-center gap-4">
    <i class="fas fa-images"></i>Gallery Management
    <button id="open-upload-modal" class="ml-auto px-4 py-2 bg-[#F59E0B] text-white font-bold rounded-lg hover:bg-[#7C3AED] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-upload"></i>Upload Media
    </button>
    <button id="open-album-modal" class="px-4 py-2 bg-[#7C3AED] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-folder-plus"></i>Add Album
    </button>
    <button id="open-upload-logs" class="px-4 py-2 bg-[#2046B3] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-list"></i>Upload Logs
    </button>
  </div>
  <!-- Tabs: Albums / All Media -->
  <div class="mb-6 flex gap-4">
    <button id="tab-albums" class="gallery-tab px-6 py-2 rounded-t-lg font-bold text-[#7C3AED] bg-white border-b-4 border-[#7C3AED]">Albums</button>
    <button id="tab-media" class="gallery-tab px-6 py-2 rounded-t-lg font-bold text-gray-500 bg-gray-100 border-b-4 border-transparent">All Media</button>
  </div>
  <!-- Albums View -->
  <div id="albums-view">
    <div id="albums-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-8"></div>
  </div>
  <!-- All Media View -->
  <div id="media-view" class="hidden">
    <div class="mb-4 flex flex-wrap gap-2 items-center">
      <input type="text" id="media-search" placeholder="Search media..." class="px-4 py-2 border rounded w-64" />
      <select id="media-filter-album" class="px-3 py-2 border rounded"></select>
      <select id="media-filter-type" class="px-3 py-2 border rounded">
        <option value="">All Types</option>
        <option value="image">Images</option>
        <option value="video">Videos</option>
      </select>
      <select id="media-filter-visibility" class="px-3 py-2 border rounded">
        <option value="">All Visibility</option>
        <option value="public">Public</option>
        <option value="private">Private</option>
      </select>
    </div>
    <div id="media-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
  </div>
  <!-- Modals and Templates will be injected here by JS -->
  <div id="gallery-modals"></div>
</section>
<!-- Gallery Admin Script (injected below main dashboard scripts) -->
<script id="gallery-admin-script">
// Hearts After God Admin Gallery Logic
(function() {
  // --- Data Model ---
  const LS_ALBUMS = 'admin_gallery_albums';
  const LS_MEDIA = 'admin_gallery_media';
  const LS_UPLOAD_LOGS = 'admin_gallery_upload_logs';
  const DEMO_MINISTRIES = ['Youth', 'Worship', 'Outreach', 'Discipleship', 'Children', 'Women', 'Men'];
  const DEMO_EVENTS = ['Sunday Service', 'Youth Camp', 'Crusade', 'Baptism', 'Retreat'];

  // --- Utility Functions ---
  function getAlbums() { return JSON.parse(localStorage.getItem(LS_ALBUMS) || '[]'); }
  function saveAlbums(albums) { localStorage.setItem(LS_ALBUMS, JSON.stringify(albums)); }
  function getMedia() { return JSON.parse(localStorage.getItem(LS_MEDIA) || '[]'); }
  function saveMedia(media) { localStorage.setItem(LS_MEDIA, JSON.stringify(media)); }
  function getUploadLogs() { return JSON.parse(localStorage.getItem(LS_UPLOAD_LOGS) || '[]'); }
  function saveUploadLogs(logs) { localStorage.setItem(LS_UPLOAD_LOGS, JSON.stringify(logs)); }
  function generateId() { return 'id-' + Math.random().toString(36).substr(2, 9); }
  function nowISO() { return new Date().toISOString(); }
  function formatDate(iso) { if (!iso) return ''; const d = new Date(iso); return d.toLocaleDateString() + ' ' + d.toLocaleTimeString(); }

  // --- UI State ---
  let currentAlbumId = null;
  let dragSrcAlbum = null;
  let dragSrcMedia = null;
  let lastTab = 'albums';

  // --- Main Render Functions ---
  function renderAlbums() {
    const albums = getAlbums();
    const media = getMedia();
    const list = document.getElementById('albums-list');
    if (!list) return;
    if (albums.length === 0) {
      list.innerHTML = `<div class='col-span-full text-center text-gray-400 py-12'>No albums yet. <button class='underline text-[#7C3AED]' onclick='window.openAlbumModal()'>Create one</button>.</div>`;
      return;
    }
    list.innerHTML = albums.map((album, idx) => {
      const albumMedia = media.filter(m => m.albumId === album.id);
      const cover = album.coverId ? albumMedia.find(m => m.id === album.coverId) : albumMedia[0];
      return `
      <div class="dashboard-card p-4 flex flex-col gap-3 relative group" draggable="true" data-album-id="${album.id}">
        <div class="absolute top-2 right-2 flex gap-1 z-10">
          <button title="Edit Album" class="text-[#7C3AED] hover:text-[#F59E0B]" onclick="window.openEditAlbumModal('${album.id}')"><i class="fas fa-edit"></i></button>
          <button title="Delete Album" class="text-red-500 hover:text-red-700" onclick="window.deleteAlbum('${album.id}')"><i class="fas fa-trash"></i></button>
          <button title="Reorder" class="cursor-move text-gray-400"><i class="fas fa-arrows-alt"></i></button>
        </div>
        <div class="relative h-40 w-full bg-gray-100 rounded-xl overflow-hidden flex items-center justify-center mb-2">
          ${cover ? (cover.type === 'image' ? `<img src="${cover.url}" alt="cover" class="object-cover w-full h-full">` : `<video src="${cover.url}" class="object-cover w-full h-full"></video>`) : `<span class="text-gray-400">No Cover</span>`}
          <button class="absolute bottom-2 right-2 px-2 py-1 bg-[#F59E0B] text-white text-xs rounded shadow hover:bg-[#7C3AED]" onclick="window.setAlbumCover('${album.id}')">Set Cover</button>
        </div>
        <div class="font-bold text-lg text-[#7C3AED]">${album.name}</div>
        <div class="text-xs text-gray-500 mb-1">${albumMedia.length} items</div>
        <div class="flex flex-wrap gap-1 text-xs mb-1">
          ${album.categories?.map(cat => `<span class="bg-[#F59E0B]/20 text-[#F59E0B] px-2 py-1 rounded">${cat}</span>`).join('') || ''}
        </div>
        <div class="flex gap-2 items-center text-xs">
          <span class="${album.visibility === 'private' ? 'bg-gray-300 text-gray-700' : 'bg-[#7C3AED]/20 text-[#7C3AED]'} px-2 py-1 rounded">${album.visibility === 'private' ? 'Private' : 'Public'}</span>
          <button class="ml-auto px-2 py-1 text-xs rounded ${album.visibility === 'private' ? 'bg-[#7C3AED] text-white' : 'bg-gray-200 text-[#7C3AED]'}" onclick="window.toggleAlbumVisibility('${album.id}')">${album.visibility === 'private' ? 'Make Public' : 'Make Private'}</button>
        </div>
        <button class="mt-2 px-4 py-2 bg-[#2046B3] text-white rounded-lg font-bold hover:bg-[#F59E0B] transition-all" onclick="window.openAlbumMedia('${album.id}')"><i class="fas fa-images mr-2"></i>View Media</button>
      </div>`;
    }).join('');
    // Drag-and-drop for albums
    list.querySelectorAll('[draggable=true]').forEach(card => {
      card.ondragstart = e => { dragSrcAlbum = card.getAttribute('data-album-id'); };
      card.ondragover = e => { e.preventDefault(); card.classList.add('ring-4', 'ring-[#F59E0B]'); };
      card.ondragleave = e => { card.classList.remove('ring-4', 'ring-[#F59E0B]'); };
      card.ondrop = e => {
        card.classList.remove('ring-4', 'ring-[#F59E0B]');
        const targetId = card.getAttribute('data-album-id');
        if (dragSrcAlbum && dragSrcAlbum !== targetId) {
          reorderAlbums(dragSrcAlbum, targetId);
        }
        dragSrcAlbum = null;
      };
    });
  }
  function reorderAlbums(srcId, targetId) {
    let albums = getAlbums();
    const srcIdx = albums.findIndex(a => a.id === srcId);
    const tgtIdx = albums.findIndex(a => a.id === targetId);
    if (srcIdx < 0 || tgtIdx < 0) return;
    const [moved] = albums.splice(srcIdx, 1);
    albums.splice(tgtIdx, 0, moved);
    saveAlbums(albums);
    renderAlbums();
  }
  // --- Tab Switching ---
  document.getElementById('tab-albums').onclick = function() {
    lastTab = 'albums';
    document.getElementById('albums-view').classList.remove('hidden');
    document.getElementById('media-view').classList.add('hidden');
    this.classList.add('text-[#7C3AED]', 'bg-white', 'border-[#7C3AED]');
    document.getElementById('tab-media').classList.remove('text-[#7C3AED]', 'bg-white', 'border-[#7C3AED]');
  };
  document.getElementById('tab-media').onclick = function() {
    lastTab = 'media';
    document.getElementById('albums-view').classList.add('hidden');
    document.getElementById('media-view').classList.remove('hidden');
    this.classList.add('text-[#7C3AED]', 'bg-white', 'border-[#7C3AED]');
    document.getElementById('tab-albums').classList.remove('text-[#7C3AED]', 'bg-white', 'border-[#7C3AED]');
    renderAllMedia();
  };
  // --- Modal Logic ---
  function showModal(html) {
    const modals = document.getElementById('gallery-modals');
    modals.innerHTML = html;
    modals.classList.remove('hidden');
    modals.querySelectorAll('.close-modal').forEach(btn => btn.onclick = closeModal);
    modals.onclick = e => { if (e.target === modals) closeModal(); };
  }
  function closeModal() {
    const modals = document.getElementById('gallery-modals');
    modals.innerHTML = '';
    modals.classList.add('hidden');
  }
  // --- Album CRUD ---
  window.openAlbumModal = function() {
    showModal(`
      <div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'>
        <form class='bg-white rounded-xl shadow-xl w-full max-w-md p-6' id='album-form'>
          <div class='flex items-center justify-between mb-4'>
            <h3 class='text-lg font-bold text-[#7C3AED]'>Create Album</h3>
            <button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button>
          </div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Album Name</label><input type='text' name='name' class='w-full px-3 py-2 border rounded' required></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Description</label><textarea name='desc' class='w-full px-3 py-2 border rounded'></textarea></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Categories (comma separated)</label><input type='text' name='categories' class='w-full px-3 py-2 border rounded'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Visibility</label><select name='visibility' class='w-full px-3 py-2 border rounded'><option value='public'>Public</option><option value='private'>Private</option></select></div>
          <div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded font-bold'>Create</button></div>
        </form>
      </div>
    `);
    document.getElementById('album-form').onsubmit = function(e) {
      e.preventDefault();
      const f = e.target;
      const albums = getAlbums();
      albums.push({ id: generateId(), name: f.name.value, desc: f.desc.value, categories: f.categories.value.split(',').map(s=>s.trim()).filter(Boolean), visibility: f.visibility.value, coverId: null });
      saveAlbums(albums);
      closeModal();
      renderAlbums();
    };
  };
  window.openEditAlbumModal = function(id) {
    const album = getAlbums().find(a => a.id === id);
    if (!album) return;
    showModal(`
      <div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'>
        <form class='bg-white rounded-xl shadow-xl w-full max-w-md p-6' id='album-edit-form'>
          <div class='flex items-center justify-between mb-4'>
            <h3 class='text-lg font-bold text-[#7C3AED]'>Edit Album</h3>
            <button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button>
          </div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Album Name</label><input type='text' name='name' class='w-full px-3 py-2 border rounded' value='${album.name}' required></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Description</label><textarea name='desc' class='w-full px-3 py-2 border rounded'>${album.desc||''}</textarea></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Categories (comma separated)</label><input type='text' name='categories' class='w-full px-3 py-2 border rounded' value='${album.categories?.join(', ')||''}'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Visibility</label><select name='visibility' class='w-full px-3 py-2 border rounded'><option value='public' ${album.visibility==='public'?'selected':''}>Public</option><option value='private' ${album.visibility==='private'?'selected':''}>Private</option></select></div>
          <div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded font-bold'>Save</button></div>
        </form>
      </div>
    `);
    document.getElementById('album-edit-form').onsubmit = function(e) {
      e.preventDefault();
      const f = e.target;
      let albums = getAlbums();
      const idx = albums.findIndex(a => a.id === id);
      if (idx < 0) return;
      albums[idx] = { ...albums[idx], name: f.name.value, desc: f.desc.value, categories: f.categories.value.split(',').map(s=>s.trim()).filter(Boolean), visibility: f.visibility.value };
      saveAlbums(albums);
      closeModal();
      renderAlbums();
    };
  };
  window.deleteAlbum = function(id) {
    if (!confirm('Delete this album and all its media?')) return;
    let albums = getAlbums();
    let media = getMedia();
    albums = albums.filter(a => a.id !== id);
    media = media.filter(m => m.albumId !== id);
    saveAlbums(albums);
    saveMedia(media);
    renderAlbums();
    if (lastTab === 'media') renderAllMedia();
  };
  window.setAlbumCover = function(albumId) {
    // Open modal to pick cover from album media
    const album = getAlbums().find(a => a.id === albumId);
    const media = getMedia().filter(m => m.albumId === albumId);
    if (!album || !media.length) return alert('No media in album');
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><div class='bg-white rounded-xl shadow-xl w-full max-w-lg p-6'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#F59E0B]'>Set Album Cover</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='grid grid-cols-3 gap-4'>${media.map(m => `<div class='relative'><img src='${m.url}' class='rounded shadow'><button class='absolute inset-0 w-full h-full bg-black bg-opacity-10 hover:bg-opacity-30 flex items-center justify-center text-white font-bold text-lg' onclick='window.confirmSetCover("${albumId}","${m.id}")'>Set</button></div>`).join('')}</div></div></div>`);
  };
  window.confirmSetCover = function(albumId, mediaId) {
    let albums = getAlbums();
    const idx = albums.findIndex(a => a.id === albumId);
    if (idx < 0) return;
    albums[idx].coverId = mediaId;
    saveAlbums(albums);
    closeModal();
    renderAlbums();
  };
  window.toggleAlbumVisibility = function(albumId) {
    let albums = getAlbums();
    const idx = albums.findIndex(a => a.id === albumId);
    if (idx < 0) return;
    albums[idx].visibility = albums[idx].visibility === 'private' ? 'public' : 'private';
    saveAlbums(albums);
    renderAlbums();
  };
  window.openAlbumMedia = function(albumId) {
    // Show modal with all media in album, with all controls
    const album = getAlbums().find(a => a.id === albumId);
    const media = getMedia().filter(m => m.albumId === albumId);
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><div class='bg-white rounded-xl shadow-xl w-full max-w-3xl p-6'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#2046B3]'>${album.name} Media</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-4'><button class='px-4 py-2 bg-[#F59E0B] text-white rounded font-bold' onclick='window.openUploadMediaModal("${albumId}")'><i class="fas fa-upload"></i> Upload Media</button></div><div class='grid grid-cols-2 md:grid-cols-3 gap-4' id='album-media-list'>${media.length ? media.map((m, i) => `<div class='relative group bg-gray-50 rounded-xl p-2 flex flex-col gap-2' draggable='true' data-media-id='${m.id}'><div class='absolute top-2 right-2 flex gap-1 z-10'><button title='Edit' class='text-[#7C3AED]' onclick='window.openEditMediaModal("${m.id}")'><i class='fas fa-edit'></i></button><button title='Delete' class='text-red-500' onclick='window.deleteMedia("${m.id}")'><i class='fas fa-trash'></i></button><button title='Reorder' class='cursor-move text-gray-400'><i class='fas fa-arrows-alt'></i></button></div>${m.type === 'image' ? `<img src='${m.url}' class='rounded shadow h-32 w-full object-cover'>` : `<video src='${m.url}' class='rounded shadow h-32 w-full object-cover'></video>`}<div class='font-bold text-sm'>${m.title || '(Untitled)'}</div><div class='text-xs text-gray-500'>${formatDate(m.date)}</div><div class='flex flex-wrap gap-1 text-xs'>${m.tags?.map(t => `<span class='bg-[#F59E0B]/20 text-[#F59E0B] px-2 py-1 rounded'>${t}</span>`).join('') || ''}</div><div class='flex gap-1 text-xs'><span class='${m.visibility === 'private' ? 'bg-gray-300 text-gray-700' : 'bg-[#7C3AED]/20 text-[#7C3AED]'} px-2 py-1 rounded'>${m.visibility === 'private' ? 'Private' : 'Public'}</span><button class='ml-auto px-2 py-1 text-xs rounded ${m.visibility === 'private' ? 'bg-[#7C3AED] text-white' : 'bg-gray-200 text-[#7C3AED]'}' onclick='window.toggleMediaVisibility("${m.id}")'>${m.visibility === 'private' ? 'Make Public' : 'Make Private'}</button></div><div class='flex gap-1 mt-1'><button class='px-2 py-1 bg-[#2046B3] text-white rounded text-xs' onclick='window.downloadMedia("${m.id}")'><i class='fas fa-download'></i> Download</button><button class='px-2 py-1 bg-[#F59E0B] text-white rounded text-xs' onclick='window.setAlbumCover("${albumId}","${m.id}")'><i class='fas fa-star'></i> Set Cover</button></div><div class='flex gap-1 mt-1'>${m.status === 'pending' ? `<button class='px-2 py-1 bg-green-500 text-white rounded text-xs' onclick='window.approveMedia("${m.id}")'>Approve</button><button class='px-2 py-1 bg-red-500 text-white rounded text-xs' onclick='window.rejectMedia("${m.id}")'>Reject</button>` : ''}<button class='px-2 py-1 bg-gray-300 text-gray-700 rounded text-xs' onclick='window.hideMedia("${m.id}")'>${m.hidden ? 'Unhide' : 'Hide'}</button></div></div>`).join('') : `<div class='col-span-full text-center text-gray-400 py-8'>No media yet.</div>`}</div></div></div>`);
    // Drag-and-drop for media
    setTimeout(() => {
      const list = document.getElementById('album-media-list');
      if (!list) return;
      list.querySelectorAll('[draggable=true]').forEach(card => {
        card.ondragstart = e => { dragSrcMedia = card.getAttribute('data-media-id'); };
        card.ondragover = e => { e.preventDefault(); card.classList.add('ring-4', 'ring-[#F59E0B]'); };
        card.ondragleave = e => { card.classList.remove('ring-4', 'ring-[#F59E0B]'); };
        card.ondrop = e => {
          card.classList.remove('ring-4', 'ring-[#F59E0B]');
          const targetId = card.getAttribute('data-media-id');
          if (dragSrcMedia && dragSrcMedia !== targetId) {
            reorderMedia(albumId, dragSrcMedia, targetId);
          }
          dragSrcMedia = null;
        };
      });
    }, 100);
  };
  function reorderMedia(albumId, srcId, targetId) {
    let media = getMedia().filter(m => m.albumId === albumId);
    const srcIdx = media.findIndex(m => m.id === srcId);
    const tgtIdx = media.findIndex(m => m.id === targetId);
    if (srcIdx < 0 || tgtIdx < 0) return;
    const [moved] = media.splice(srcIdx, 1);
    media.splice(tgtIdx, 0, moved);
    // Save new order
    let allMedia = getMedia();
    allMedia = allMedia.filter(m => m.albumId !== albumId).concat(media);
    saveMedia(allMedia);
    window.openAlbumMedia(albumId);
  }
  // --- Media CRUD ---
  window.openUploadMediaModal = function(albumId) {
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-lg p-6' id='media-upload-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#F59E0B]'>Upload Media</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Select Files</label><input type='file' name='files' multiple accept='image/*,video/*' class='w-full px-3 py-2 border rounded' required></div><div class='mb-3'><label class='block font-semibold mb-1'>Tags (comma separated)</label><input type='text' name='tags' class='w-full px-3 py-2 border rounded'></div><div class='mb-3'><label class='block font-semibold mb-1'>Associated Event</label><select name='event' class='w-full px-3 py-2 border rounded'><option value=''>None</option>${DEMO_EVENTS.map(ev => `<option value='${ev}'>${ev}</option>`).join('')}</select></div><div class='mb-3'><label class='block font-semibold mb-1'>Associated Ministry</label><select name='ministry' class='w-full px-3 py-2 border rounded'><option value=''>None</option>${DEMO_MINISTRIES.map(m => `<option value='${m}'>${m}</option>`).join('')}</select></div><div class='mb-3'><label class='block font-semibold mb-1'>Visibility</label><select name='visibility' class='w-full px-3 py-2 border rounded'><option value='public'>Public</option><option value='private'>Private</option></select></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#F59E0B] text-white rounded font-bold'>Upload</button></div></form></div></div>`);
    document.getElementById('media-upload-form').onsubmit = function(e) {
      e.preventDefault();
      const f = e.target;
      const files = f.files.files;
      if (!files.length) return;
      let media = getMedia();
      let logs = getUploadLogs();
      for (let file of files) {
        const id = generateId();
        const url = URL.createObjectURL(file);
        const type = file.type.startsWith('image') ? 'image' : 'video';
        media.push({ id, albumId, url, type, title: file.name, caption: '', date: nowISO(), tags: f.tags.value.split(',').map(s=>s.trim()).filter(Boolean), event: f.event.value, ministry: f.ministry.value, visibility: f.visibility.value, status: 'approved', hidden: false, uploader: 'Admin', uploadDate: nowISO() });
        logs.push({ id: generateId(), file: file.name, uploader: 'Admin', date: nowISO(), album: getAlbums().find(a => a.id === albumId)?.name || '', status: 'Uploaded' });
      }
      saveMedia(media);
      saveUploadLogs(logs);
      closeModal();
      window.openAlbumMedia(albumId);
      if (lastTab === 'media') renderAllMedia();
    };
  };
  window.openEditMediaModal = function(mediaId) {
    const m = getMedia().find(m => m.id === mediaId);
    if (!m) return;
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-lg p-6' id='media-edit-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#7C3AED]'>Edit Media</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Title</label><input type='text' name='title' class='w-full px-3 py-2 border rounded' value='${m.title||''}'></div><div class='mb-3'><label class='block font-semibold mb-1'>Caption</label><textarea name='caption' class='w-full px-3 py-2 border rounded'>${m.caption||''}</textarea></div><div class='mb-3'><label class='block font-semibold mb-1'>Tags (comma separated)</label><input type='text' name='tags' class='w-full px-3 py-2 border rounded' value='${m.tags?.join(', ')||''}'></div><div class='mb-3'><label class='block font-semibold mb-1'>Associated Event</label><select name='event' class='w-full px-3 py-2 border rounded'><option value=''>None</option>${DEMO_EVENTS.map(ev => `<option value='${ev}' ${m.event===ev?'selected':''}>${ev}</option>`).join('')}</select></div><div class='mb-3'><label class='block font-semibold mb-1'>Associated Ministry</label><select name='ministry' class='w-full px-3 py-2 border rounded'><option value=''>None</option>${DEMO_MINISTRIES.map(min => `<option value='${min}' ${m.ministry===min?'selected':''}>${min}</option>`).join('')}</select></div><div class='mb-3'><label class='block font-semibold mb-1'>Visibility</label><select name='visibility' class='w-full px-3 py-2 border rounded'><option value='public' ${m.visibility==='public'?'selected':''}>Public</option><option value='private' ${m.visibility==='private'?'selected':''}>Private</option></select></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded font-bold'>Save</button></div></form></div></div>`);
    document.getElementById('media-edit-form').onsubmit = function(e) {
      e.preventDefault();
      let media = getMedia();
      const idx = media.findIndex(x => x.id === mediaId);
      if (idx < 0) return;
      const f = e.target;
      media[idx] = { ...media[idx], title: f.title.value, caption: f.caption.value, tags: f.tags.value.split(',').map(s=>s.trim()).filter(Boolean), event: f.event.value, ministry: f.ministry.value, visibility: f.visibility.value };
      saveMedia(media);
      closeModal();
      if (lastTab === 'media') renderAllMedia();
      else window.openAlbumMedia(media[idx].albumId);
    };
  };
  window.deleteMedia = function(mediaId) {
    if (!confirm('Delete this media?')) return;
    let media = getMedia();
    media = media.filter(m => m.id !== mediaId);
    saveMedia(media);
    closeModal();
    if (lastTab === 'media') renderAllMedia();
    else renderAlbums();
  };
  window.toggleMediaVisibility = function(mediaId) {
    let media = getMedia();
    const idx = media.findIndex(m => m.id === mediaId);
    if (idx < 0) return;
    media[idx].visibility = media[idx].visibility === 'private' ? 'public' : 'private';
    saveMedia(media);
    if (lastTab === 'media') renderAllMedia();
    else window.openAlbumMedia(media[idx].albumId);
  };
  window.downloadMedia = function(mediaId) {
    const m = getMedia().find(m => m.id === mediaId);
    if (!m) return;
    const a = document.createElement('a');
    a.href = m.url;
    a.download = m.title || 'media';
    document.body.appendChild(a);
    a.click();
    a.remove();
  };
  window.approveMedia = function(mediaId) {
    let media = getMedia();
    const idx = media.findIndex(m => m.id === mediaId);
    if (idx < 0) return;
    media[idx].status = 'approved';
    saveMedia(media);
    if (lastTab === 'media') renderAllMedia();
    else window.openAlbumMedia(media[idx].albumId);
  };
  window.rejectMedia = function(mediaId) {
    let media = getMedia();
    const idx = media.findIndex(m => m.id === mediaId);
    if (idx < 0) return;
    media[idx].status = 'rejected';
    saveMedia(media);
    if (lastTab === 'media') renderAllMedia();
    else window.openAlbumMedia(media[idx].albumId);
  };
  window.hideMedia = function(mediaId) {
    let media = getMedia();
    const idx = media.findIndex(m => m.id === mediaId);
    if (idx < 0) return;
    media[idx].hidden = !media[idx].hidden;
    saveMedia(media);
    if (lastTab === 'media') renderAllMedia();
    else window.openAlbumMedia(media[idx].albumId);
  };
  // --- All Media Tab ---
  function renderAllMedia() {
    const media = getMedia();
    const list = document.getElementById('media-list');
    if (!list) return;
    let filtered = media;
    const albumSel = document.getElementById('media-filter-album');
    const typeSel = document.getElementById('media-filter-type');
    const visSel = document.getElementById('media-filter-visibility');
    const search = document.getElementById('media-search');
    // Populate album filter
    const albums = getAlbums();
    albumSel.innerHTML = `<option value=''>All Albums</option>` + albums.map(a => `<option value='${a.id}'>${a.name}</option>`).join('');
    // Filtering
    if (albumSel.value) filtered = filtered.filter(m => m.albumId === albumSel.value);
    if (typeSel.value) filtered = filtered.filter(m => m.type === typeSel.value);
    if (visSel.value) filtered = filtered.filter(m => m.visibility === visSel.value);
    if (search.value) filtered = filtered.filter(m => (m.title||'').toLowerCase().includes(search.value.toLowerCase()) || (m.tags||[]).join(',').toLowerCase().includes(search.value.toLowerCase()));
    list.innerHTML = filtered.length ? filtered.map(m => `<div class='dashboard-card p-3 flex flex-col gap-2 relative group'><div class='absolute top-2 right-2 flex gap-1 z-10'><button title='Edit' class='text-[#7C3AED]' onclick='window.openEditMediaModal("${m.id}")'><i class='fas fa-edit'></i></button><button title='Delete' class='text-red-500' onclick='window.deleteMedia("${m.id}")'><i class='fas fa-trash'></i></button></div>${m.type === 'image' ? `<img src='${m.url}' class='rounded shadow h-32 w-full object-cover'>` : `<video src='${m.url}' class='rounded shadow h-32 w-full object-cover'></video>`}<div class='font-bold text-sm'>${m.title || '(Untitled)'}</div><div class='text-xs text-gray-500'>${formatDate(m.date)}</div><div class='flex flex-wrap gap-1 text-xs'>${m.tags?.map(t => `<span class='bg-[#F59E0B]/20 text-[#F59E0B] px-2 py-1 rounded'>${t}</span>`).join('') || ''}</div><div class='flex gap-1 text-xs'><span class='${m.visibility === 'private' ? 'bg-gray-300 text-gray-700' : 'bg-[#7C3AED]/20 text-[#7C3AED]'} px-2 py-1 rounded'>${m.visibility === 'private' ? 'Private' : 'Public'}</span><button class='ml-auto px-2 py-1 text-xs rounded ${m.visibility === 'private' ? 'bg-[#7C3AED] text-white' : 'bg-gray-200 text-[#7C3AED]'}' onclick='window.toggleMediaVisibility("${m.id}")'>${m.visibility === 'private' ? 'Make Public' : 'Make Private'}</button></div><div class='flex gap-1 mt-1'><button class='px-2 py-1 bg-[#2046B3] text-white rounded text-xs' onclick='window.downloadMedia("${m.id}")'><i class='fas fa-download'></i> Download</button></div><div class='flex gap-1 mt-1'>${m.status === 'pending' ? `<button class='px-2 py-1 bg-green-500 text-white rounded text-xs' onclick='window.approveMedia("${m.id}")'>Approve</button><button class='px-2 py-1 bg-red-500 text-white rounded text-xs' onclick='window.rejectMedia("${m.id}")'>Reject</button>` : ''}<button class='px-2 py-1 bg-gray-300 text-gray-700 rounded text-xs' onclick='window.hideMedia("${m.id}")'>${m.hidden ? 'Unhide' : 'Hide'}</button></div></div>`).join('') : `<div class='col-span-full text-center text-gray-400 py-8'>No media found.</div>`;
  }
  document.getElementById('media-search').oninput = renderAllMedia;
  document.getElementById('media-filter-album').onchange = renderAllMedia;
  document.getElementById('media-filter-type').onchange = renderAllMedia;
  document.getElementById('media-filter-visibility').onchange = renderAllMedia;
  // --- Upload Logs ---
  document.getElementById('open-upload-logs').onclick = function() {
    const logs = getUploadLogs();
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><div class='bg-white rounded-xl shadow-xl w-full max-w-2xl p-6'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#2046B3]'>Upload Logs</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='overflow-x-auto'><table class='w-full bg-white rounded-xl shadow border border-gray-200'><thead class='bg-[#2046B3] text-white'><tr><th class='px-4 py-2 text-left'>File</th><th class='px-4 py-2 text-left'>Uploader</th><th class='px-4 py-2 text-left'>Date</th><th class='px-4 py-2 text-left'>Album</th><th class='px-4 py-2 text-left'>Status</th></tr></thead><tbody>${logs.length ? logs.map(l => `<tr><td class='px-4 py-2'>${l.file}</td><td class='px-4 py-2'>${l.uploader}</td><td class='px-4 py-2'>${formatDate(l.date)}</td><td class='px-4 py-2'>${l.album}</td><td class='px-4 py-2'>${l.status}</td></tr>`).join('') : `<tr><td colspan='5' class='text-center text-gray-400 py-6'>No logs yet.</td></tr>`}</tbody></table></div></div></div>`);
  };
  // --- Bulk Upload Button ---
  document.getElementById('open-upload-modal').onclick = function() {
    // Pick album first
    const albums = getAlbums();
    if (!albums.length) return alert('Create an album first!');
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-lg p-6' id='bulk-upload-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#F59E0B]'>Bulk Upload Media</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Select Album</label><select name='album' class='w-full px-3 py-2 border rounded' required>${albums.map(a => `<option value='${a.id}'>${a.name}</option>`).join('')}</select></div><div class='mb-3'><label class='block font-semibold mb-1'>Select Files</label><input type='file' name='files' multiple accept='image/*,video/*' class='w-full px-3 py-2 border rounded' required></div><div class='mb-3'><label class='block font-semibold mb-1'>Tags (comma separated)</label><input type='text' name='tags' class='w-full px-3 py-2 border rounded'></div><div class='mb-3'><label class='block font-semibold mb-1'>Associated Event</label><select name='event' class='w-full px-3 py-2 border rounded'><option value=''>None</option>${DEMO_EVENTS.map(ev => `<option value='${ev}'>${ev}</option>`).join('')}</select></div><div class='mb-3'><label class='block font-semibold mb-1'>Associated Ministry</label><select name='ministry' class='w-full px-3 py-2 border rounded'><option value=''>None</option>${DEMO_MINISTRIES.map(m => `<option value='${m}'>${m}</option>`).join('')}</select></div><div class='mb-3'><label class='block font-semibold mb-1'>Visibility</label><select name='visibility' class='w-full px-3 py-2 border rounded'><option value='public'>Public</option><option value='private'>Private</option></select></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#F59E0B] text-white rounded font-bold'>Upload</button></div></form></div></div>`);
    document.getElementById('bulk-upload-form').onsubmit = function(e) {
      e.preventDefault();
      const f = e.target;
      const albumId = f.album.value;
      const files = f.files.files;
      if (!files.length) return;
      let media = getMedia();
      let logs = getUploadLogs();
      for (let file of files) {
        const id = generateId();
        const url = URL.createObjectURL(file);
        const type = file.type.startsWith('image') ? 'image' : 'video';
        media.push({ id, albumId, url, type, title: file.name, caption: '', date: nowISO(), tags: f.tags.value.split(',').map(s=>s.trim()).filter(Boolean), event: f.event.value, ministry: f.ministry.value, visibility: f.visibility.value, status: 'approved', hidden: false, uploader: 'Admin', uploadDate: nowISO() });
        logs.push({ id: generateId(), file: file.name, uploader: 'Admin', date: nowISO(), album: getAlbums().find(a => a.id === albumId)?.name || '', status: 'Uploaded' });
      }
      saveMedia(media);
      saveUploadLogs(logs);
      closeModal();
      renderAlbums();
      if (lastTab === 'media') renderAllMedia();
    };
  };
  // --- Add Album Button ---
  document.getElementById('open-album-modal').onclick = window.openAlbumModal;
  // --- Initial Render ---
  renderAlbums();
})();
</script>

  <script>
      // Sermons CRUD logic (localStorage demo, with analytics, approval, feature, archive, download)
      let sermonFilter = 'all';
      function getSermons() {
        return JSON.parse(localStorage.getItem('admin_sermons') || '[]');
      }
      function saveSermons(sermons) {
        localStorage.setItem('admin_sermons', JSON.stringify(sermons));
      }
      function renderSermons() {
        const tbody = document.getElementById('sermons-table-body');
        if (!tbody) return;
        let sermons = getSermons();
        if (sermonFilter === 'archived') sermons = sermons.filter(s => s.archived);
        if (sermonFilter === 'all') sermons = sermons;
        tbody.innerHTML = sermons.length === 0 ? '<tr><td colspan="19" class="text-center text-gray-400 py-6">No sermons yet.</td></tr>' :
          sermons.map((s, i) => `
            <tr>
              <td class="px-4 py-2">${s.title}</td>
              <td class="px-4 py-2">${s.speaker}</td>
              <td class="px-4 py-2">${s.date}</td>
              <td class="px-4 py-2">${s.category}</td>
              <td class="px-4 py-2">${s.tags}</td>
              <td class="px-4 py-2">
                <label class="inline-flex items-center cursor-pointer">
                  <input type="checkbox" onchange="togglePublishSermon(${i})" ${s.status === 'Published' ? 'checked' : ''} class="form-checkbox h-5 w-5 text-[#7C3AED]">
                  <span class="ml-2 text-xs">${s.status}</span>
                </label>
              </td>
              <td class="px-4 py-2">
                <span class="text-xs font-bold">${s.approval || 'Pending'}</span>
                ${s.approval === 'Pending' ? `<button onclick="approveSermon(${i})" class="ml-2 px-2 py-1 bg-green-500 text-white rounded text-xs">Approve</button><button onclick="rejectSermon(${i})" class="ml-2 px-2 py-1 bg-red-500 text-white rounded text-xs">Reject</button>` : ''}
              </td>
              <td class="px-4 py-2">
                <button onclick="toggleFeatureSermon(${i})" class="px-2 py-1 ${s.featured ? 'bg-[#7C3AED] text-white' : 'bg-gray-200 text-[#7C3AED]'} rounded text-xs font-bold">${s.featured ? 'Featured' : 'Feature'}</button>
              </td>
              <td class="px-4 py-2">
                <button onclick="toggleArchiveSermon(${i})" class="px-2 py-1 ${s.archived ? 'bg-[#7C3AED] text-white' : 'bg-gray-200 text-[#7C3AED]'} rounded text-xs font-bold">${s.archived ? 'Archived' : 'Archive'}</button>
              </td>
              <td class="px-4 py-2">${s.media ? `<span class='block text-xs'>${s.media}</span>` : ''}</td>
              <td class="px-4 py-2">${s.notes ? `<span class='block text-xs'>${s.notes}</span>` : ''}</td>
              <td class="px-4 py-2">${s.resources && s.resources.length ? s.resources.map(f => `<span class='block text-xs'>${f}</span>`).join('') : ''}</td>
              <td class="px-4 py-2">${s.bible || ''}</td>
              <td class="px-4 py-2">${s.analytics?.views ?? Math.floor(Math.random()*100)}</td>
              <td class="px-4 py-2">${s.analytics?.listens ?? Math.floor(Math.random()*50)}</td>
              <td class="px-4 py-2">${s.analytics?.downloads ?? Math.floor(Math.random()*20)}</td>
              <td class="px-4 py-2">${s.analytics?.engagement ?? Math.floor(Math.random()*10)}%</td>
              <td class="px-4 py-2"><button onclick="showSermonCommentsModal(${i})" class="px-2 py-1 bg-[#7C3AED] text-white rounded text-xs font-bold">Comments</button></td>
              <td class="px-4 py-2">
                <button onclick="editSermon(${i})" class="text-[#7C3AED] font-bold hover:underline mr-2">Edit</button>
                <button onclick="deleteSermon(${i})" class="text-red-600 font-bold hover:underline">Delete</button>
                <button onclick="downloadSermon(${i})" class="ml-2 px-2 py-1 bg-[#F59E0B] text-white rounded text-xs font-bold">Download</button>
              </td>
            </tr>
          `).join('');
      }
      function filterSermons(type) {
        sermonFilter = type;
        renderSermons();
      }
      document.getElementById('add-sermon-form')?.addEventListener('submit', function(e) {
        e.preventDefault();
        const title = document.getElementById('sermon-title').value.trim();
        const speaker = document.getElementById('sermon-speaker').value.trim();
        const date = document.getElementById('sermon-date').value;
        const category = document.getElementById('sermon-category').value;
        const tags = document.getElementById('sermon-tags').value.trim();
        const description = document.getElementById('sermon-description').value.trim();
        const mediaInput = document.getElementById('sermon-media');
        const notesInput = document.getElementById('sermon-notes');
        const resourcesInput = document.getElementById('sermon-resources');
        const bible = document.getElementById('sermon-bible').value.trim();
        const status = document.getElementById('sermon-status').value;
        const featured = document.getElementById('sermon-featured').checked;
        const archived = document.getElementById('sermon-archived').checked;
        const media = mediaInput.files[0] ? mediaInput.files[0].name : '';
        const notes = notesInput.files[0] ? notesInput.files[0].name : '';
        const resources = resourcesInput.files.length ? Array.from(resourcesInput.files).map(f => f.name) : [];
        if (!title || !speaker || !date) return;
        const sermons = getSermons();
        sermons.push({ title, speaker, date, category, tags, description, media, notes, resources, bible, status, featured, archived, approval: 'Pending', analytics: { views: Math.floor(Math.random()*100), listens: Math.floor(Math.random()*50), downloads: Math.floor(Math.random()*20), engagement: Math.floor(Math.random()*10) } });
        saveSermons(sermons);
        renderSermons();
        this.reset();
      });
      window.deleteSermon = function(idx) {
        if (!confirm('Delete this sermon?')) return;
        const sermons = getSermons();
        sermons.splice(idx, 1);
        saveSermons(sermons);
        renderSermons();
      };
      window.editSermon = function(idx) {
        const sermons = getSermons();
        const s = sermons[idx];
        document.getElementById('sermon-title').value = s.title;
        document.getElementById('sermon-speaker').value = s.speaker;
        document.getElementById('sermon-date').value = s.date;
        document.getElementById('sermon-category').value = s.category;
        document.getElementById('sermon-tags').value = s.tags;
        document.getElementById('sermon-description').value = s.description;
        document.getElementById('sermon-bible').value = s.bible;
        document.getElementById('sermon-status').value = s.status;
        document.getElementById('sermon-featured').checked = !!s.featured;
        document.getElementById('sermon-archived').checked = !!s.archived;
        // File inputs cannot be set for security reasons; show file names only
        // Remove the old one so submit will add as new
        sermons.splice(idx, 1);
        saveSermons(sermons);
        renderSermons();
      };
      window.togglePublishSermon = function(idx) {
        const sermons = getSermons();
        sermons[idx].status = sermons[idx].status === 'Published' ? 'Draft' : 'Published';
        saveSermons(sermons);
        renderSermons();
      };
      window.toggleFeatureSermon = function(idx) {
        const sermons = getSermons();
        sermons[idx].featured = !sermons[idx].featured;
        saveSermons(sermons);
        renderSermons();
      };
      window.toggleArchiveSermon = function(idx) {
        const sermons = getSermons();
        sermons[idx].archived = !sermons[idx].archived;
        saveSermons(sermons);
        renderSermons();
      };
      window.approveSermon = function(idx) {
        const sermons = getSermons();
        sermons[idx].approval = 'Approved';
        saveSermons(sermons);
        renderSermons();
      };
      window.rejectSermon = function(idx) {
        const sermons = getSermons();
        sermons[idx].approval = 'Rejected';
        saveSermons(sermons);
        renderSermons();
      };
      window.downloadSermon = function(idx) {
        const sermons = getSermons();
        const s = sermons[idx];
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(s, null, 2));
        const dlAnchor = document.createElement('a');
        dlAnchor.setAttribute("href", dataStr);
        dlAnchor.setAttribute("download", `${s.title.replace(/\s+/g,'_')}_sermon.json`);
        document.body.appendChild(dlAnchor);
        dlAnchor.click();
        dlAnchor.remove();
      };
      window.showSermonCommentsModal = function(idx) {
        document.getElementById('sermon-comments-modal').classList.remove('hidden');
      };
      window.closeSermonCommentsModal = function() {
        document.getElementById('sermon-comments-modal').classList.add('hidden');
      };
      // Render on load if section exists
      if (document.getElementById('sermons-table-body')) renderSermons();

      // Events CRUD logic (localStorage demo, with file name storage, publish toggle, CTA)
      function getEvents() {
        return JSON.parse(localStorage.getItem('admin_events') || '[]');
      }
      function saveEvents(events) {
        localStorage.setItem('admin_events', JSON.stringify(events));
      }
      function renderEvents() {
        const tbody = document.getElementById('events-table-body');
        if (!tbody) return;
        const events = getEvents();
        tbody.innerHTML = events.length === 0 ? '<tr><td colspan="11" class="text-center text-gray-400 py-6">No events yet.</td></tr>' :
          events.map((e, i) => `
            <tr>
              <td class="px-4 py-2">${e.title}</td>
              <td class="px-4 py-2">${e.date}</td>
              <td class="px-4 py-2">${e.time}</td>
              <td class="px-4 py-2">${e.venue}</td>
              <td class="px-4 py-2">${e.status}</td>
              <td class="px-4 py-2">
                <label class="inline-flex items-center cursor-pointer">
                  <input type="checkbox" onchange="togglePublishEvent(${i})" ${e.published ? 'checked' : ''} class="form-checkbox h-5 w-5 text-[#F59E0B]">
                  <span class="ml-2 text-xs">${e.published ? 'Published' : 'Unpublished'}</span>
                </label>
              </td>
              <td class="px-4 py-2">
                <button onclick="showRegistrationsModal(${i})" class="px-3 py-1 bg-[#F59E0B] text-white rounded text-xs font-bold hover:bg-[#7C3AED]">Registrations</button>
              </td>
              <td class="px-4 py-2">
                <div class="text-xs">Views: ${e.analytics?.views || 0}</div>
                <div class="text-xs">Regs: ${e.analytics?.registrations || 0}</div>
              </td>
              <td class="px-4 py-2">
                ${e.image ? `<span class='block text-xs'>${e.image}</span>` : ''}
                ${e.attachments && e.attachments.length ? e.attachments.map(f => `<span class='block text-xs'>${f}</span>`).join('') : ''}
              </td>
              <td class="px-4 py-2">
                ${e.ctaLabel && e.ctaLink ? `<a href="${e.ctaLink}" target="_blank" class="px-3 py-1 bg-[#7C3AED] text-white rounded text-xs font-bold hover:bg-[#F59E0B]">${e.ctaLabel}</a>` : ''}
              </td>
              <td class="px-4 py-2">
                <button onclick="editEvent(${i})" class="text-[#F59E0B] font-bold hover:underline mr-2">Edit</button>
                <button onclick="deleteEvent(${i})" class="text-red-600 font-bold hover:underline">Delete</button>
              </td>
            </tr>
          `).join('');
      }
      document.getElementById('add-event-form')?.addEventListener('submit', function(e) {
        e.preventDefault();
        const title = document.getElementById('event-title').value.trim();
        const date = document.getElementById('event-date').value;
        const time = document.getElementById('event-time').value;
        const venue = document.getElementById('event-venue').value.trim();
        const theme = document.getElementById('event-theme').value.trim();
        const speaker = document.getElementById('event-speaker').value.trim();
        const status = document.getElementById('event-status').value;
        const ministry = document.getElementById('event-ministry').value.trim();
        const tags = document.getElementById('event-tags').value.trim();
        const description = document.getElementById('event-description').value.trim();
        const imageInput = document.getElementById('event-image');
        const attachmentsInput = document.getElementById('event-attachments');
        const ctaLabel = document.getElementById('event-cta-label').value.trim();
        const ctaLink = document.getElementById('event-cta-link').value.trim();
        const image = imageInput.files[0] ? imageInput.files[0].name : '';
        const attachments = attachmentsInput.files.length ? Array.from(attachmentsInput.files).map(f => f.name) : [];
        if (!title || !date || !time || !venue) return;
        const events = getEvents();
        events.push({ title, date, time, venue, theme, speaker, status, ministry, tags, description, image, attachments, published: false, analytics: { views: Math.floor(Math.random()*100), registrations: Math.floor(Math.random()*30) }, ctaLabel, ctaLink });
        saveEvents(events);
        renderEvents();
        this.reset();
      });
      window.deleteEvent = function(idx) {
        if (!confirm('Delete this event?')) return;
        const events = getEvents();
        events.splice(idx, 1);
        saveEvents(events);
        renderEvents();
      };
      window.editEvent = function(idx) {
        const events = getEvents();
        const e = events[idx];
        document.getElementById('event-title').value = e.title;
        document.getElementById('event-date').value = e.date;
        document.getElementById('event-time').value = e.time;
        document.getElementById('event-venue').value = e.venue;
        document.getElementById('event-theme').value = e.theme;
        document.getElementById('event-speaker').value = e.speaker;
        document.getElementById('event-status').value = e.status;
        document.getElementById('event-ministry').value = e.ministry;
        document.getElementById('event-tags').value = e.tags;
        document.getElementById('event-description').value = e.description;
        document.getElementById('event-cta-label').value = e.ctaLabel || '';
        document.getElementById('event-cta-link').value = e.ctaLink || '';
        // File inputs cannot be set for security reasons; show file names only
        // Remove the old one so submit will add as new
        events.splice(idx, 1);
        saveEvents(events);
        renderEvents();
      };
      window.togglePublishEvent = function(idx) {
        const events = getEvents();
        events[idx].published = !events[idx].published;
        saveEvents(events);
        renderEvents();
      };
      window.showRegistrationsModal = function(idx) {
        document.getElementById('event-registrations-modal').classList.remove('hidden');
      };
      window.closeRegistrationsModal = function() {
        document.getElementById('event-registrations-modal').classList.add('hidden');
      };
      // Render on load if section exists
      if (document.getElementById('events-table-body')) renderEvents();

      // Blog advanced admin logic (localStorage demo)
      function getContributors() {
        return JSON.parse(localStorage.getItem('admin_blog_contributors') || '[]');
      }
      function saveContributors(contributors) {
        localStorage.setItem('admin_blog_contributors', JSON.stringify(contributors));
      }
      function renderContributors() {
        const tbody = document.getElementById('contributors-table-body');
        if (!tbody) return;
        const contributors = getContributors();
        tbody.innerHTML = contributors.length === 0 ? '<tr><td colspan="5" class="text-center text-gray-400 py-6">No contributors yet.</td></tr>' :
          contributors.map((c, i) => `
            <tr>
              <td class="px-4 py-2">${c.name}</td>
              <td class="px-4 py-2">${c.email}</td>
              <td class="px-4 py-2">${c.role}</td>
              <td class="px-4 py-2">${c.status}</td>
              <td class="px-4 py-2">
                ${c.status === 'Pending' ? `<button onclick="approveContributor(${i})" class="px-2 py-1 bg-green-500 text-white rounded text-xs">Approve</button><button onclick="rejectContributor(${i})" class="ml-2 px-2 py-1 bg-red-500 text-white rounded text-xs">Reject</button>` : ''}
              </td>
            </tr>
          `).join('');
      }
      window.approveContributor = function(idx) {
        const contributors = getContributors();
        contributors[idx].status = 'Approved';
        saveContributors(contributors);
        renderContributors();
      };
      window.rejectContributor = function(idx) {
        const contributors = getContributors();
        contributors[idx].status = 'Rejected';
        saveContributors(contributors);
        renderContributors();
      };
      // Category/Tag logic
      function getCategories() {
        return JSON.parse(localStorage.getItem('admin_blog_categories') || '[]');
      }
      function saveCategories(categories) {
        localStorage.setItem('admin_blog_categories', JSON.stringify(categories));
      }
      function renderCategories() {
        const list = document.getElementById('categories-list');
        if (!list) return;
        const categories = getCategories();
        list.innerHTML = categories.map((cat, i) => `<span class="bg-[#2046B3] text-white px-3 py-1 rounded">${cat} <button onclick="deleteCategory(${i})" class="ml-1 text-xs">&times;</button></span>`).join(' ');
        // Update filter dropdown
        const filter = document.getElementById('blog-filter-category');
        if (filter) {
          filter.innerHTML = '<option value="">All Categories</option>' + categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }
      }
      window.deleteCategory = function(idx) {
        const categories = getCategories();
        categories.splice(idx, 1);
        saveCategories(categories);
        renderCategories();
      };
      document.getElementById('add-category-form')?.addEventListener('submit', function(e) {
        e.preventDefault();
        const val = document.getElementById('new-category').value.trim();
        if (!val) return;
        const categories = getCategories();
        categories.push(val);
        saveCategories(categories);
        renderCategories();
        this.reset();
      });
      function getTags() {
        return JSON.parse(localStorage.getItem('admin_blog_tags') || '[]');
      }
      function saveTags(tags) {
        localStorage.setItem('admin_blog_tags', JSON.stringify(tags));
      }
      function renderTags() {
        const list = document.getElementById('tags-list');
        if (!list) return;
        const tags = getTags();
        list.innerHTML = tags.map((tag, i) => `<span class="bg-[#F59E0B] text-white px-3 py-1 rounded">${tag} <button onclick="deleteTag(${i})" class="ml-1 text-xs">&times;</button></span>`).join(' ');
      }
      window.deleteTag = function(idx) {
        const tags = getTags();
        tags.splice(idx, 1);
        saveTags(tags);
        renderTags();
      };
      document.getElementById('add-tag-form')?.addEventListener('submit', function(e) {
        e.preventDefault();
        const val = document.getElementById('new-tag').value.trim();
        if (!val) return;
        const tags = getTags();
        tags.push(val);
        saveTags(tags);
        renderTags();
        this.reset();
      });
      // Blog CRUD logic (localStorage demo, with rich-text, feature, publish/unpublish, analytics, comments, search/filter)
      function getBlogs() {
        return JSON.parse(localStorage.getItem('admin_blogs') || '[]');
      }
      function saveBlogs(blogs) {
        localStorage.setItem('admin_blogs', JSON.stringify(blogs));
      }
      function renderBlogs() {
        const tbody = document.getElementById('blogs-table-body');
        if (!tbody) return;
        let blogs = getBlogs();
        // Filtering
        const search = document.getElementById('blog-search')?.value.toLowerCase() || '';
        const status = document.getElementById('blog-filter-status')?.value || '';
        const author = document.getElementById('blog-filter-author')?.value || '';
        const category = document.getElementById('blog-filter-category')?.value || '';
        if (search) blogs = blogs.filter(b => b.title.toLowerCase().includes(search) || b.content.toLowerCase().includes(search));
        if (status) blogs = blogs.filter(b => b.status === status);
        if (author) blogs = blogs.filter(b => b.author === author);
        if (category) blogs = blogs.filter(b => b.category === category);
        // Populate author filter
        const authorFilter = document.getElementById('blog-filter-author');
        if (authorFilter) {
          const authors = Array.from(new Set(getBlogs().map(b => b.author)));
          authorFilter.innerHTML = '<option value="">All Authors</option>' + authors.map(a => `<option value="${a}">${a}</option>`).join('');
        }
        tbody.innerHTML = blogs.length === 0 ? '<tr><td colspan="12" class="text-center text-gray-400 py-6">No blog posts yet.</td></tr>' :
          blogs.map((b, i) => `
            <tr>
              <td class="px-4 py-2">${b.title}</td>
              <td class="px-4 py-2">${b.author}</td>
              <td class="px-4 py-2">${b.date}</td>
              <td class="px-4 py-2">${b.category}</td>
              <td class="px-4 py-2">${b.tags}</td>
              <td class="px-4 py-2">
                <label class="inline-flex items-center cursor-pointer">
                  <input type="checkbox" onchange="togglePublishBlog(${i})" ${b.status === 'Published' ? 'checked' : ''} class="form-checkbox h-5 w-5 text-[#2046B3]">
                  <span class="ml-2 text-xs">${b.status}</span>
                </label>
              </td>
              <td class="px-4 py-2">
                <button onclick="toggleFeatureBlog(${i})" class="px-2 py-1 ${b.featured ? 'bg-[#2046B3] text-white' : 'bg-gray-200 text-[#2046B3]'} rounded text-xs font-bold">${b.featured ? 'Featured' : 'Feature'}</button>
              </td>
              <td class="px-4 py-2">${b.analytics?.views ?? Math.floor(Math.random()*100)}</td>
              <td class="px-4 py-2">${b.analytics?.likes ?? Math.floor(Math.random()*20)}</td>
              <td class="px-4 py-2">${b.analytics?.shares ?? Math.floor(Math.random()*10)}</td>
              <td class="px-4 py-2"><button onclick="showBlogCommentsModal(${i})" class="px-2 py-1 bg-[#2046B3] text-white rounded text-xs font-bold">Comments</button></td>
              <td class="px-4 py-2">
                <button onclick="editBlog(${i})" class="text-[#2046B3] font-bold hover:underline mr-2">Edit</button>
                <button onclick="deleteBlog(${i})" class="text-red-600 font-bold hover:underline">Delete</button>
              </td>
            </tr>
          `).join('');
      }
      document.getElementById('add-blog-form')?.addEventListener('submit', function(e) {
        e.preventDefault();
        const title = document.getElementById('blog-title').value.trim();
        const author = document.getElementById('blog-author').value.trim();
        const date = document.getElementById('blog-date').value;
        const category = document.getElementById('blog-category').value.trim();
        const tags = document.getElementById('blog-tags').value.trim();
        const status = document.getElementById('blog-status').value;
        const featured = document.getElementById('blog-featured').checked;
        const content = document.getElementById('blog-content').innerHTML.trim();
        if (!title || !author || !date || !content) return;
        const blogs = getBlogs();
        blogs.push({ title, author, date, category, tags, status, featured, content, analytics: { views: Math.floor(Math.random()*100), likes: Math.floor(Math.random()*20), shares: Math.floor(Math.random()*10) } });
        saveBlogs(blogs);
        renderBlogs();
        this.reset();
        document.getElementById('blog-content').innerHTML = '';
      });
      window.deleteBlog = function(idx) {
        if (!confirm('Delete this blog post?')) return;
        const blogs = getBlogs();
        blogs.splice(idx, 1);
        saveBlogs(blogs);
        renderBlogs();
      };
      window.editBlog = function(idx) {
        const blogs = getBlogs();
        const b = blogs[idx];
        document.getElementById('blog-title').value = b.title;
        document.getElementById('blog-author').value = b.author;
        document.getElementById('blog-date').value = b.date;
        document.getElementById('blog-category').value = b.category;
        document.getElementById('blog-tags').value = b.tags;
        document.getElementById('blog-status').value = b.status;
        document.getElementById('blog-featured').checked = !!b.featured;
        document.getElementById('blog-content').innerHTML = b.content;
        blogs.splice(idx, 1);
        saveBlogs(blogs);
        renderBlogs();
      };
      window.togglePublishBlog = function(idx) {
        const blogs = getBlogs();
        blogs[idx].status = blogs[idx].status === 'Published' ? 'Draft' : 'Published';
        saveBlogs(blogs);
        renderBlogs();
      };
      window.toggleFeatureBlog = function(idx) {
        const blogs = getBlogs();
        blogs[idx].featured = !blogs[idx].featured;
        saveBlogs(blogs);
        renderBlogs();
      };
      window.showBlogCommentsModal = function(idx) {
        document.getElementById('blog-comments-modal').classList.remove('hidden');
      };
      window.closeBlogCommentsModal = function() {
        document.getElementById('blog-comments-modal').classList.add('hidden');
      };
      // Render on load if section exists
      if (document.getElementById('blogs-table-body')) renderBlogs();
      if (document.getElementById('contributors-table-body')) renderContributors();
      if (document.getElementById('categories-list')) renderCategories();
      if (document.getElementById('tags-list')) renderTags();
      // Filter listeners
      document.getElementById('blog-search')?.addEventListener('input', renderBlogs);
      document.getElementById('blog-filter-status')?.addEventListener('change', renderBlogs);
      document.getElementById('blog-filter-author')?.addEventListener('change', renderBlogs);
      document.getElementById('blog-filter-category')?.addEventListener('change', renderBlogs);
  </script>

<section id="pages-section" class="hidden">
  <div class="text-2xl font-bold text-[#F59E0B] mb-4 flex items-center gap-4">
    <i class="fas fa-file-alt"></i>Pages Management
    <button id="add-page-btn" class="ml-auto px-4 py-2 bg-[#7C3AED] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-plus"></i>New Page
    </button>
  </div>
  <div class="overflow-x-auto mb-6">
    <table class="w-full bg-white rounded-xl shadow border border-gray-200">
      <thead class="bg-[#F59E0B] text-white">
        <tr>
          <th class="px-4 py-2 text-left">Page</th>
          <th class="px-4 py-2 text-left">Type</th>
          <th class="px-4 py-2 text-left">Visibility</th>
          <th class="px-4 py-2 text-left">Status</th>
          <th class="px-4 py-2 text-left">SEO</th>
          <th class="px-4 py-2 text-left">Analytics</th>
          <th class="px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody id="pages-table-body">
        <!-- Pages will be rendered here -->
      </tbody>
    </table>
  </div>
  <div id="pages-modals"></div>
</section>
<script id="pages-admin-script">
(function() {
  // --- Data Model ---
  const LS_PAGES = 'admin_pages';
  const PAGE_TYPES = [
    { key: 'homepage', label: 'Homepage' },
    { key: 'about', label: 'About' },
    { key: 'sermons', label: 'Sermons' },
    { key: 'events', label: 'Events' },
    { key: 'blog', label: 'Blog' },
    { key: 'gallery', label: 'Gallery' },
    { key: 'ministries', label: 'Ministries' },
    { key: 'contact', label: 'Contact' },
    { key: 'discipleship', label: 'Discipleship Portal' },
    { key: 'testimonies', label: 'Testimonies' },
    { key: 'login', label: 'Login/Registration' },
    { key: 'privacy', label: 'Privacy Policy' },
    { key: 'terms', label: 'Terms of Service' }
  ];
  // --- Utility Functions ---
  function getPages() {
    let pages = JSON.parse(localStorage.getItem(LS_PAGES) || 'null');
    if (!pages) {
      // Demo data
      pages = [
        { id: 'homepage', name: 'Homepage', type: 'homepage', visibility: 'public', status: 'Published', seo: { title: 'Hearts After God Ministry', desc: '', keywords: '' }, analytics: { visits: 1200 }, sections: ['welcome', 'banner', 'featured'], content: { welcome: 'Welcome to Hearts After God Ministry!', banner: '', featured: [] } },
        { id: 'about', name: 'About', type: 'about', visibility: 'public', status: 'Published', seo: { title: 'About Us', desc: '', keywords: '' }, analytics: { visits: 800 }, sections: ['mission', 'vision', 'team'], content: { mission: '', vision: '', team: [] } },
        { id: 'sermons', name: 'Sermons', type: 'sermons', visibility: 'public', status: 'Published', seo: { title: 'Sermons', desc: '', keywords: '' }, analytics: { visits: 900 }, sections: [], content: {} },
        { id: 'events', name: 'Events', type: 'events', visibility: 'public', status: 'Published', seo: { title: 'Events', desc: '', keywords: '' }, analytics: { visits: 700 }, sections: [], content: {} },
        { id: 'blog', name: 'Blog', type: 'blog', visibility: 'public', status: 'Published', seo: { title: 'Blog', desc: '', keywords: '' }, analytics: { visits: 600 }, sections: [], content: {} },
        { id: 'gallery', name: 'Gallery', type: 'gallery', visibility: 'public', status: 'Published', seo: { title: 'Gallery', desc: '', keywords: '' }, analytics: { visits: 500 }, sections: [], content: {} },
        { id: 'ministries', name: 'Ministries', type: 'ministries', visibility: 'public', status: 'Published', seo: { title: 'Ministries', desc: '', keywords: '' }, analytics: { visits: 400 }, sections: [], content: {} },
        { id: 'contact', name: 'Contact', type: 'contact', visibility: 'public', status: 'Published', seo: { title: 'Contact', desc: '', keywords: '' }, analytics: { visits: 300 }, sections: [], content: {} },
        { id: 'discipleship', name: 'Discipleship Portal', type: 'discipleship', visibility: 'private', status: 'Published', seo: { title: 'Discipleship Portal', desc: '', keywords: '' }, analytics: { visits: 200 }, sections: [], content: {} },
        { id: 'testimonies', name: 'Testimonies', type: 'testimonies', visibility: 'public', status: 'Published', seo: { title: 'Testimonies', desc: '', keywords: '' }, analytics: { visits: 100 }, sections: [], content: {} },
        { id: 'login', name: 'Login/Registration', type: 'login', visibility: 'public', status: 'Published', seo: { title: 'Login/Registration', desc: '', keywords: '' }, analytics: { visits: 50 }, sections: [], content: {} },
        { id: 'privacy', name: 'Privacy Policy', type: 'privacy', visibility: 'public', status: 'Published', seo: { title: 'Privacy Policy', desc: '', keywords: '' }, analytics: { visits: 30 }, sections: [], content: {} },
        { id: 'terms', name: 'Terms of Service', type: 'terms', visibility: 'public', status: 'Published', seo: { title: 'Terms of Service', desc: '', keywords: '' }, analytics: { visits: 20 }, sections: [], content: {} }
      ];
      localStorage.setItem(LS_PAGES, JSON.stringify(pages));
    }
    return pages;
  }
  function savePages(pages) { localStorage.setItem(LS_PAGES, JSON.stringify(pages)); }
  function generateId() { return 'id-' + Math.random().toString(36).substr(2, 9); }
  // --- Render Table ---
  function renderPages() {
    const pages = getPages();
    const tbody = document.getElementById('pages-table-body');
    if (!tbody) return;
    tbody.innerHTML = pages.map(page => `
      <tr>
        <td class="px-4 py-2 font-bold">${page.name}</td>
        <td class="px-4 py-2">${PAGE_TYPES.find(t => t.key === page.type)?.label || 'Custom'}</td>
        <td class="px-4 py-2">
          <span class="${page.visibility === 'private' ? 'bg-gray-300 text-gray-700' : 'bg-[#7C3AED]/20 text-[#7C3AED]'} px-2 py-1 rounded">${page.visibility === 'private' ? 'Private' : 'Public'}</span>
        </td>
        <td class="px-4 py-2">
          <span class="${page.status === 'Published' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'} px-2 py-1 rounded">${page.status}</span>
        </td>
        <td class="px-4 py-2">
          <span class="text-xs">${page.seo?.title || ''}</span>
        </td>
        <td class="px-4 py-2">
          <span class="text-xs">${page.analytics?.visits ?? 0} visits</span>
        </td>
        <td class="px-4 py-2 flex gap-2">
          <button class="px-2 py-1 bg-[#7C3AED] text-white rounded text-xs" onclick="window.editPage('${page.id}')"><i class="fas fa-edit"></i> Edit</button>
          <button class="px-2 py-1 bg-[#F59E0B] text-white rounded text-xs" onclick="window.togglePageVisibility('${page.id}')">${page.visibility === 'private' ? 'Make Public' : 'Make Private'}</button>
          <button class="px-2 py-1 bg-[#2046B3] text-white rounded text-xs" onclick="window.togglePageStatus('${page.id}')">${page.status === 'Published' ? 'Unpublish' : 'Publish'}</button>
          <button class="px-2 py-1 bg-red-500 text-white rounded text-xs" onclick="window.deletePage('${page.id}')"><i class="fas fa-trash"></i></button>
        </td>
      </tr>
    `).join('');
  }
  // --- Modal Logic ---
  function showModal(html) {
    const modals = document.getElementById('pages-modals');
    modals.innerHTML = html;
    modals.classList.remove('hidden');
    modals.onclick = e => { if (e.target === modals) closeModal(); };
    modals.querySelectorAll('.close-modal').forEach(btn => btn.onclick = closeModal);
  }
  function closeModal() {
    const modals = document.getElementById('pages-modals');
    modals.innerHTML = '';
    modals.classList.add('hidden');
  }
  // --- Edit Page Modal ---
  window.editPage = function(id) {
    const pages = getPages();
    const page = pages.find(p => p.id === id);
    if (!page) return;
    // Dynamic fields by type
    let fields = '';
    if (page.type === 'homepage') {
      fields = `
        <div class='mb-3'><label class='block font-semibold mb-1'>Welcome Message</label><input type='text' name='welcome' class='w-full px-3 py-2 border rounded' value='${page.content.welcome||''}'></div>
        <div class='mb-3'><label class='block font-semibold mb-1'>Banner Image URL</label><input type='text' name='banner' class='w-full px-3 py-2 border rounded' value='${page.content.banner||''}'></div>
        <div class='mb-3'><label class='block font-semibold mb-1'>Featured Content (comma separated)</label><input type='text' name='featured' class='w-full px-3 py-2 border rounded' value='${(page.content.featured||[]).join(', ')}'></div>
      `;
    } else if (page.type === 'about') {
      fields = `
        <div class='mb-3'><label class='block font-semibold mb-1'>Ministry Description</label><textarea name='desc' class='w-full px-3 py-2 border rounded'>${page.content.desc||''}</textarea></div>
        <div class='mb-3'><label class='block font-semibold mb-1'>Mission</label><input type='text' name='mission' class='w-full px-3 py-2 border rounded' value='${page.content.mission||''}'></div>
        <div class='mb-3'><label class='block font-semibold mb-1'>Vision</label><input type='text' name='vision' class='w-full px-3 py-2 border rounded' value='${page.content.vision||''}'></div>
        <div class='mb-3'><label class='block font-semibold mb-1'>History</label><textarea name='history' class='w-full px-3 py-2 border rounded'>${page.content.history||''}</textarea></div>
        <div class='mb-3'><label class='block font-semibold mb-1'>Team Members (comma separated)</label><input type='text' name='team' class='w-full px-3 py-2 border rounded' value='${(page.content.team||[]).join(', ')}'></div>
      `;
    } else if (page.type === 'sermons') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Sermon Uploads/Edits managed in Sermons section.</label></div>`;
    } else if (page.type === 'events') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Events managed in Events section.</label></div>`;
    } else if (page.type === 'blog') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Blogs managed in Blog section.</label></div>`;
    } else if (page.type === 'gallery') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Gallery managed in Gallery section.</label></div>`;
    } else if (page.type === 'ministries') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Ministries managed in Ministries section.</label></div>`;
    } else if (page.type === 'contact') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Contact Info</label><input type='text' name='contact' class='w-full px-3 py-2 border rounded' value='${page.content.contact||''}'></div>`;
    } else if (page.type === 'discipleship') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Discipleship Portal managed in Discipleship section.</label></div>`;
    } else if (page.type === 'testimonies') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Testimonies managed in Testimonies section.</label></div>`;
    } else if (page.type === 'login') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Login/Registration settings managed in Users section.</label></div>`;
    } else if (page.type === 'privacy' || page.type === 'terms') {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Page Content</label><textarea name='content' class='w-full px-3 py-2 border rounded'>${page.content.content||''}</textarea></div>`;
    } else {
      fields = `<div class='mb-3'><label class='block font-semibold mb-1'>Page Content</label><textarea name='content' class='w-full px-3 py-2 border rounded'>${page.content.content||''}</textarea></div>`;
    }
    showModal(`
      <div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'>
        <form class='bg-white rounded-xl shadow-xl w-full max-w-2xl p-6' id='page-edit-form'>
          <div class='flex items-center justify-between mb-4'>
            <h3 class='text-lg font-bold text-[#F59E0B]'>Edit ${page.name}</h3>
            <button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button>
          </div>
          ${fields}
          <div class='mb-3'><label class='block font-semibold mb-1'>SEO Title</label><input type='text' name='seo_title' class='w-full px-3 py-2 border rounded' value='${page.seo?.title||''}'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>SEO Description</label><input type='text' name='seo_desc' class='w-full px-3 py-2 border rounded' value='${page.seo?.desc||''}'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>SEO Keywords</label><input type='text' name='seo_keywords' class='w-full px-3 py-2 border rounded' value='${page.seo?.keywords||''}'></div>
          <div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#F59E0B] text-white rounded font-bold'>Save</button></div>
        </form>
      </div>
    `);
    document.getElementById('page-edit-form').onsubmit = function(e) {
      e.preventDefault();
      let pages = getPages();
      const idx = pages.findIndex(p => p.id === id);
      if (idx < 0) return;
      const f = e.target;
      // Save fields by type
      if (page.type === 'homepage') {
        pages[idx].content.welcome = f.welcome.value;
        pages[idx].content.banner = f.banner.value;
        pages[idx].content.featured = f.featured.value.split(',').map(s=>s.trim()).filter(Boolean);
      } else if (page.type === 'about') {
        pages[idx].content.desc = f.desc.value;
        pages[idx].content.mission = f.mission.value;
        pages[idx].content.vision = f.vision.value;
        pages[idx].content.history = f.history.value;
        pages[idx].content.team = f.team.value.split(',').map(s=>s.trim()).filter(Boolean);
      } else if (page.type === 'contact') {
        pages[idx].content.contact = f.contact.value;
      } else if (page.type === 'privacy' || page.type === 'terms' || !PAGE_TYPES.find(t => t.key === page.type)) {
        pages[idx].content.content = f.content.value;
      }
      pages[idx].seo.title = f.seo_title.value;
      pages[idx].seo.desc = f.seo_desc.value;
      pages[idx].seo.keywords = f.seo_keywords.value;
      savePages(pages);
      closeModal();
      renderPages();
    };
  };
  // --- Actions ---
  window.togglePageVisibility = function(id) {
    let pages = getPages();
    const idx = pages.findIndex(p => p.id === id);
    if (idx < 0) return;
    pages[idx].visibility = pages[idx].visibility === 'private' ? 'public' : 'private';
    savePages(pages);
    renderPages();
  };
  window.togglePageStatus = function(id) {
    let pages = getPages();
    const idx = pages.findIndex(p => p.id === id);
    if (idx < 0) return;
    pages[idx].status = pages[idx].status === 'Published' ? 'Draft' : 'Published';
    savePages(pages);
    renderPages();
  };
  window.deletePage = function(id) {
    if (!confirm('Delete this page?')) return;
    let pages = getPages();
    pages = pages.filter(p => p.id !== id);
    savePages(pages);
    renderPages();
  };
  // --- Add New Page ---
  document.getElementById('add-page-btn').onclick = function() {
    showModal(`
      <div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'>
        <form class='bg-white rounded-xl shadow-xl w-full max-w-2xl p-6' id='page-add-form'>
          <div class='flex items-center justify-between mb-4'>
            <h3 class='text-lg font-bold text-[#7C3AED]'>Create New Page</h3>
            <button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button>
          </div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Page Name</label><input type='text' name='name' class='w-full px-3 py-2 border rounded' required></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Page Type</label><select name='type' class='w-full px-3 py-2 border rounded'>${PAGE_TYPES.map(t => `<option value='${t.key}'>${t.label}</option>`).join('')}<option value='custom'>Custom</option></select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Visibility</label><select name='visibility' class='w-full px-3 py-2 border rounded'><option value='public'>Public</option><option value='private'>Private</option></select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>SEO Title</label><input type='text' name='seo_title' class='w-full px-3 py-2 border rounded'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>SEO Description</label><input type='text' name='seo_desc' class='w-full px-3 py-2 border rounded'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>SEO Keywords</label><input type='text' name='seo_keywords' class='w-full px-3 py-2 border rounded'></div>
          <div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded font-bold'>Create</button></div>
        </form>
      </div>
    `);
    document.getElementById('page-add-form').onsubmit = function(e) {
      e.preventDefault();
      let pages = getPages();
      const f = e.target;
      const id = generateId();
      pages.push({
        id,
        name: f.name.value,
        type: f.type.value,
        visibility: f.visibility.value,
        status: 'Draft',
        seo: { title: f.seo_title.value, desc: f.seo_desc.value, keywords: f.seo_keywords.value },
        analytics: { visits: 0 },
        sections: [],
        content: {}
      });
      savePages(pages);
      closeModal();
      renderPages();
    };
  };
  // --- Initial Render ---
  renderPages();
})();
</script>

<section id="ministries-section" class="hidden">
  <div class="text-2xl font-bold text-[#2046B3] mb-4 flex items-center gap-4">
    <i class="fas fa-church"></i>Ministries Management
    <button id="add-ministry-btn" class="ml-auto px-4 py-2 bg-[#7C3AED] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-plus"></i>New Ministry
    </button>
  </div>
  <div class="overflow-x-auto mb-6">
    <table class="w-full bg-white rounded-xl shadow border border-gray-200">
      <thead class="bg-[#2046B3] text-white">
        <tr>
          <th class="px-4 py-2 text-left">Name</th>
          <th class="px-4 py-2 text-left">Category</th>
          <th class="px-4 py-2 text-left">Leader</th>
          <th class="px-4 py-2 text-left">Status</th>
          <th class="px-4 py-2 text-left">Visibility</th>
          <th class="px-4 py-2 text-left">Featured</th>
          <th class="px-4 py-2 text-left">Analytics</th>
          <th class="px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody id="ministries-table-body">
        <!-- Ministries will be rendered here -->
      </tbody>
    </table>
  </div>
  <div id="ministries-modals"></div>
</section>
<script id="ministries-admin-script">
(function() {
  // --- Data Model ---
  const LS_MINISTRIES = 'admin_ministries';
  const LS_USERS = 'admin_users'; // For leader assignment demo
  const DEMO_CATEGORIES = ['Youth', 'Women', 'Men', 'Evangelism', 'Worship', 'Children', 'Outreach'];
  const DEMO_STATUS = ['Active', 'On Hold', 'Discontinued'];
  // --- Utility Functions ---
  function getMinistries() {
    let ministries = JSON.parse(localStorage.getItem(LS_MINISTRIES) || 'null');
    if (!ministries) {
      ministries = [
        { id: 'min1', name: 'Youth Ministry', category: 'Youth', leader: 'Jane Doe', leaderId: 'u1', status: 'Active', visibility: 'public', featured: true, image: '', contact: 'youth@church.org', events: [], programs: [], analytics: { members: 120, events: 8, downloads: 30 }, comments: [], resources: [], testimonies: [], social: '', crosslinks: [] },
        { id: 'min2', name: 'Women Fellowship', category: 'Women', leader: 'Mary Wanjiku', leaderId: 'u2', status: 'Active', visibility: 'public', featured: false, image: '', contact: 'women@church.org', events: [], programs: [], analytics: { members: 80, events: 5, downloads: 12 }, comments: [], resources: [], testimonies: [], social: '', crosslinks: [] }
      ];
      localStorage.setItem(LS_MINISTRIES, JSON.stringify(ministries));
    }
    return ministries;
  }
  function saveMinistries(ministries) { localStorage.setItem(LS_MINISTRIES, JSON.stringify(ministries)); }
  function getUsers() {
    // Demo users for leader assignment
    let users = JSON.parse(localStorage.getItem(LS_USERS) || 'null');
    if (!users) {
      users = [
        { id: 'u1', name: 'Jane Doe', role: 'Leader' },
        { id: 'u2', name: 'Mary Wanjiku', role: 'Leader' },
        { id: 'u3', name: 'Pastor John', role: 'Pastor' },
        { id: 'u4', name: 'Cyrilla Chikamai', role: 'Coordinator' }
      ];
      localStorage.setItem(LS_USERS, JSON.stringify(users));
    }
    return users;
  }
  function generateId() { return 'min-' + Math.random().toString(36).substr(2, 9); }
  // --- Render Table ---
  function renderMinistries() {
    const ministries = getMinistries();
    const tbody = document.getElementById('ministries-table-body');
    if (!tbody) return;
    tbody.innerHTML = ministries.map(min => `
      <tr>
        <td class="px-4 py-2 font-bold">${min.name}</td>
        <td class="px-4 py-2">${min.category}</td>
        <td class="px-4 py-2">${min.leader || '<span class=\'text-gray-400\'>Unassigned</span>'}</td>
        <td class="px-4 py-2"><span class="${min.status === 'Active' ? 'bg-green-100 text-green-700' : min.status === 'On Hold' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-200 text-gray-700'} px-2 py-1 rounded">${min.status}</span></td>
        <td class="px-4 py-2"><span class="${min.visibility === 'private' ? 'bg-gray-300 text-gray-700' : 'bg-[#7C3AED]/20 text-[#7C3AED]'} px-2 py-1 rounded">${min.visibility === 'private' ? 'Hidden' : 'Public'}</span></td>
        <td class="px-4 py-2">${min.featured ? '<span class="bg-[#F59E0B]/20 text-[#F59E0B] px-2 py-1 rounded">Featured</span>' : ''}</td>
        <td class="px-4 py-2 text-xs">${min.analytics?.members ?? 0} members<br>${min.analytics?.events ?? 0} events<br>${min.analytics?.downloads ?? 0} downloads</td>
        <td class="px-4 py-2 flex gap-2">
          <button class="px-2 py-1 bg-[#7C3AED] text-white rounded text-xs" onclick="window.editMinistry('${min.id}')"><i class="fas fa-edit"></i> Edit</button>
          <button class="px-2 py-1 bg-[#F59E0B] text-white rounded text-xs" onclick="window.assignLeader('${min.id}')"><i class="fas fa-user"></i> Leader</button>
          <button class="px-2 py-1 bg-[#2046B3] text-white rounded text-xs" onclick="window.manageMinistryContent('${min.id}')"><i class="fas fa-cogs"></i> Content</button>
          <button class="px-2 py-1 bg-gray-400 text-white rounded text-xs" onclick="window.toggleMinistryVisibility('${min.id}')">${min.visibility === 'private' ? 'Show' : 'Hide'}</button>
          <button class="px-2 py-1 bg-yellow-500 text-white rounded text-xs" onclick="window.toggleMinistryFeatured('${min.id}')">${min.featured ? 'Unfeature' : 'Feature'}</button>
          <button class="px-2 py-1 bg-red-500 text-white rounded text-xs" onclick="window.deleteMinistry('${min.id}')"><i class="fas fa-trash"></i></button>
        </td>
      </tr>
    `).join('');
  }
  // --- Modal Logic ---
  function showModal(html) {
    const modals = document.getElementById('ministries-modals');
    modals.innerHTML = html;
    modals.classList.remove('hidden');
    modals.onclick = e => { if (e.target === modals) closeModal(); };
    modals.querySelectorAll('.close-modal').forEach(btn => btn.onclick = closeModal);
  }
  function closeModal() {
    const modals = document.getElementById('ministries-modals');
    modals.innerHTML = '';
    modals.classList.add('hidden');
  }
  // --- Add/Edit Ministry Modal ---
  document.getElementById('add-ministry-btn').onclick = function() { openMinistryModal(); };
  window.editMinistry = function(id) { openMinistryModal(id); };
  function openMinistryModal(id) {
    const users = getUsers();
    let min = id ? getMinistries().find(m => m.id === id) : null;
    showModal(`
      <div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'>
        <form class='bg-white rounded-xl shadow-xl w-full max-w-2xl p-6' id='ministry-form'>
          <div class='flex items-center justify-between mb-4'>
            <h3 class='text-lg font-bold text-[#2046B3]'>${id ? 'Edit Ministry' : 'Add Ministry'}</h3>
            <button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button>
          </div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Ministry Name</label><input type='text' name='name' class='w-full px-3 py-2 border rounded' value='${min?.name||''}' required></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Description</label><textarea name='desc' class='w-full px-3 py-2 border rounded'>${min?.desc||''}</textarea></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Category</label><select name='category' class='w-full px-3 py-2 border rounded'>${DEMO_CATEGORIES.map(cat => `<option value='${cat}' ${min?.category===cat?'selected':''}>${cat}</option>`).join('')}</select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Leader/Coordinator</label><select name='leaderId' class='w-full px-3 py-2 border rounded'><option value=''>Unassigned</option>${users.map(u => `<option value='${u.id}' ${min?.leaderId===u.id?'selected':''}>${u.name} (${u.role})</option>`).join('')}</select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Contact Info</label><input type='text' name='contact' class='w-full px-3 py-2 border rounded' value='${min?.contact||''}'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Image/Logo URL</label><input type='text' name='image' class='w-full px-3 py-2 border rounded' value='${min?.image||''}'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Status</label><select name='status' class='w-full px-3 py-2 border rounded'>${DEMO_STATUS.map(s => `<option value='${s}' ${min?.status===s?'selected':''}>${s}</option>`).join('')}</select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Social/Links</label><input type='text' name='social' class='w-full px-3 py-2 border rounded' value='${min?.social||''}'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Visibility</label><select name='visibility' class='w-full px-3 py-2 border rounded'><option value='public' ${min?.visibility==='public'?'selected':''}>Public</option><option value='private' ${min?.visibility==='private'?'selected':''}>Hidden</option></select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Featured</label><input type='checkbox' name='featured' ${min?.featured?'checked':''}></div>
          <div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#2046B3] text-white rounded font-bold'>${id ? 'Save' : 'Add'}</button></div>
        </form>
      </div>
    `);
    document.getElementById('ministry-form').onsubmit = function(e) {
      e.preventDefault();
      let ministries = getMinistries();
      const f = e.target;
      const leaderId = f.leaderId.value;
      const leader = users.find(u => u.id === leaderId)?.name || '';
      const obj = {
        id: id || generateId(),
        name: f.name.value,
        desc: f.desc.value,
        category: f.category.value,
        leader, leaderId,
        contact: f.contact.value,
        image: f.image.value,
        status: f.status.value,
        social: f.social.value,
        visibility: f.visibility.value,
        featured: f.featured.checked,
        analytics: min?.analytics || { members: 0, events: 0, downloads: 0 },
        events: min?.events || [],
        programs: min?.programs || [],
        comments: min?.comments || [],
        resources: min?.resources || [],
        testimonies: min?.testimonies || [],
        crosslinks: min?.crosslinks || []
      };
      if (id) {
        const idx = ministries.findIndex(m => m.id === id);
        ministries[idx] = obj;
      } else {
        ministries.push(obj);
      }
      saveMinistries(ministries);
      closeModal();
      renderMinistries();
    };
  }
  // --- Delete Ministry ---
  window.deleteMinistry = function(id) {
    if (!confirm('Delete this ministry? This cannot be undone.')) return;
    let ministries = getMinistries();
    ministries = ministries.filter(m => m.id !== id);
    saveMinistries(ministries);
    renderMinistries();
  };
  // --- Assign Leader ---
  window.assignLeader = function(id) {
    const min = getMinistries().find(m => m.id === id);
    const users = getUsers();
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-md p-6' id='assign-leader-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#7C3AED]'>Assign Leader</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Select Leader</label><select name='leaderId' class='w-full px-3 py-2 border rounded'>${users.map(u => `<option value='${u.id}' ${min?.leaderId===u.id?'selected':''}>${u.name} (${u.role})</option>`).join('')}</select></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded font-bold'>Assign</button></div></form></div></div>`);
    document.getElementById('assign-leader-form').onsubmit = function(e) {
      e.preventDefault();
      let ministries = getMinistries();
      const idx = ministries.findIndex(m => m.id === id);
      const leaderId = e.target.leaderId.value;
      const leader = users.find(u => u.id === leaderId)?.name || '';
      ministries[idx].leaderId = leaderId;
      ministries[idx].leader = leader;
      saveMinistries(ministries);
      closeModal();
      renderMinistries();
    };
  };
  // --- Manage Content ---
  window.manageMinistryContent = function(id) {
    const min = getMinistries().find(m => m.id === id);
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><div class='bg-white rounded-xl shadow-xl w-full max-w-3xl p-6'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#2046B3]'>Manage Content: ${min.name}</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-4'><strong>Events/Programs:</strong> <span class='text-xs text-gray-500'>(Demo: add/edit/remove)</span><div class='mb-2'><input type='text' id='new-event' class='px-2 py-1 border rounded' placeholder='Add event/program'><button class='ml-2 px-2 py-1 bg-[#2046B3] text-white rounded' onclick='window.addMinistryEvent("${id}")'>Add</button></div><ul id='min-events-list'>${(min.events||[]).map((ev,i) => `<li class='flex gap-2 items-center mb-1'><span>${ev}</span><button class='text-red-500 text-xs' onclick='window.removeMinistryEvent("${id}",${i})'>&times;</button></li>`).join('')}</ul></div><div class='mb-4'><strong>Resources:</strong> <span class='text-xs text-gray-500'>(Demo: add/edit/remove)</span><div class='mb-2'><input type='text' id='new-resource' class='px-2 py-1 border rounded' placeholder='Add resource'><button class='ml-2 px-2 py-1 bg-[#2046B3] text-white rounded' onclick='window.addMinistryResource("${id}")'>Add</button></div><ul id='min-resources-list'>${(min.resources||[]).map((r,i) => `<li class='flex gap-2 items-center mb-1'><span>${r}</span><button class='text-red-500 text-xs' onclick='window.removeMinistryResource("${id}",${i})'>&times;</button></li>`).join('')}</ul></div><div class='mb-4'><strong>Testimonies:</strong> <span class='text-xs text-gray-500'>(Demo: add/edit/remove)</span><div class='mb-2'><input type='text' id='new-testimony' class='px-2 py-1 border rounded' placeholder='Add testimony'><button class='ml-2 px-2 py-1 bg-[#2046B3] text-white rounded' onclick='window.addMinistryTestimony("${id}")'>Add</button></div><ul id='min-testimonies-list'>${(min.testimonies||[]).map((t,i) => `<li class='flex gap-2 items-center mb-1'><span>${t}</span><button class='text-red-500 text-xs' onclick='window.removeMinistryTestimony("${id}",${i})'>&times;</button></li>`).join('')}</ul></div><div class='mb-4'><strong>Comments/Moderation:</strong> <span class='text-xs text-gray-500'>(Demo: approve/delete)</span><ul id='min-comments-list'>${(min.comments||[]).map((c,i) => `<li class='flex gap-2 items-center mb-1'><span>${c.text}</span><button class='text-green-600 text-xs' onclick='window.approveMinistryComment("${id}",${i})'>Approve</button><button class='text-red-500 text-xs' onclick='window.deleteMinistryComment("${id}",${i})'>&times;</button></li>`).join('')}</ul></div></div></div>`);
  };
  window.addMinistryEvent = function(id) {
    const val = document.getElementById('new-event').value.trim();
    if (!val) return;
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].events = ministries[idx].events || [];
    ministries[idx].events.push(val);
    saveMinistries(ministries);
    window.manageMinistryContent(id);
  };
  window.removeMinistryEvent = function(id, i) {
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].events.splice(i,1);
    saveMinistries(ministries);
    window.manageMinistryContent(id);
  };
  window.addMinistryResource = function(id) {
    const val = document.getElementById('new-resource').value.trim();
    if (!val) return;
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].resources = ministries[idx].resources || [];
    ministries[idx].resources.push(val);
    saveMinistries(ministries);
    window.manageMinistryContent(id);
  };
  window.removeMinistryResource = function(id, i) {
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].resources.splice(i,1);
    saveMinistries(ministries);
    window.manageMinistryContent(id);
  };
  window.addMinistryTestimony = function(id) {
    const val = document.getElementById('new-testimony').value.trim();
    if (!val) return;
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].testimonies = ministries[idx].testimonies || [];
    ministries[idx].testimonies.push(val);
    saveMinistries(ministries);
    window.manageMinistryContent(id);
  };
  window.removeMinistryTestimony = function(id, i) {
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].testimonies.splice(i,1);
    saveMinistries(ministries);
    window.manageMinistryContent(id);
  };
  window.approveMinistryComment = function(id, i) {
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].comments[i].approved = true;
    saveMinistries(ministries);
    window.manageMinistryContent(id);
  };
  window.deleteMinistryComment = function(id, i) {
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].comments.splice(i,1);
    saveMinistries(ministries);
    window.manageMinistryContent(id);
  };
  // --- Visibility/Featured ---
  window.toggleMinistryVisibility = function(id) {
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].visibility = ministries[idx].visibility === 'private' ? 'public' : 'private';
    saveMinistries(ministries);
    renderMinistries();
  };
  window.toggleMinistryFeatured = function(id) {
    let ministries = getMinistries();
    const idx = ministries.findIndex(m => m.id === id);
    ministries[idx].featured = !ministries[idx].featured;
    saveMinistries(ministries);
    renderMinistries();
  };
  // --- Initial Render ---
  renderMinistries();
})();
</script>

<section id="users-section" class="hidden">
  <div class="text-2xl font-bold text-[#7C3AED] mb-4 flex items-center gap-4">
    <i class="fas fa-users-cog"></i>Users Management
    <button id="add-user-btn" class="ml-auto px-4 py-2 bg-[#2046B3] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-user-plus"></i>New User
    </button>
  </div>
  <div class="mb-4 flex flex-wrap gap-2 items-center">
    <input type="text" id="user-search" placeholder="Search users..." class="px-4 py-2 border rounded w-64" />
    <select id="user-filter-role" class="px-3 py-2 border rounded">
      <option value="">All Roles</option>
      <option value="Disciple">Disciple</option>
      <option value="Pastor">Pastor</option>
      <option value="Blogger">Blogger</option>
      <option value="Media Team">Media Team</option>
      <option value="Admin">Admin</option>
    </select>
    <select id="user-filter-ministry" class="px-3 py-2 border rounded">
      <option value="">All Ministries</option>
    </select>
    <select id="user-filter-status" class="px-3 py-2 border rounded">
      <option value="">All Statuses</option>
      <option value="Active">Active</option>
      <option value="Pending">Pending</option>
      <option value="Suspended">Suspended</option>
    </select>
  </div>
  <div class="overflow-x-auto mb-6">
    <table class="w-full bg-white rounded-xl shadow border border-gray-200">
      <thead class="bg-[#7C3AED] text-white">
        <tr>
          <th class="px-4 py-2 text-left">Name</th>
          <th class="px-4 py-2 text-left">Email</th>
          <th class="px-4 py-2 text-left">Role</th>
          <th class="px-4 py-2 text-left">Ministry</th>
          <th class="px-4 py-2 text-left">Status</th>
          <th class="px-4 py-2 text-left">Last Login</th>
          <th class="px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody id="users-table-body">
        <!-- Users will be rendered here -->
      </tbody>
    </table>
  </div>
  <div id="users-modals"></div>
</section>
<script id="users-admin-script">
(function() {
  // --- Data Model ---
  const LS_USERS = 'admin_users';
  const LS_MINISTRIES = 'admin_ministries';
  const ROLES = ['Disciple', 'Pastor', 'Blogger', 'Media Team', 'Admin'];
  const STATUS = ['Active', 'Pending', 'Suspended'];
  // --- Utility Functions ---
  function getUsers() {
    let users = JSON.parse(localStorage.getItem(LS_USERS) || 'null');
    if (!users) {
      users = [
        { id: 'u1', name: 'Jane Doe', email: 'jane@example.com', role: 'Disciple', ministry: 'Youth Ministry', status: 'Active', lastLogin: '2024-06-01T10:00:00Z', activity: { sermons: 2, blogs: 1 }, password: '', approved: true },
        { id: 'u2', name: 'Mary Wanjiku', email: 'mary@example.com', role: 'Pastor', ministry: 'Women Fellowship', status: 'Active', lastLogin: '2024-06-02T09:00:00Z', activity: { sermons: 5, blogs: 0 }, password: '', approved: true },
        { id: 'u3', name: 'John Smith', email: 'john@example.com', role: 'Blogger', ministry: '', status: 'Pending', lastLogin: '', activity: { sermons: 0, blogs: 3 }, password: '', approved: false },
        { id: 'u4', name: 'Cyrilla Chikamai', email: 'cyrilla@example.com', role: 'Media Team', ministry: '', status: 'Active', lastLogin: '2024-06-03T08:00:00Z', activity: { uploads: 10 }, password: '', approved: true },
        { id: 'u5', name: 'Pastor John', email: 'pastorjohn@example.com', role: 'Admin', ministry: '', status: 'Active', lastLogin: '2024-06-04T07:00:00Z', activity: {}, password: '', approved: true }
      ];
      localStorage.setItem(LS_USERS, JSON.stringify(users));
    }
    return users;
  }
  function saveUsers(users) { localStorage.setItem(LS_USERS, JSON.stringify(users)); }
  function getMinistries() {
    let ministries = JSON.parse(localStorage.getItem(LS_MINISTRIES) || 'null');
    if (!ministries) ministries = [];
    return ministries;
  }
  function generateId() { return 'u-' + Math.random().toString(36).substr(2, 9); }
  function formatDate(iso) { if (!iso) return ''; const d = new Date(iso); return d.toLocaleDateString() + ' ' + d.toLocaleTimeString(); }
  // --- Render Table ---
  function renderUsers() {
    const users = getUsers();
    const tbody = document.getElementById('users-table-body');
    if (!tbody) return;
    // Filters
    const role = document.getElementById('user-filter-role').value;
    const ministry = document.getElementById('user-filter-ministry').value;
    const status = document.getElementById('user-filter-status').value;
    const search = document.getElementById('user-search').value.toLowerCase();
    let filtered = users.filter(u =>
      (!role || u.role === role) &&
      (!ministry || u.ministry === ministry) &&
      (!status || u.status === status) &&
      (!search || u.name.toLowerCase().includes(search) || u.email.toLowerCase().includes(search))
    );
    tbody.innerHTML = filtered.map(u => `
      <tr>
        <td class="px-4 py-2 font-bold">${u.name}</td>
        <td class="px-4 py-2">${u.email}</td>
        <td class="px-4 py-2">${u.role}</td>
        <td class="px-4 py-2">${u.ministry||'<span class=\'text-gray-400\'>None</span>'}</td>
        <td class="px-4 py-2"><span class="${u.status === 'Active' ? 'bg-green-100 text-green-700' : u.status === 'Pending' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-200 text-gray-700'} px-2 py-1 rounded">${u.status}</span></td>
        <td class="px-4 py-2 text-xs">${u.lastLogin ? formatDate(u.lastLogin) : '-'}</td>
        <td class="px-4 py-2 flex gap-2">
          <button class="px-2 py-1 bg-[#2046B3] text-white rounded text-xs" onclick="window.editUser('${u.id}')"><i class="fas fa-edit"></i> Edit</button>
          <button class="px-2 py-1 bg-[#F59E0B] text-white rounded text-xs" onclick="window.assignRole('${u.id}')"><i class="fas fa-user-tag"></i> Role</button>
          <button class="px-2 py-1 bg-[#7C3AED] text-white rounded text-xs" onclick="window.assignMinistry('${u.id}')"><i class="fas fa-church"></i> Ministry</button>
          <button class="px-2 py-1 bg-gray-400 text-white rounded text-xs" onclick="window.resetPassword('${u.id}')"><i class="fas fa-key"></i> Reset</button>
          ${u.status === 'Pending' ? `<button class='px-2 py-1 bg-green-500 text-white rounded text-xs' onclick='window.approveUser("${u.id}")'>Approve</button><button class='px-2 py-1 bg-red-500 text-white rounded text-xs' onclick='window.rejectUser("${u.id}")'>Reject</button>` : ''}
          <button class="px-2 py-1 bg-yellow-500 text-white rounded text-xs" onclick="window.toggleUserStatus('${u.id}')">${u.status === 'Suspended' ? 'Activate' : 'Suspend'}</button>
          <button class="px-2 py-1 bg-red-500 text-white rounded text-xs" onclick="window.deleteUser('${u.id}')"><i class="fas fa-trash"></i></button>
        </td>
      </tr>
    `).join('');
    // Populate ministry filter
    const minSel = document.getElementById('user-filter-ministry');
    const ministries = getMinistries();
    minSel.innerHTML = `<option value=''>All Ministries</option>` + ministries.map(m => `<option value='${m.name}'>${m.name}</option>`).join('');
  }
  // --- Modal Logic ---
  function showModal(html) {
    const modals = document.getElementById('users-modals');
    modals.innerHTML = html;
    modals.classList.remove('hidden');
    modals.onclick = e => { if (e.target === modals) closeModal(); };
    modals.querySelectorAll('.close-modal').forEach(btn => btn.onclick = closeModal);
  }
  function closeModal() {
    const modals = document.getElementById('users-modals');
    modals.innerHTML = '';
    modals.classList.add('hidden');
  }
  // --- Add/Edit User Modal ---
  document.getElementById('add-user-btn').onclick = function() { openUserModal(); };
  window.editUser = function(id) { openUserModal(id); };
  function openUserModal(id) {
    const ministries = getMinistries();
    let u = id ? getUsers().find(x => x.id === id) : null;
    showModal(`
      <div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'>
        <form class='bg-white rounded-xl shadow-xl w-full max-w-2xl p-6' id='user-form'>
          <div class='flex items-center justify-between mb-4'>
            <h3 class='text-lg font-bold text-[#2046B3]'>${id ? 'Edit User' : 'Add User'}</h3>
            <button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button>
          </div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Name</label><input type='text' name='name' class='w-full px-3 py-2 border rounded' value='${u?.name||''}' required></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Email</label><input type='email' name='email' class='w-full px-3 py-2 border rounded' value='${u?.email||''}' required></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Role</label><select name='role' class='w-full px-3 py-2 border rounded'>${ROLES.map(r => `<option value='${r}' ${u?.role===r?'selected':''}>${r}</option>`).join('')}</select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Ministry</label><select name='ministry' class='w-full px-3 py-2 border rounded'><option value=''>None</option>${ministries.map(m => `<option value='${m.name}' ${u?.ministry===m.name?'selected':''}>${m.name}</option>`).join('')}</select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Status</label><select name='status' class='w-full px-3 py-2 border rounded'>${STATUS.map(s => `<option value='${s}' ${u?.status===s?'selected':''}>${s}</option>`).join('')}</select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Password</label><input type='password' name='password' class='w-full px-3 py-2 border rounded' value='${u?.password||''}' ${id?'placeholder="Leave blank to keep current"':''}></div>
          <div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#2046B3] text-white rounded font-bold'>${id ? 'Save' : 'Add'}</button></div>
        </form>
      </div>
    `);
    document.getElementById('user-form').onsubmit = function(e) {
      e.preventDefault();
      let users = getUsers();
      const f = e.target;
      const obj = {
        id: id || generateId(),
        name: f.name.value,
        email: f.email.value,
        role: f.role.value,
        ministry: f.ministry.value,
        status: f.status.value,
        lastLogin: u?.lastLogin || '',
        activity: u?.activity || {},
        password: f.password.value ? f.password.value : (u?.password || ''),
        approved: u?.approved ?? true
      };
      if (id) {
        const idx = users.findIndex(x => x.id === id);
        users[idx] = obj;
      } else {
        users.push(obj);
      }
      saveUsers(users);
      closeModal();
      renderUsers();
    };
  }
  // --- Delete User ---
  window.deleteUser = function(id) {
    if (!confirm('Delete this user? This cannot be undone.')) return;
    let users = getUsers();
    users = users.filter(u => u.id !== id);
    saveUsers(users);
    renderUsers();
  };
  // --- Assign Role ---
  window.assignRole = function(id) {
    const u = getUsers().find(x => x.id === id);
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-md p-6' id='assign-role-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#7C3AED]'>Assign Role</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Select Role</label><select name='role' class='w-full px-3 py-2 border rounded'>${ROLES.map(r => `<option value='${r}' ${u?.role===r?'selected':''}>${r}</option>`).join('')}</select></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded font-bold'>Assign</button></div></form></div></div>`);
    document.getElementById('assign-role-form').onsubmit = function(e) {
      e.preventDefault();
      let users = getUsers();
      const idx = users.findIndex(x => x.id === id);
      users[idx].role = e.target.role.value;
      saveUsers(users);
      closeModal();
      renderUsers();
    };
  };
  // --- Assign Ministry ---
  window.assignMinistry = function(id) {
    const u = getUsers().find(x => x.id === id);
    const ministries = getMinistries();
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-md p-6' id='assign-ministry-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#2046B3]'>Assign Ministry</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Select Ministry</label><select name='ministry' class='w-full px-3 py-2 border rounded'><option value=''>None</option>${ministries.map(m => `<option value='${m.name}' ${u?.ministry===m.name?'selected':''}>${m.name}</option>`).join('')}</select></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#2046B3] text-white rounded font-bold'>Assign</button></div></form></div></div>`);
    document.getElementById('assign-ministry-form').onsubmit = function(e) {
      e.preventDefault();
      let users = getUsers();
      const idx = users.findIndex(x => x.id === id);
      users[idx].ministry = e.target.ministry.value;
      saveUsers(users);
      closeModal();
      renderUsers();
    };
  };
  // --- Reset Password ---
  window.resetPassword = function(id) {
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-md p-6' id='reset-password-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#F59E0B]'>Reset Password</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>New Password</label><input type='password' name='password' class='w-full px-3 py-2 border rounded' required></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#F59E0B] text-white rounded font-bold'>Reset</button></div></form></div></div>`);
    document.getElementById('reset-password-form').onsubmit = function(e) {
      e.preventDefault();
      let users = getUsers();
      const idx = users.findIndex(x => x.id === id);
      users[idx].password = e.target.password.value;
      saveUsers(users);
      closeModal();
      renderUsers();
    };
  };
  // --- Approve/Reject ---
  window.approveUser = function(id) {
    let users = getUsers();
    const idx = users.findIndex(x => x.id === id);
    users[idx].status = 'Active';
    users[idx].approved = true;
    saveUsers(users);
    renderUsers();
  };
  window.rejectUser = function(id) {
    if (!confirm('Reject this registration?')) return;
    let users = getUsers();
    users = users.filter(u => u.id !== id);
    saveUsers(users);
    renderUsers();
  };
  // --- Activate/Deactivate ---
  window.toggleUserStatus = function(id) {
    let users = getUsers();
    const idx = users.findIndex(x => x.id === id);
    users[idx].status = users[idx].status === 'Suspended' ? 'Active' : 'Suspended';
    saveUsers(users);
    renderUsers();
  };
  // --- Filters ---
  document.getElementById('user-search').oninput = renderUsers;
  document.getElementById('user-filter-role').onchange = renderUsers;
  document.getElementById('user-filter-ministry').onchange = renderUsers;
  document.getElementById('user-filter-status').onchange = renderUsers;
  // --- Initial Render ---
  renderUsers();
})();
</script>

<section id="comments-section" class="hidden">
  <div class="text-2xl font-bold text-[#F59E0B] mb-4 flex items-center gap-4">
    <i class="fas fa-comments"></i>Comments Management
    <button id="export-comments-btn" class="ml-auto px-4 py-2 bg-[#2046B3] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-file-export"></i>Export
    </button>
  </div>
  <div class="mb-4 flex flex-wrap gap-2 items-center">
    <input type="text" id="comment-search" placeholder="Search comments..." class="px-4 py-2 border rounded w-64" />
    <select id="comment-filter-type" class="px-3 py-2 border rounded">
      <option value="">All Post Types</option>
      <option value="Sermon">Sermon</option>
      <option value="Blog">Blog</option>
      <option value="Event">Event</option>
      <option value="Ministry">Ministry</option>
    </select>
    <select id="comment-filter-status" class="px-3 py-2 border rounded">
      <option value="">All Statuses</option>
      <option value="approved">Approved</option>
      <option value="pending">Pending</option>
      <option value="rejected">Rejected</option>
      <option value="spam">Spam</option>
    </select>
  </div>
  <div class="overflow-x-auto mb-6">
    <table class="w-full bg-white rounded-xl shadow border border-gray-200">
      <thead class="bg-[#F59E0B] text-white">
        <tr>
          <th class="px-4 py-2 text-left">Post Type</th>
          <th class="px-4 py-2 text-left">Post Title</th>
          <th class="px-4 py-2 text-left">Commenter</th>
          <th class="px-4 py-2 text-left">Comment</th>
          <th class="px-4 py-2 text-left">Status</th>
          <th class="px-4 py-2 text-left">Date</th>
          <th class="px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody id="comments-table-body">
        <!-- Comments will be rendered here -->
      </tbody>
    </table>
  </div>
  <div id="comments-modals"></div>
</section>
<script id="comments-admin-script">
(function() {
  // --- Data Model ---
  const LS_COMMENTS = 'admin_comments';
  const POST_TYPES = ['Sermon', 'Blog', 'Event', 'Ministry'];
  const STATUS = ['approved', 'pending', 'rejected', 'spam'];
  // --- Utility Functions ---
  function getComments() {
    let comments = JSON.parse(localStorage.getItem(LS_COMMENTS) || 'null');
    if (!comments) {
      comments = [
        { id: 'c1', postType: 'Sermon', postTitle: 'Walking in Faith', commenter: 'Jane Doe', comment: 'Great message!', status: 'approved', date: '2024-06-01T10:00:00Z', replies: [], suspended: false },
        { id: 'c2', postType: 'Blog', postTitle: 'How to Pray', commenter: 'John Smith', comment: 'Very helpful, thanks!', status: 'pending', date: '2024-06-02T09:00:00Z', replies: [], suspended: false },
        { id: 'c3', postType: 'Event', postTitle: 'Youth Camp', commenter: 'Mary Wanjiku', comment: 'Looking forward to this!', status: 'pending', date: '2024-06-03T08:00:00Z', replies: [], suspended: false },
        { id: 'c4', postType: 'Ministry', postTitle: 'Women Fellowship', commenter: 'Cyrilla Chikamai', comment: 'Blessed to be part of this ministry.', status: 'approved', date: '2024-06-04T07:00:00Z', replies: [], suspended: false },
        { id: 'c5', postType: 'Blog', postTitle: 'Faith in Action', commenter: 'SpamBot', comment: 'Buy cheap products at spam.com', status: 'spam', date: '2024-06-05T07:00:00Z', replies: [], suspended: false }
      ];
      localStorage.setItem(LS_COMMENTS, JSON.stringify(comments));
    }
    return comments;
  }
  function saveComments(comments) { localStorage.setItem(LS_COMMENTS, JSON.stringify(comments)); }
  function generateId() { return 'c-' + Math.random().toString(36).substr(2, 9); }
  function formatDate(iso) { if (!iso) return ''; const d = new Date(iso); return d.toLocaleDateString() + ' ' + d.toLocaleTimeString(); }
  // --- Render Table ---
  function renderComments() {
    const comments = getComments();
    const tbody = document.getElementById('comments-table-body');
    if (!tbody) return;
    // Filters
    const type = document.getElementById('comment-filter-type').value;
    const status = document.getElementById('comment-filter-status').value;
    const search = document.getElementById('comment-search').value.toLowerCase();
    let filtered = comments.filter(c =>
      (!type || c.postType === type) &&
      (!status || c.status === status) &&
      (!search || c.comment.toLowerCase().includes(search) || c.commenter.toLowerCase().includes(search) || c.postTitle.toLowerCase().includes(search))
    );
    tbody.innerHTML = filtered.map(c => `
      <tr>
        <td class="px-4 py-2">${c.postType}</td>
        <td class="px-4 py-2">${c.postTitle}</td>
        <td class="px-4 py-2">${c.commenter}</td>
        <td class="px-4 py-2">${c.comment}</td>
        <td class="px-4 py-2"><span class="${c.status === 'approved' ? 'bg-green-100 text-green-700' : c.status === 'pending' ? 'bg-yellow-100 text-yellow-700' : c.status === 'rejected' ? 'bg-red-100 text-red-700' : 'bg-gray-200 text-gray-700'} px-2 py-1 rounded">${c.status.charAt(0).toUpperCase() + c.status.slice(1)}</span></td>
        <td class="px-4 py-2 text-xs">${formatDate(c.date)}</td>
        <td class="px-4 py-2 flex gap-2">
          ${c.status === 'pending' ? `<button class='px-2 py-1 bg-green-500 text-white rounded text-xs' onclick='window.approveComment("${c.id}")'>Approve</button><button class='px-2 py-1 bg-red-500 text-white rounded text-xs' onclick='window.rejectComment("${c.id}")'>Reject</button>` : ''}
          <button class="px-2 py-1 bg-[#2046B3] text-white rounded text-xs" onclick="window.editComment('${c.id}')"><i class="fas fa-edit"></i> Edit</button>
          <button class="px-2 py-1 bg-[#7C3AED] text-white rounded text-xs" onclick="window.replyComment('${c.id}')"><i class="fas fa-reply"></i> Reply</button>
          <button class="px-2 py-1 bg-gray-400 text-white rounded text-xs" onclick="window.markSpam('${c.id}')"><i class="fas fa-ban"></i> Spam</button>
          <button class="px-2 py-1 bg-red-500 text-white rounded text-xs" onclick="window.deleteComment('${c.id}')"><i class="fas fa-trash"></i></button>
        </td>
      </tr>
      ${c.replies && c.replies.length ? c.replies.map(r => `<tr class='bg-gray-50'><td></td><td colspan='2' class='px-4 py-2 text-xs text-gray-500'>Reply from Ministry Team</td><td class='px-4 py-2 text-xs text-gray-700' colspan='4'>${r.text} <span class='ml-2 text-gray-400'>${formatDate(r.date)}</span></td></tr>`).join('') : ''}
    `).join('');
  }
  // --- Modal Logic ---
  function showModal(html) {
    const modals = document.getElementById('comments-modals');
    modals.innerHTML = html;
    modals.classList.remove('hidden');
    modals.onclick = e => { if (e.target === modals) closeModal(); };
    modals.querySelectorAll('.close-modal').forEach(btn => btn.onclick = closeModal);
  }
  function closeModal() {
    const modals = document.getElementById('comments-modals');
    modals.innerHTML = '';
    modals.classList.add('hidden');
  }
  // --- Approve/Reject ---
  window.approveComment = function(id) {
    let comments = getComments();
    const idx = comments.findIndex(c => c.id === id);
    comments[idx].status = 'approved';
    saveComments(comments);
    renderComments();
  };
  window.rejectComment = function(id) {
    let comments = getComments();
    const idx = comments.findIndex(c => c.id === id);
    comments[idx].status = 'rejected';
    saveComments(comments);
    renderComments();
  };
  // --- Edit Comment ---
  window.editComment = function(id) {
    const c = getComments().find(x => x.id === id);
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-lg p-6' id='edit-comment-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#2046B3]'>Edit Comment</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Comment</label><textarea name='comment' class='w-full px-3 py-2 border rounded' required>${c.comment}</textarea></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#2046B3] text-white rounded font-bold'>Save</button></div></form></div></div>`);
    document.getElementById('edit-comment-form').onsubmit = function(e) {
      e.preventDefault();
      let comments = getComments();
      const idx = comments.findIndex(x => x.id === id);
      comments[idx].comment = e.target.comment.value;
      saveComments(comments);
      closeModal();
      renderComments();
    };
  };
  // --- Delete Comment ---
  window.deleteComment = function(id) {
    if (!confirm('Delete this comment?')) return;
    let comments = getComments();
    comments = comments.filter(c => c.id !== id);
    saveComments(comments);
    renderComments();
  };
  // --- Reply to Comment ---
  window.replyComment = function(id) {
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-lg p-6' id='reply-comment-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#7C3AED]'>Reply to Comment</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Reply</label><textarea name='reply' class='w-full px-3 py-2 border rounded' required></textarea></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded font-bold'>Reply</button></div></form></div></div>`);
    document.getElementById('reply-comment-form').onsubmit = function(e) {
      e.preventDefault();
      let comments = getComments();
      const idx = comments.findIndex(x => x.id === id);
      comments[idx].replies = comments[idx].replies || [];
      comments[idx].replies.push({ text: e.target.reply.value, date: new Date().toISOString() });
      saveComments(comments);
      closeModal();
      renderComments();
    };
  };
  // --- Mark as Spam ---
  window.markSpam = function(id) {
    let comments = getComments();
    const idx = comments.findIndex(c => c.id === id);
    comments[idx].status = 'spam';
    saveComments(comments);
    renderComments();
  };
  // --- Export Comments ---
  document.getElementById('export-comments-btn').onclick = function() {
    const comments = getComments();
    const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(comments, null, 2));
    const dlAnchor = document.createElement('a');
    dlAnchor.setAttribute('href', dataStr);
    dlAnchor.setAttribute('download', 'comments_export.json');
    document.body.appendChild(dlAnchor);
    dlAnchor.click();
    dlAnchor.remove();
  };
  // --- Filters ---
  document.getElementById('comment-search').oninput = renderComments;
  document.getElementById('comment-filter-type').onchange = renderComments;
  document.getElementById('comment-filter-status').onchange = renderComments;
  // --- Initial Render ---
  renderComments();
})();
</script>

<section id="media-section" class="hidden">
  <div class="text-2xl font-bold text-[#2046B3] mb-4 flex items-center gap-4">
    <i class="fas fa-upload"></i>Media Management
    <button id="upload-media-btn" class="ml-auto px-4 py-2 bg-[#F59E0B] text-white font-bold rounded-lg hover:bg-[#7C3AED] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-plus"></i>Upload Media
    </button>
    <button id="backup-media-btn" class="px-4 py-2 bg-[#2046B3] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-database"></i>Backup
    </button>
  </div>
  <div class="mb-4 flex flex-wrap gap-2 items-center">
    <input type="text" id="media-search" placeholder="Search media..." class="px-4 py-2 border rounded w-64" />
    <select id="media-filter-type" class="px-3 py-2 border rounded">
      <option value="">All Types</option>
      <option value="image">Image</option>
      <option value="video">Video</option>
      <option value="audio">Audio</option>
      <option value="pdf">PDF</option>
    </select>
    <select id="media-filter-category" class="px-3 py-2 border rounded">
      <option value="">All Categories</option>
    </select>
    <select id="media-filter-status" class="px-3 py-2 border rounded">
      <option value="">All Statuses</option>
      <option value="public">Public</option>
      <option value="private">Private</option>
      <option value="pending">Pending</option>
      <option value="archived">Archived</option>
    </select>
  </div>
  <div class="overflow-x-auto mb-6">
    <table class="w-full bg-white rounded-xl shadow border border-gray-200">
      <thead class="bg-[#2046B3] text-white">
        <tr>
          <th class="px-4 py-2 text-left">Type</th>
          <th class="px-4 py-2 text-left">Title</th>
          <th class="px-4 py-2 text-left">Category</th>
          <th class="px-4 py-2 text-left">Tags</th>
          <th class="px-4 py-2 text-left">Status</th>
          <th class="px-4 py-2 text-left">Analytics</th>
          <th class="px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody id="media-table-body">
        <!-- Media will be rendered here -->
      </tbody>
    </table>
  </div>
  <div id="media-modals"></div>
</section>
<script id="media-admin-script">
(function() {
  // --- Data Model ---
  const LS_MEDIA = 'admin_media';
  const DEMO_CATEGORIES = ['Sermons', 'Events', 'Ministries', 'Gallery', 'Resources'];
  const DEMO_TAGS = ['Sunday Service', 'Youth', 'Conference', 'Devotional', 'Revival'];
  const STATUS = ['public', 'private', 'pending', 'archived'];
  const TYPES = ['image', 'video', 'audio', 'pdf'];
  // --- Utility Functions ---
  function getMedia() {
    let media = JSON.parse(localStorage.getItem(LS_MEDIA) || 'null');
    if (!media) {
      media = [
        { id: 'm1', type: 'image', title: 'Revival Conference', category: 'Events', tags: ['Conference'], status: 'public', url: '', analytics: { views: 120, downloads: 10 }, uploadedBy: 'Admin', date: '2024-06-01T10:00:00Z' },
        { id: 'm2', type: 'video', title: 'Sunday Sermon', category: 'Sermons', tags: ['Sunday Service'], status: 'public', url: '', analytics: { views: 200, downloads: 30 }, uploadedBy: 'Pastor John', date: '2024-06-02T09:00:00Z' },
        { id: 'm3', type: 'pdf', title: 'Devotional Guide', category: 'Resources', tags: ['Devotional'], status: 'private', url: '', analytics: { views: 50, downloads: 25 }, uploadedBy: 'Admin', date: '2024-06-03T08:00:00Z' },
        { id: 'm4', type: 'audio', title: 'Youth Worship', category: 'Ministries', tags: ['Youth'], status: 'pending', url: '', analytics: { views: 80, downloads: 15 }, uploadedBy: 'Media Team', date: '2024-06-04T07:00:00Z' }
      ];
      localStorage.setItem(LS_MEDIA, JSON.stringify(media));
    }
    return media;
  }
  function saveMedia(media) { localStorage.setItem(LS_MEDIA, JSON.stringify(media)); }
  function generateId() { return 'm-' + Math.random().toString(36).substr(2, 9); }
  function formatDate(iso) { if (!iso) return ''; const d = new Date(iso); return d.toLocaleDateString() + ' ' + d.toLocaleTimeString(); }
  // --- Render Table ---
  function renderMedia() {
    const media = getMedia();
    const tbody = document.getElementById('media-table-body');
    if (!tbody) return;
    // Filters
    const type = document.getElementById('media-filter-type').value;
    const category = document.getElementById('media-filter-category').value;
    const status = document.getElementById('media-filter-status').value;
    const search = document.getElementById('media-search').value.toLowerCase();
    let filtered = media.filter(m =>
      (!type || m.type === type) &&
      (!category || m.category === category) &&
      (!status || m.status === status) &&
      (!search || m.title.toLowerCase().includes(search) || (m.tags||[]).join(',').toLowerCase().includes(search))
    );
    tbody.innerHTML = filtered.map(m => `
      <tr>
        <td class="px-4 py-2">${m.type.charAt(0).toUpperCase() + m.type.slice(1)}</td>
        <td class="px-4 py-2">${m.title}</td>
        <td class="px-4 py-2">${m.category}</td>
        <td class="px-4 py-2 text-xs">${(m.tags||[]).map(t => `<span class='bg-[#F59E0B]/20 text-[#F59E0B] px-2 py-1 rounded mr-1'>${t}</span>`).join('')}</td>
        <td class="px-4 py-2"><span class="${m.status === 'public' ? 'bg-green-100 text-green-700' : m.status === 'private' ? 'bg-gray-200 text-gray-700' : m.status === 'pending' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-400'} px-2 py-1 rounded">${m.status.charAt(0).toUpperCase() + m.status.slice(1)}</span></td>
        <td class="px-4 py-2 text-xs">${m.analytics?.views ?? 0} views<br>${m.analytics?.downloads ?? 0} downloads</td>
        <td class="px-4 py-2 flex gap-2">
          <button class="px-2 py-1 bg-[#2046B3] text-white rounded text-xs" onclick="window.editMedia('${m.id}')"><i class="fas fa-edit"></i> Edit</button>
          <button class="px-2 py-1 bg-[#7C3AED] text-white rounded text-xs" onclick="window.embedMedia('${m.id}')"><i class="fas fa-link"></i> Embed</button>
          <button class="px-2 py-1 bg-gray-400 text-white rounded text-xs" onclick="window.toggleMediaStatus('${m.id}')">${m.status === 'public' ? 'Unpublish' : 'Publish'}</button>
          <button class="px-2 py-1 bg-yellow-500 text-white rounded text-xs" onclick="window.archiveMedia('${m.id}')">Archive</button>
          <button class="px-2 py-1 bg-red-500 text-white rounded text-xs" onclick="window.deleteMedia('${m.id}')"><i class="fas fa-trash"></i></button>
        </td>
      </tr>
    `).join('');
    // Populate category filter
    const catSel = document.getElementById('media-filter-category');
    catSel.innerHTML = `<option value=''>All Categories</option>` + DEMO_CATEGORIES.map(c => `<option value='${c}'>${c}</option>`).join('');
  }
  // --- Modal Logic ---
  function showModal(html) {
    const modals = document.getElementById('media-modals');
    modals.innerHTML = html;
    modals.classList.remove('hidden');
    modals.onclick = e => { if (e.target === modals) closeModal(); };
    modals.querySelectorAll('.close-modal').forEach(btn => btn.onclick = closeModal);
  }
  function closeModal() {
    const modals = document.getElementById('media-modals');
    modals.innerHTML = '';
    modals.classList.add('hidden');
  }
  // --- Upload Media Modal ---
  document.getElementById('upload-media-btn').onclick = function() { openMediaModal(); };
  window.editMedia = function(id) { openMediaModal(id); };
  function openMediaModal(id) {
    let m = id ? getMedia().find(x => x.id === id) : null;
    showModal(`
      <div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'>
        <form class='bg-white rounded-xl shadow-xl w-full max-w-2xl p-6' id='media-form'>
          <div class='flex items-center justify-between mb-4'>
            <h3 class='text-lg font-bold text-[#2046B3]'>${id ? 'Edit Media' : 'Upload Media'}</h3>
            <button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button>
          </div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Title</label><input type='text' name='title' class='w-full px-3 py-2 border rounded' value='${m?.title||''}' required></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Type</label><select name='type' class='w-full px-3 py-2 border rounded'>${TYPES.map(t => `<option value='${t}' ${m?.type===t?'selected':''}>${t.charAt(0).toUpperCase()+t.slice(1)}</option>`).join('')}</select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Category</label><select name='category' class='w-full px-3 py-2 border rounded'>${DEMO_CATEGORIES.map(c => `<option value='${c}' ${m?.category===c?'selected':''}>${c}</option>`).join('')}</select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Tags (comma separated)</label><input type='text' name='tags' class='w-full px-3 py-2 border rounded' value='${(m?.tags||[]).join(', ')}'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Status</label><select name='status' class='w-full px-3 py-2 border rounded'>${STATUS.map(s => `<option value='${s}' ${m?.status===s?'selected':''}>${s.charAt(0).toUpperCase()+s.slice(1)}</option>`).join('')}</select></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>File URL</label><input type='text' name='url' class='w-full px-3 py-2 border rounded' value='${m?.url||''}' placeholder='Paste or upload file URL'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Analytics (views/downloads)</label><input type='number' name='views' class='w-24 px-3 py-2 border rounded' value='${m?.analytics?.views||0}' min='0'> <input type='number' name='downloads' class='w-24 px-3 py-2 border rounded' value='${m?.analytics?.downloads||0}' min='0'></div>
          <div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#2046B3] text-white rounded font-bold'>${id ? 'Save' : 'Upload'}</button></div>
        </form>
      </div>
    `);
    document.getElementById('media-form').onsubmit = function(e) {
      e.preventDefault();
      let media = getMedia();
      const f = e.target;
      const obj = {
        id: id || generateId(),
        type: f.type.value,
        title: f.title.value,
        category: f.category.value,
        tags: f.tags.value.split(',').map(s=>s.trim()).filter(Boolean),
        status: f.status.value,
        url: f.url.value,
        analytics: { views: parseInt(f.views.value)||0, downloads: parseInt(f.downloads.value)||0 },
        uploadedBy: m?.uploadedBy || 'Admin',
        date: m?.date || new Date().toISOString()
      };
      if (id) {
        const idx = media.findIndex(x => x.id === id);
        media[idx] = obj;
      } else {
        media.push(obj);
      }
      saveMedia(media);
      closeModal();
      renderMedia();
    };
  }
  // --- Delete Media ---
  window.deleteMedia = function(id) {
    if (!confirm('Delete this media?')) return;
    let media = getMedia();
    media = media.filter(m => m.id !== id);
    saveMedia(media);
    renderMedia();
  };
  // --- Publish/Unpublish ---
  window.toggleMediaStatus = function(id) {
    let media = getMedia();
    const idx = media.findIndex(m => m.id === id);
    media[idx].status = media[idx].status === 'public' ? 'private' : 'public';
    saveMedia(media);
    renderMedia();
  };
  // --- Archive Media ---
  window.archiveMedia = function(id) {
    let media = getMedia();
    const idx = media.findIndex(m => m.id === id);
    media[idx].status = 'archived';
    saveMedia(media);
    renderMedia();
  };
  // --- Embed Media ---
  window.embedMedia = function(id) {
    const m = getMedia().find(x => x.id === id);
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><div class='bg-white rounded-xl shadow-xl w-full max-w-lg p-6'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#7C3AED]'>Embed Media</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Embed Code</label><textarea class='w-full px-3 py-2 border rounded' readonly><${m.type} src='${m.url}' title='${m.title}'></${m.type}></textarea></div><div class='mb-3 text-xs text-gray-500'>Copy and paste this code into sermons, blogs, events, or homepage sections as needed.</div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Close</button></div></div></div>`);
  };
  // --- Backup Media ---
  document.getElementById('backup-media-btn').onclick = function() {
    const media = getMedia();
    const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(media, null, 2));
    const dlAnchor = document.createElement('a');
    dlAnchor.setAttribute('href', dataStr);
    dlAnchor.setAttribute('download', 'media_backup.json');
    document.body.appendChild(dlAnchor);
    dlAnchor.click();
    dlAnchor.remove();
  };
  // --- Filters ---
  document.getElementById('media-search').oninput = renderMedia;
  document.getElementById('media-filter-type').onchange = renderMedia;
  document.getElementById('media-filter-category').onchange = renderMedia;
  document.getElementById('media-filter-status').onchange = renderMedia;
  // --- Initial Render ---
  renderMedia();
})();
</script>

<section id="newsletter-section" class="hidden">
  <div class="text-2xl font-bold text-[#7C3AED] mb-4 flex items-center gap-4">
    <i class="fas fa-envelope-open-text"></i>Newsletter Management
    <button id="compose-newsletter-btn" class="ml-auto px-4 py-2 bg-[#F59E0B] text-white font-bold rounded-lg hover:bg-[#2046B3] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-plus"></i>Compose
    </button>
    <button id="manage-subscribers-btn" class="px-4 py-2 bg-[#2046B3] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-users"></i>Subscribers
    </button>
    <button id="newsletter-templates-btn" class="px-4 py-2 bg-[#7C3AED] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-copy"></i>Templates
    </button>
    <button id="newsletter-settings-btn" class="px-4 py-2 bg-gray-400 text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-cog"></i>Settings
    </button>
    <button id="export-subscribers-btn" class="px-4 py-2 bg-[#2046B3] text-white font-bold rounded-lg hover:bg-[#F59E0B] hover:text-white transition-all flex items-center gap-2">
      <i class="fas fa-file-export"></i>Export
    </button>
  </div>
  <div class="overflow-x-auto mb-6">
    <table class="w-full bg-white rounded-xl shadow border border-gray-200">
      <thead class="bg-[#7C3AED] text-white">
        <tr>
          <th class="px-4 py-2 text-left">Title</th>
          <th class="px-4 py-2 text-left">Status</th>
          <th class="px-4 py-2 text-left">Recipients</th>
          <th class="px-4 py-2 text-left">Scheduled/Sent</th>
          <th class="px-4 py-2 text-left">Analytics</th>
          <th class="px-4 py-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody id="newsletter-table-body">
        <!-- Newsletters will be rendered here -->
      </tbody>
    </table>
  </div>
  <div id="newsletter-modals"></div>
</section>
<script id="newsletter-admin-script">
(function() {
  // --- Data Model ---
  const LS_NEWSLETTERS = 'admin_newsletters';
  const LS_SUBSCRIBERS = 'admin_newsletter_subscribers';
  const LS_TEMPLATES = 'admin_newsletter_templates';
  // --- Utility Functions ---
  function getNewsletters() {
    let n = JSON.parse(localStorage.getItem(LS_NEWSLETTERS) || 'null');
    if (!n) {
      n = [
        { id: 'n1', title: 'June Update', status: 'Sent', recipients: 'All Members', date: '2024-06-01T10:00:00Z', analytics: { open: 120, click: 40, bounce: 2 }, content: '<h2>Welcome to June!</h2><p>Lots of updates...</p>' },
        { id: 'n2', title: 'Upcoming Youth Camp', status: 'Draft', recipients: 'Youth Ministry', date: '', analytics: { open: 0, click: 0, bounce: 0 }, content: '<h2>Youth Camp</h2><p>Register now!</p>' }
      ];
      localStorage.setItem(LS_NEWSLETTERS, JSON.stringify(n));
    }
    return n;
  }
  function saveNewsletters(n) { localStorage.setItem(LS_NEWSLETTERS, JSON.stringify(n)); }
  function getSubscribers() {
    let s = JSON.parse(localStorage.getItem(LS_SUBSCRIBERS) || 'null');
    if (!s) {
      s = [
        { email: 'jane@example.com', status: 'active', date: '2024-05-01' },
        { email: 'mary@example.com', status: 'active', date: '2024-05-02' },
        { email: 'john@example.com', status: 'unsubscribed', date: '2024-05-10' }
      ];
      localStorage.setItem(LS_SUBSCRIBERS, JSON.stringify(s));
    }
    return s;
  }
  function saveSubscribers(s) { localStorage.setItem(LS_SUBSCRIBERS, JSON.stringify(s)); }
  function getTemplates() {
    let t = JSON.parse(localStorage.getItem(LS_TEMPLATES) || 'null');
    if (!t) {
      t = [
        { id: 't1', name: 'Monthly Update', content: '<h1>Monthly Update</h1><p>...</p>' },
        { id: 't2', name: 'Event Invite', content: '<h1>Event Invite</h1><p>...</p>' }
      ];
      localStorage.setItem(LS_TEMPLATES, JSON.stringify(t));
    }
    return t;
  }
  function saveTemplates(t) { localStorage.setItem(LS_TEMPLATES, JSON.stringify(t)); }
  function generateId() { return 'n-' + Math.random().toString(36).substr(2, 9); }
  function formatDate(iso) { if (!iso) return ''; const d = new Date(iso); return d.toLocaleDateString() + ' ' + d.toLocaleTimeString(); }
  // --- Render Table ---
  function renderNewsletters() {
    const n = getNewsletters();
    const tbody = document.getElementById('newsletter-table-body');
    if (!tbody) return;
    tbody.innerHTML = n.map(nl => `
      <tr>
        <td class="px-4 py-2 font-bold">${nl.title}</td>
        <td class="px-4 py-2">${nl.status}</td>
        <td class="px-4 py-2">${nl.recipients}</td>
        <td class="px-4 py-2 text-xs">${nl.date ? formatDate(nl.date) : '-'}</td>
        <td class="px-4 py-2 text-xs">Open: ${nl.analytics?.open ?? 0}<br>Click: ${nl.analytics?.click ?? 0}<br>Bounce: ${nl.analytics?.bounce ?? 0}</td>
        <td class="px-4 py-2 flex gap-2">
          <button class="px-2 py-1 bg-[#2046B3] text-white rounded text-xs" onclick="window.editNewsletter('${nl.id}')"><i class="fas fa-edit"></i> Edit</button>
          <button class="px-2 py-1 bg-[#7C3AED] text-white rounded text-xs" onclick="window.cloneNewsletter('${nl.id}')"><i class="fas fa-copy"></i> Clone</button>
          <button class="px-2 py-1 bg-[#F59E0B] text-white rounded text-xs" onclick="window.sendNewsletter('${nl.id}')"><i class="fas fa-paper-plane"></i> Send</button>
          <button class="px-2 py-1 bg-gray-400 text-white rounded text-xs" onclick="window.archiveNewsletter('${nl.id}')">Archive</button>
          <button class="px-2 py-1 bg-red-500 text-white rounded text-xs" onclick="window.deleteNewsletter('${nl.id}')"><i class="fas fa-trash"></i></button>
        </td>
      </tr>
    `).join('');
  }
  // --- Modal Logic ---
  function showModal(html) {
    const modals = document.getElementById('newsletter-modals');
    modals.innerHTML = html;
    modals.classList.remove('hidden');
    modals.onclick = e => { if (e.target === modals) closeModal(); };
    modals.querySelectorAll('.close-modal').forEach(btn => btn.onclick = closeModal);
  }
  function closeModal() {
    const modals = document.getElementById('newsletter-modals');
    modals.innerHTML = '';
    modals.classList.add('hidden');
  }
  // --- Compose/Edit Newsletter Modal ---
  document.getElementById('compose-newsletter-btn').onclick = function() { openNewsletterModal(); };
  window.editNewsletter = function(id) { openNewsletterModal(id); };
  function openNewsletterModal(id) {
    let nl = id ? getNewsletters().find(x => x.id === id) : null;
    showModal(`
      <div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'>
        <form class='bg-white rounded-xl shadow-xl w-full max-w-2xl p-6' id='newsletter-form'>
          <div class='flex items-center justify-between mb-4'>
            <h3 class='text-lg font-bold text-[#7C3AED]'>${id ? 'Edit Newsletter' : 'Compose Newsletter'}</h3>
            <button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button>
          </div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Title</label><input type='text' name='title' class='w-full px-3 py-2 border rounded' value='${nl?.title||''}' required></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Recipients</label><input type='text' name='recipients' class='w-full px-3 py-2 border rounded' value='${nl?.recipients||'All Members'}'></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Content</label><textarea name='content' class='w-full px-3 py-2 border rounded min-h-[120px]' required>${nl?.content||''}</textarea></div>
          <div class='mb-3'><label class='block font-semibold mb-1'>Schedule (optional)</label><input type='datetime-local' name='date' class='w-full px-3 py-2 border rounded' value='${nl?.date ? nl.date.substring(0,16) : ''}'></div>
          <div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded font-bold'>${id ? 'Save' : 'Create'}</button></div>
        </form>
      </div>
    `);
    document.getElementById('newsletter-form').onsubmit = function(e) {
      e.preventDefault();
      let n = getNewsletters();
      const f = e.target;
      const obj = {
        id: id || generateId(),
        title: f.title.value,
        recipients: f.recipients.value,
        content: f.content.value,
        date: f.date.value ? new Date(f.date.value).toISOString() : '',
        status: id ? (n.find(x => x.id === id)?.status || 'Draft') : 'Draft',
        analytics: nl?.analytics || { open: 0, click: 0, bounce: 0 }
      };
      if (id) {
        const idx = n.findIndex(x => x.id === id);
        n[idx] = obj;
      } else {
        n.push(obj);
      }
      saveNewsletters(n);
      closeModal();
      renderNewsletters();
    };
  }
  // --- Clone Newsletter ---
  window.cloneNewsletter = function(id) {
    let n = getNewsletters();
    const orig = n.find(x => x.id === id);
    if (!orig) return;
    const clone = { ...orig, id: generateId(), title: orig.title + ' (Copy)', status: 'Draft', date: '' };
    n.push(clone);
    saveNewsletters(n);
    renderNewsletters();
  };
  // --- Send Newsletter ---
  window.sendNewsletter = function(id) {
    let n = getNewsletters();
    const idx = n.findIndex(x => x.id === id);
    n[idx].status = 'Sent';
    n[idx].date = new Date().toISOString();
    saveNewsletters(n);
    renderNewsletters();
    alert('Newsletter sent (demo)!');
  };
  // --- Archive Newsletter ---
  window.archiveNewsletter = function(id) {
    let n = getNewsletters();
    const idx = n.findIndex(x => x.id === id);
    n[idx].status = 'Archived';
    saveNewsletters(n);
    renderNewsletters();
  };
  // --- Delete Newsletter ---
  window.deleteNewsletter = function(id) {
    if (!confirm('Delete this newsletter?')) return;
    let n = getNewsletters();
    n = n.filter(x => x.id !== id);
    saveNewsletters(n);
    renderNewsletters();
  };
  // --- Subscribers Modal ---
  document.getElementById('manage-subscribers-btn').onclick = function() {
    const s = getSubscribers();
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><div class='bg-white rounded-xl shadow-xl w-full max-w-2xl p-6'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#2046B3]'>Subscribers</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><form id='add-subscriber-form' class='flex gap-2'><input type='email' name='email' placeholder='Add email' class='px-3 py-2 border rounded' required><button type='submit' class='px-4 py-2 bg-[#2046B3] text-white rounded'>Add</button></form></div><div class='overflow-x-auto'><table class='w-full bg-white rounded-xl shadow border border-gray-200'><thead class='bg-[#2046B3] text-white'><tr><th class='px-4 py-2 text-left'>Email</th><th class='px-4 py-2 text-left'>Status</th><th class='px-4 py-2 text-left'>Date</th><th class='px-4 py-2 text-left'>Actions</th></tr></thead><tbody>${s.map(sub => `<tr><td class='px-4 py-2'>${sub.email}</td><td class='px-4 py-2'>${sub.status}</td><td class='px-4 py-2'>${sub.date}</td><td class='px-4 py-2'><button class='px-2 py-1 bg-red-500 text-white rounded text-xs' onclick='window.removeSubscriber("${sub.email}")'>Remove</button></td></tr>`).join('')}</tbody></table></div></div></div>`);
    document.getElementById('add-subscriber-form').onsubmit = function(e) {
      e.preventDefault();
      let s = getSubscribers();
      const email = e.target.email.value.trim();
      if (!email || s.find(x => x.email === email)) return;
      s.push({ email, status: 'active', date: new Date().toISOString().substring(0,10) });
      saveSubscribers(s);
      closeModal();
      document.getElementById('manage-subscribers-btn').click();
    };
  };
  window.removeSubscriber = function(email) {
    let s = getSubscribers();
    s = s.filter(x => x.email !== email);
    saveSubscribers(s);
    closeModal();
    document.getElementById('manage-subscribers-btn').click();
  };
  // --- Templates Modal ---
  document.getElementById('newsletter-templates-btn').onclick = function() {
    const t = getTemplates();
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><div class='bg-white rounded-xl shadow-xl w-full max-w-2xl p-6'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#7C3AED]'>Templates</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><form id='add-template-form' class='flex gap-2'><input type='text' name='name' placeholder='Template name' class='px-3 py-2 border rounded' required><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded'>Add</button></form></div><div class='overflow-x-auto'><table class='w-full bg-white rounded-xl shadow border border-gray-200'><thead class='bg-[#7C3AED] text-white'><tr><th class='px-4 py-2 text-left'>Name</th><th class='px-4 py-2 text-left'>Actions</th></tr></thead><tbody>${t.map(temp => `<tr><td class='px-4 py-2'>${temp.name}</td><td class='px-4 py-2'><button class='px-2 py-1 bg-[#2046B3] text-white rounded text-xs' onclick='window.editTemplate("${temp.id}")'>Edit</button><button class='px-2 py-1 bg-red-500 text-white rounded text-xs' onclick='window.deleteTemplate("${temp.id}")'>Delete</button></td></tr>`).join('')}</tbody></table></div></div></div>`);
    document.getElementById('add-template-form').onsubmit = function(e) {
      e.preventDefault();
      let t = getTemplates();
      const name = e.target.name.value.trim();
      if (!name || t.find(x => x.name === name)) return;
      t.push({ id: generateId(), name, content: '' });
      saveTemplates(t);
      closeModal();
      document.getElementById('newsletter-templates-btn').click();
    };
  };
  window.editTemplate = function(id) {
    const t = getTemplates();
    const temp = t.find(x => x.id === id);
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-lg p-6' id='edit-template-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-[#7C3AED]'>Edit Template</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Name</label><input type='text' name='name' class='w-full px-3 py-2 border rounded' value='${temp.name}' required></div><div class='mb-3'><label class='block font-semibold mb-1'>Content (HTML allowed)</label><textarea name='content' class='w-full px-3 py-2 border rounded min-h-[120px]' required>${temp.content}</textarea></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Cancel</button><button type='submit' class='px-4 py-2 bg-[#7C3AED] text-white rounded font-bold'>Save</button></div></form></div></div>`);
    document.getElementById('edit-template-form').onsubmit = function(e) {
      e.preventDefault();
      let t = getTemplates();
      const idx = t.findIndex(x => x.id === id);
      t[idx].name = e.target.name.value;
      t[idx].content = e.target.content.value;
      saveTemplates(t);
      closeModal();
      document.getElementById('newsletter-templates-btn').click();
    };
  };
  window.deleteTemplate = function(id) {
    let t = getTemplates();
    t = t.filter(x => x.id !== id);
    saveTemplates(t);
    closeModal();
    document.getElementById('newsletter-templates-btn').click();
  };
  // --- Settings Modal ---
  document.getElementById('newsletter-settings-btn').onclick = function() {
    showModal(`<div class='fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50'><form class='bg-white rounded-xl shadow-xl w-full max-w-lg p-6' id='newsletter-settings-form'><div class='flex items-center justify-between mb-4'><h3 class='text-lg font-bold text-gray-700'>Newsletter Settings</h3><button type='button' class='close-modal text-gray-400 hover:text-red-500 text-2xl'>&times;</button></div><div class='mb-3'><label class='block font-semibold mb-1'>Sender Name</label><input type='text' name='sender' class='w-full px-3 py-2 border rounded' value='Hearts After God Ministry'></div><div class='mb-3'><label class='block font-semibold mb-1'>Reply-To Email</label><input type='email' name='reply' class='w-full px-3 py-2 border rounded' value='info@heartsaftergod.org'></div><div class='mb-3'><label class='block font-semibold mb-1'>Auto-subscribe on registration</label><select name='auto' class='w-full px-3 py-2 border rounded'><option value='yes'>Yes</option><option value='no'>No</option></select></div><div class='mb-3'><label class='block font-semibold mb-1'>Frequency</label><select name='freq' class='w-full px-3 py-2 border rounded'><option value='weekly'>Weekly</option><option value='monthly'>Monthly</option><option value='custom'>Custom</option></select></div><div class='flex justify-end gap-2 mt-4'><button type='button' class='close-modal px-4 py-2 bg-gray-200 rounded'>Close</button></div></form></div></div>`);
  };
  // --- Export Subscribers ---
  document.getElementById('export-subscribers-btn').onclick = function() {
    const s = getSubscribers();
    let csv = 'Email,Status,Date\n' + s.map(x => `${x.email},${x.status},${x.date}`).join('\n');
    const dataStr = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
    const dlAnchor = document.createElement('a');
    dlAnchor.setAttribute('href', dataStr);
    dlAnchor.setAttribute('download', 'subscribers.csv');
    document.body.appendChild(dlAnchor);
    dlAnchor.click();
    dlAnchor.remove();
  };
  // --- Initial Render ---
  renderNewsletters();
})();
</script>

</body>
</html> 