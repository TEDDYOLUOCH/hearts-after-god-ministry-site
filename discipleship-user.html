<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard | Discipleship Portal | Hearts After God Ministry</title>
  <meta name="description" content="Your personal discipleship dashboard. Track your progress, access lessons, and connect with the community.">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#7C3AED',
            secondary: '#FDBA17',
            accent: '#2046B3',
          },
        },
      },
    }
  </script>
  <style>
    /* Hero section styling */
    .hero-gradient {
      background: linear-gradient(135deg, #7C3AED 0%, #2046B3 50%, #FDBA17 100%);
    }
    .hero-pattern {
      background-image: url('data:image/svg+xml;utf8,<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="30" cy="30" r="1" fill="white" fill-opacity="0.1"/><circle cx="15" cy="15" r="0.5" fill="white" fill-opacity="0.1"/><circle cx="45" cy="45" r="0.5" fill="white" fill-opacity="0.1"/></svg>');
    }
    /* Dashboard styling */
    .dashboard-section {
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.05) 0%, rgba(253, 186, 23, 0.05) 100%);
      border: 1px solid rgba(124, 58, 237, 0.1);
    }
    .sidebar-link.active {
      background: linear-gradient(135deg, #7C3AED 0%, #2046B3 100%);
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
    }
    .sidebar-link {
      transition: all 0.3s ease;
      color: #2046B3;
    }
    .sidebar-link:hover {
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(253, 186, 23, 0.1) 100%);
      color: #7C3AED;
      transform: translateX(4px);
    }
    .scrollbar::-webkit-scrollbar {
      width: 8px;
      background: rgba(124, 58, 237, 0.1);
    }
    .scrollbar::-webkit-scrollbar-thumb {
      background: #7C3AED;
      border-radius: 4px;
    }
    /* Card and section backgrounds */
    .dashboard-section, .dashboard-card, .sidebar, .navbar {
      background: rgba(255,255,255,0.95) !important;
      backdrop-filter: blur(10px);
    }
    /* Section headings */
    .section-title {
      color: #2046B3;
      font-weight: bold;
    }
    /* Brand color highlights */
    .brand-gold { color: #FDBA17; }
    .brand-blue { color: #2046B3; }
    .brand-purple { color: #7C3AED; }
    .border-gold { border-color: #FDBA17 !important; }
    .border-blue { border-color: #2046B3 !important; }
    .border-purple { border-color: #7C3AED !important; }
    /* Button gradients */
    .btn-gold {
      background: linear-gradient(135deg, #FDBA17 0%, #E0A615 100%);
      color: #2046B3;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .btn-gold:hover {
      box-shadow: 0 8px 25px rgba(253, 186, 23, 0.3);
      transform: translateY(-2px) scale(1.02);
    }
    /* Animated underline for nav */
    .nav-underline {
      position: absolute;
      left: 0;
      bottom: 0;
      height: 3px;
      background: #FDBA17;
      border-radius: 2px;
      transition: all 0.3s cubic-bezier(.4,0,.2,1);
      z-index: 10;
    }
    .nav-link {
      position: relative;
      padding-bottom: 4px;
      transition: color 0.2s;
      text-shadow: 0 1px 6px rgba(32, 70, 179, 0.18);
    }
    .nav-link.active {
      font-weight: bold;
      color: #FDBA17;
      text-shadow: 0 1px 6px rgba(32, 70, 179, 0.18);
    }
    .nav-link:focus {
      outline: 2px solid #FDBA17;
      outline-offset: 2px;
    }
    
    /* Real-time animations */
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in {
      animation: fade-in 0.5s ease-out;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
      50% { transform: none; animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
    }
    
    .animate-bounce {
      animation: bounce 1s infinite;
    }
    /* Custom SVG pattern for header */
    .header-pattern {
      background: linear-gradient(90deg, #F3E8FF 0%, #FEF3C7 100%);
      background-image: url('data:image/svg+xml;utf8,<svg width="600" height="120" viewBox="0 0 600 120" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="g1" x1="0" y1="0" x2="0" y2="1"><stop stop-color="%237C3AED" stop-opacity="0.75" offset="0%"/><stop stop-color="%23FDBA17" stop-opacity="0.65" offset="100%"/></linearGradient><linearGradient id="g2" x1="0" y1="0" x2="0" y2="1"><stop stop-color="%237C3AED" stop-opacity="0.55" offset="0%"/><stop stop-color="%23FDBA17" stop-opacity="0.45" offset="100%"/></linearGradient></defs><path d="M0 80 C100 0 500 160 600 80 V120 H0Z" fill="url(%23g1)"/><path d="M0 100 C100 40 500 180 600 100 V120 H0Z" fill="url(%23g2)"/></svg>');
      background-repeat: repeat-x;
      background-size: 600px 120px;
      position: relative;
    }
    .header-pattern::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 100%;
      z-index: 1;
      pointer-events: none;
      background: linear-gradient(to bottom, rgba(124,58,237,0.92) 0%, rgba(253,186,23,0.85) 100%);
      border-radius: inherit;
    }
    .header-pattern > * {
      position: relative;
      z-index: 2;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 to-white">
  <!-- Top Navbar -->
  <div id="site-header" class="sticky top-0 z-50 w-full"></div>
  <header class="sticky top-0 z-50 header-pattern backdrop-blur shadow-lg rounded-b-2xl">
    <nav class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3 relative">
      <!-- Logo -->
      <div class="flex items-center gap-3">
        <img src="assets/images/WhatsApp Image 2025-07-04 at 17.27.34_37ced412.jpg" alt="Hearts After God Ministry Logo" class="h-12 w-12 rounded-full shadow-lg border-4 border-[#2046B3] transition-transform duration-300 hover:scale-105 hover:shadow-xl" />
        <span class="text-xl font-bold text-white">Hearts After God</span>
      </div>
      
      <!-- Navigation Links -->
      <div class="hidden md:flex gap-8 font-semibold text-white text-lg mx-auto relative" id="nav-links">
        <ul class="flex gap-8">
          <li><a href="index.html" class="nav-link" id="nav-home">Home</a></li>
          <li><a href="about.html" class="nav-link" id="nav-about">About</a></li>
          <li><a href="vision.html" class="nav-link" id="nav-vision">Vision</a></li>
          <li><a href="events.html" class="nav-link" id="nav-events">Events</a></li>
          <li><a href="sermons.html" class="nav-link" id="nav-sermons">Sermons</a></li>
          <li><a href="blog.html" class="nav-link" id="nav-blog">Blog</a></li>
          <li><a href="gallery.html" class="nav-link" id="nav-gallery">Gallery</a></li>
          <li><a href="discipleship.html" class="nav-link active" id="nav-discipleship">Discipleship</a></li>
          <li><a href="missions.html" class="nav-link" id="nav-missions">Missions</a></li>
          <li><a href="contact.html" class="nav-link" id="nav-contact">Contact</a></li>
      </ul>
        <span id="nav-underline" class="nav-underline" style="width: 0;"></span>
      </div>
      
      <!-- User Menu -->
      <div class="relative group">
        <button class="flex items-center gap-2 px-4 py-2 bg-[#FDBA17] text-[#2046B3] rounded-full shadow hover:bg-[#E0A615] transition-all transform hover:scale-105 font-bold">
          <span id="nav-user-avatar" class="bg-[#2046B3] text-white rounded-full w-8 h-8 flex items-center justify-center font-bold"></span>
          <span id="nav-user-name" class="hidden md:inline"></span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg py-2 z-50 hidden group-hover:block border border-gray-100">
          <a href="#profile" class="block px-4 py-2 text-[#2046B3] hover:bg-[#7C3AED]/10 transition-colors">
            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
            View Profile
          </a>
          <a href="#settings" class="block px-4 py-2 text-[#2046B3] hover:bg-[#7C3AED]/10 transition-colors">
            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            Settings
          </a>
          <hr class="my-2 border-gray-200">
          <button id="logout-btn" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 transition-colors">
            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
            </svg>
            Logout
          </button>
        </div>
      </div>
    </nav>
  </header>

  <!-- Sidebar Navigation (left) -->
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gradient-to-b from-[#7C3AED] to-[#FDBA17] text-white flex-shrink-0 hidden md:flex flex-col py-8 px-4 sticky top-0 h-screen z-40">
      <div class="flex flex-col gap-6">
        <div class="flex items-center gap-3 mb-8">
          <img src="assets/images/WhatsApp Image 2025-07-04 at 17.27.34_37ced412.jpg" alt="Logo" class="h-12 w-12 rounded-full border-4 border-[#FDBA17] shadow-lg" />
          <span class="text-xl font-bold">Discipleship</span>
      </div>
        <nav class="flex flex-col gap-2">
          <button class="sidebar-link" data-section="overview">Overview</button>
          <button class="sidebar-link" data-section="curriculum">14-Day Curriculum</button>
          <button class="sidebar-link" data-section="progress">Progress</button>
          <button class="sidebar-link" data-section="resources">Resources</button>
          <button class="sidebar-link" data-section="mentor">Mentor/Mentee</button>
          <button class="sidebar-link" data-section="modules">Modules & Assessments</button>
          <button class="sidebar-link" data-section="graduation">Graduation</button>
          <button class="sidebar-link" data-section="pathways">Pathways</button>
        </nav>
      </div>
    </aside>
    <!-- Main Content Area -->
    <main class="flex-1 p-4 md:p-12 bg-white min-h-screen">
      <section id="section-overview" class="dashboard-section rounded-xl shadow p-6 mb-8">
        <h2 class="text-2xl font-bold text-[#7C3AED] mb-4">Welcome to Your Discipleship Dashboard</h2>
        <p class="text-gray-700">Track your journey, access resources, and grow in faith!</p>
      </section>
      <!-- 14-Day Curriculum Section -->
      <section id="section-curriculum" class="dashboard-section rounded-xl shadow p-6 mb-8 hidden">
        <h2 class="text-2xl font-bold text-[#7C3AED] mb-4">14-Day Discipleship Curriculum</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white rounded-xl shadow">
            <thead>
              <tr>
                <th class="p-3 text-left text-[#7C3AED] font-bold">Day</th>
                <th class="p-3 text-left text-[#2046B3] font-bold">Topic</th>
                <th class="p-3 text-left text-[#FDBA17] font-bold">Status</th>
                <th class="p-3 text-left text-[#2046B3] font-bold">Action</th>
              </tr>
            </thead>
            <tbody id="curriculum-table-body">
              <!-- Curriculum rows will be injected by JS -->
            </tbody>
          </table>
          </div>
      </section>
      <!-- Progress Tracking Section -->
      <section id="section-progress" class="dashboard-section rounded-xl shadow p-6 mb-8 hidden">
        <h2 class="text-2xl font-bold text-[#7C3AED] mb-4">Progress Tracking</h2>
        <div class="mb-6">
          <div class="flex items-center justify-between mb-2">
            <span class="font-semibold text-[#2046B3]">Overall Progress</span>
            <span id="progress-percent" class="font-bold text-[#FDBA17]">0%</span>
            </div>
          <div class="w-full h-4 bg-gray-200 rounded-full overflow-hidden">
            <div id="progress-bar" class="h-4 bg-gradient-to-r from-[#7C3AED] to-[#FDBA17] rounded-full transition-all duration-500" style="width:0%"></div>
          </div>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <div class="bg-gradient-to-br from-[#F3E8FF] to-[#FEF3C7] rounded-xl p-4 text-center">
            <div class="text-3xl font-bold text-[#7C3AED]" id="progress-completed">0</div>
            <div class="text-sm text-gray-700">Days Completed</div>
          </div>
          <div class="bg-gradient-to-br from-[#FEF3C7] to-[#F3E8FF] rounded-xl p-4 text-center">
            <div class="text-3xl font-bold text-[#FDBA17]" id="progress-remaining">14</div>
            <div class="text-sm text-gray-700">Days Remaining</div>
          </div>
          <div class="bg-gradient-to-br from-[#7C3AED]/10 to-[#FDBA17]/10 rounded-xl p-4 text-center col-span-2 md:col-span-2">
            <div class="text-lg font-bold text-[#2046B3]">Achievements</div>
            <div id="progress-badges" class="flex flex-wrap gap-2 justify-center mt-2"></div>
          </div>
          </div>
      </section>
      <script>
      function updateProgressSection() {
        const progress = getCurriculumProgress();
        const completed = progress.filter(x => x === 'complete').length;
        const total = progress.length;
        const percent = Math.round((completed / total) * 100);
        document.getElementById('progress-completed').textContent = completed;
        document.getElementById('progress-remaining').textContent = total - completed;
        document.getElementById('progress-percent').textContent = percent + '%';
        document.getElementById('progress-bar').style.width = percent + '%';
        // Badges
        const badges = [];
        if (completed >= 1) badges.push({ label: 'First Step', color: '#7C3AED', icon: 'â­' });
        if (completed >= 7) badges.push({ label: 'Halfway', color: '#FDBA17', icon: 'ðŸ…' });
        if (completed === total) badges.push({ label: 'Journey Complete', color: '#2046B3', icon: 'ðŸŽ‰' });
        const badgeDiv = document.getElementById('progress-badges');
        badgeDiv.innerHTML = badges.length ? badges.map(b => `<span class='inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold' style='background:${b.color}20;color:${b.color}'>${b.icon} ${b.label}</span>`).join('') : '<span class="text-gray-400">No badges yet</span>';
      }
      // Update progress section when curriculum changes
      const origRenderCurriculumTable = renderCurriculumTable;
      renderCurriculumTable = function() {
        origRenderCurriculumTable();
        updateProgressSection();
      };
      document.addEventListener('DOMContentLoaded', updateProgressSection);
      </script>
      <!-- Resources Section -->
      <section id="section-resources" class="dashboard-section rounded-xl shadow p-6 mb-8 hidden">
        <h2 class="text-2xl font-bold text-[#7C3AED] mb-4">Study Resources</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Curriculum Materials -->
          <div class="bg-gradient-to-br from-[#F3E8FF] to-[#FEF3C7] rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#7C3AED] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
              </svg>
              Curriculum Materials
            </h3>
            <div class="space-y-3">
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-semibold text-[#2046B3]">14 Days Discipleship Classes</h4>
                    <p class="text-sm text-gray-600">Complete PowerPoint presentation</p>
        </div>
                  <a href="assets/docs/14 DAYS DISCIPLESHIP CLASSES.pptx" download class="px-4 py-2 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"/>
              </svg>
                    Download
                  </a>
            </div>
          </div>
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-semibold text-[#2046B3]">Daily Study Guide</h4>
                    <p class="text-sm text-gray-600">Printable study materials for each day</p>
        </div>
                  <button class="px-4 py-2 bg-[#FDBA17] text-[#2046B3] rounded-lg font-bold hover:bg-[#7C3AED] hover:text-white transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"/>
                </svg>
                    Download
                  </button>
            </div>
          </div>
            </div>
          </div>

          <!-- Reading Materials -->
          <div class="bg-gradient-to-br from-[#FEF3C7] to-[#F3E8FF] rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#FDBA17] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
              Reading Materials
            </h3>
            <div class="space-y-3">
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-semibold text-[#2046B3]">Recommended Reading List</h4>
                    <p class="text-sm text-gray-600">Books and articles for deeper study</p>
            </div>
                  <button class="px-4 py-2 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"/>
                  </svg>
                    Download
                  </button>
                </div>
                </div>
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-semibold text-[#2046B3]">Scripture References</h4>
                    <p class="text-sm text-gray-600">Key Bible verses for each topic</p>
                  </div>
                  <button class="px-4 py-2 bg-[#FDBA17] text-[#2046B3] rounded-lg font-bold hover:bg-[#7C3AED] hover:text-white transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"/>
                  </svg>
                    Download
                  </button>
                </div>
              </div>
          </div>
        </div>

          <!-- Audio & Video Resources -->
          <div class="bg-gradient-to-br from-[#7C3AED]/10 to-[#FDBA17]/10 rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#2046B3] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
              </svg>
              Audio & Video Resources
            </h3>
            <div class="space-y-3">
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-semibold text-[#2046B3]">Prayer & Worship Audio</h4>
                    <p class="text-sm text-gray-600">Guided prayer sessions and worship music</p>
            </div>
                  <button class="px-4 py-2 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"/>
                    </svg>
                    Download
                  </button>
            </div>
          </div>
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-semibold text-[#2046B3]">Teaching Videos</h4>
                    <p class="text-sm text-gray-600">Video lessons for each discipleship topic</p>
          </div>
                  <a href="sermons.html" class="px-4 py-2 bg-[#FDBA17] text-[#2046B3] rounded-lg font-bold hover:bg-[#7C3AED] hover:text-white transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
              </svg>
                    View
                  </a>
            </div>
            </div>
          </div>
          </div>

          <!-- Community Resources -->
          <div class="bg-gradient-to-br from-[#FDBA17]/10 to-[#7C3AED]/10 rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#FDBA17] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
          </svg>
              Community Resources
            </h3>
            <div class="space-y-3">
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <div class="flex items-center justify-between">
            <div>
                    <h4 class="font-semibold text-[#2046B3]">Group Discussion Guide</h4>
                    <p class="text-sm text-gray-600">Questions for small group discussions</p>
            </div>
                  <button class="px-4 py-2 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"/>
                    </svg>
                    Download
                  </button>
          </div>
        </div>
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <div class="flex items-center justify-between">
          <div>
                    <h4 class="font-semibold text-[#2046B3]">Ministry WhatsApp</h4>
                    <p class="text-sm text-gray-600">Join our discipleship community</p>
        </div>
                  <a href="https://chat.whatsapp.com/Cyjm2DDg5Gi08QHDW6Uw5p?mode=r_t" target="_blank" class="px-4 py-2 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
            </svg>
                    Join
                  </a>
          </div>
        </div>
            </div>
          </div>
        </div>
      </section>
      <!-- End Resources Section -->
      <!-- Mentor/Mentee Section -->
      <section id="section-mentor" class="dashboard-section rounded-xl shadow p-6 mb-8 hidden">
        <h2 class="text-2xl font-bold text-[#7C3AED] mb-4">Mentor/Mentee</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Current Mentor -->
          <div class="bg-gradient-to-br from-[#F3E8FF] to-[#FEF3C7] rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#7C3AED] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
              Your Mentor
            </h3>
            <div id="mentor-info" class="space-y-4">
              <!-- Mentor info will be populated by JS -->
              </div>
            </div>

          <!-- Mentor Actions -->
          <div class="bg-gradient-to-br from-[#FEF3C7] to-[#F3E8FF] rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#FDBA17] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
              Actions
            </h3>
            <div class="space-y-3">
              <button onclick="scheduleMeeting()" class="w-full px-4 py-3 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                Schedule Meeting
              </button>
              <button onclick="requestMentorChange()" class="w-full px-4 py-3 bg-[#FDBA17] text-[#2046B3] rounded-lg font-bold hover:bg-[#7C3AED] hover:text-white transition flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                  </svg>
                Request Change
              </button>
              <button onclick="viewMentorHistory()" class="w-full px-4 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                Meeting History
              </button>
            </div>
          </div>
            </div>
      </section>
      <script>
      // --- Mentor System ---
      const mentors = [
        { id: 1, name: 'Pastor John Smith', email: 'john.smith@ministry.com', phone: '+254 707 529 090', expertise: 'Prayer & Devotion', availability: 'Mon-Fri 9AM-5PM', image: 'assets/images/leadership/Bonnie Onduso.jpg' },
        { id: 2, name: 'Sister Mary Johnson', email: 'mary.johnson@ministry.com', phone: '+254 707 529 090', expertise: 'Community & Fellowship', availability: 'Tue-Sat 10AM-6PM', image: 'assets/images/leadership/Cyrilla Chikamai.jpg' },
        { id: 3, name: 'Brother David Wilson', email: 'david.wilson@ministry.com', phone: '+254 707 529 090', expertise: 'Spiritual Gifts', availability: 'Wed-Sun 2PM-8PM', image: 'assets/images/leadership/Humphrey Mulanda.jpg' }
      ];
      function getAssignedMentor() {
        return JSON.parse(localStorage.getItem('assigned_mentor') || 'null');
      }
      function setAssignedMentor(mentorId) {
        localStorage.setItem('assigned_mentor', JSON.stringify(mentorId));
      }
      function renderMentorInfo() {
        const mentorId = getAssignedMentor();
        const mentor = mentorId ? mentors.find(m => m.id === mentorId) : null;
        const mentorDiv = document.getElementById('mentor-info');
        if (!mentorDiv) return;
        if (!mentor) {
          mentorDiv.innerHTML = `
            <div class="text-center py-8">
              <div class="w-20 h-20 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center">
                <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
          </div>
              <h4 class="text-lg font-semibold text-gray-700 mb-2">No Mentor Assigned</h4>
              <p class="text-gray-600 mb-4">You haven't been assigned a mentor yet.</p>
              <button onclick="assignRandomMentor()" class="px-6 py-2 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition">
                Get Assigned
              </button>
            </div>
          `;
          return;
        }
        mentorDiv.innerHTML = `
          <div class="flex items-center gap-4 mb-4">
            <img src="${mentor.image}" alt="${mentor.name}" class="w-16 h-16 rounded-full object-cover border-4 border-[#FDBA17] shadow-lg" />
            <div>
              <h4 class="text-lg font-semibold text-[#2046B3]">${mentor.name}</h4>
              <p class="text-sm text-gray-600">${mentor.expertise}</p>
              </div>
            </div>
            <div class="space-y-3">
            <div class="flex items-center gap-3">
              <svg class="w-5 h-5 text-[#7C3AED]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                  </svg>
              <span class="text-sm text-gray-700">${mentor.email}</span>
            </div>
            <div class="flex items-center gap-3">
              <svg class="w-5 h-5 text-[#FDBA17]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                  </svg>
              <span class="text-sm text-gray-700">${mentor.phone}</span>
            </div>
            <div class="flex items-center gap-3">
              <svg class="w-5 h-5 text-[#2046B3]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span class="text-sm text-gray-700">${mentor.availability}</span>
          </div>
            </div>
        `;
      }
      function assignRandomMentor() {
        const randomMentor = mentors[Math.floor(Math.random() * mentors.length)];
        setAssignedMentor(randomMentor.id);
        renderMentorInfo();
      }
      function scheduleMeeting() {
        const mentorId = getAssignedMentor();
        if (!mentorId) {
          alert('Please get assigned a mentor first.');
          return;
        }
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        modal.innerHTML = `
          <div class='bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative'>
            <button class='absolute top-4 right-4 text-2xl text-[#7C3AED] hover:text-[#FDBA17] focus:outline-none' onclick='this.closest(`.fixed`).remove()' aria-label='Close'>&times;</button>
            <h3 class='text-xl font-bold text-[#7C3AED] mb-4'>Schedule Meeting</h3>
            <form class='space-y-4'>
              <div>
                <label class='block text-sm font-semibold text-gray-700 mb-2'>Date</label>
                <input type='date' class='w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#7C3AED] focus:outline-none' required />
          </div>
            <div>
                <label class='block text-sm font-semibold text-gray-700 mb-2'>Time</label>
                <input type='time' class='w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#7C3AED] focus:outline-none' required />
              </div>
              <div>
                <label class='block text-sm font-semibold text-gray-700 mb-2'>Topic</label>
                <textarea class='w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#7C3AED] focus:outline-none' rows='3' placeholder='What would you like to discuss?'></textarea>
            </div>
              <button type='submit' class='w-full px-6 py-3 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition'>
                Schedule Meeting
              </button>
            </form>
            </div>
        `;
        document.body.appendChild(modal);
      }
      function requestMentorChange() {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        modal.innerHTML = `
          <div class='bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative'>
            <button class='absolute top-4 right-4 text-2xl text-[#7C3AED] hover:text-[#FDBA17] focus:outline-none' onclick='this.closest(`.fixed`).remove()' aria-label='Close'>&times;</button>
            <h3 class='text-xl font-bold text-[#7C3AED] mb-4'>Request Mentor Change</h3>
            <form class='space-y-4'>
              <div>
                <label class='block text-sm font-semibold text-gray-700 mb-2'>Reason</label>
                <textarea class='w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#7C3AED] focus:outline-none' rows='4' placeholder='Please explain why you would like a different mentor...' required></textarea>
            </div>
              <div>
                <label class='block text-sm font-semibold text-gray-700 mb-2'>Preferred Expertise</label>
                <select class='w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#7C3AED] focus:outline-none'>
                  <option>Prayer & Devotion</option>
                  <option>Community & Fellowship</option>
                  <option>Spiritual Gifts</option>
                  <option>Any</option>
                </select>
          </div>
              <button type='submit' class='w-full px-6 py-3 bg-[#FDBA17] text-[#2046B3] rounded-lg font-bold hover:bg-[#7C3AED] hover:text-white transition'>
                Submit Request
              </button>
            </form>
            </div>
        `;
        document.body.appendChild(modal);
      }
      function viewMentorHistory() {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        modal.innerHTML = `
          <div class='bg-white rounded-2xl shadow-2xl max-w-lg w-full p-8 relative'>
            <button class='absolute top-4 right-4 text-2xl text-[#7C3AED] hover:text-[#FDBA17] focus:outline-none' onclick='this.closest(`.fixed`).remove()' aria-label='Close'>&times;</button>
            <h3 class='text-xl font-bold text-[#7C3AED] mb-4'>Meeting History</h3>
            <div class='space-y-3'>
              <div class='bg-gray-50 rounded-lg p-4'>
                <div class='flex justify-between items-start'>
            <div>
                    <h4 class='font-semibold text-[#2046B3]'>First Meeting</h4>
                    <p class='text-sm text-gray-600'>Introduction and goal setting</p>
              </div>
                  <span class='text-xs text-gray-500'>2 days ago</span>
            </div>
            </div>
              <div class='bg-gray-50 rounded-lg p-4'>
                <div class='flex justify-between items-start'>
                  <div>
                    <h4 class='font-semibold text-[#2046B3]'>Prayer Session</h4>
                    <p class='text-sm text-gray-600'>Guided prayer and spiritual guidance</p>
            </div>
                  <span class='text-xs text-gray-500'>1 week ago</span>
          </div>
        </div>
          </div>
        </div>
        `;
        document.body.appendChild(modal);
      }
      document.addEventListener('DOMContentLoaded', renderMentorInfo);
      </script>
      <!-- End Mentor/Mentee Section -->
      <!-- Learning Modules & Assessments Section -->
      <section id="section-modules" class="dashboard-section rounded-xl shadow p-6 mb-8 hidden">
        <h2 class="text-2xl font-bold text-[#7C3AED] mb-4">Learning Modules & Assessments</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Available Modules -->
          <div class="bg-gradient-to-br from-[#F3E8FF] to-[#FEF3C7] rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#7C3AED] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
              </svg>
              Available Modules
            </h3>
            <div id="modules-list" class="space-y-3">
              <!-- Modules will be populated by JS -->
          </div>
        </div>

          <!-- Assessment Center -->
          <div class="bg-gradient-to-br from-[#FEF3C7] to-[#F3E8FF] rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#FDBA17] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Assessment Center
            </h3>
            <div id="assessments-list" class="space-y-3">
              <!-- Assessments will be populated by JS -->
            </div>
          </div>
        </div>
      </section>
      <script>
      // --- Learning Modules & Assessments System ---
      const modules = [
        { id: 1, day: 1, title: 'Introduction to Discipleship', description: 'Understanding what it means to be a disciple of Christ', duration: '30 min', status: 'locked', content: 'This module introduces the foundational concepts of discipleship...' },
        { id: 2, day: 2, title: 'Prayer & Devotion', description: 'Developing a consistent prayer life and devotion to God', duration: '45 min', status: 'locked', content: 'Learn the importance of prayer and how to develop a meaningful prayer life...' },
        { id: 3, day: 3, title: 'Bible Study Methods', description: 'Effective ways to study and understand Scripture', duration: '40 min', status: 'locked', content: 'Discover various methods for studying the Bible effectively...' },
        { id: 4, day: 4, title: 'Worship & Praise', description: 'Understanding true worship and its role in discipleship', duration: '35 min', status: 'locked', content: 'Explore the meaning of worship and how to worship in spirit and truth...' },
        { id: 5, day: 5, title: 'Fellowship & Community', description: 'Building relationships within the body of Christ', duration: '50 min', status: 'locked', content: 'Learn about the importance of fellowship and community in the Christian life...' },
        { id: 6, day: 6, title: 'Spiritual Gifts', description: 'Discovering and using your spiritual gifts', duration: '45 min', status: 'locked', content: 'Identify and develop your spiritual gifts for ministry...' },
        { id: 7, day: 7, title: 'Evangelism & Witnessing', description: 'Sharing the gospel effectively', duration: '55 min', status: 'locked', content: 'Learn how to share your faith and witness to others...' },
        { id: 8, day: 8, title: 'Servant Leadership', description: 'Leading through service and humility', duration: '40 min', status: 'locked', content: 'Understand the principles of servant leadership...' },
        { id: 9, day: 9, title: 'Spiritual Warfare', description: 'Understanding and engaging in spiritual warfare', duration: '50 min', status: 'locked', content: 'Learn about spiritual warfare and how to stand firm...' },
        { id: 10, day: 10, title: 'Discipleship Multiplication', description: 'Making disciples who make disciples', duration: '45 min', status: 'locked', content: 'Learn how to disciple others and multiply your impact...' },
        { id: 11, day: 11, title: 'Stewardship', description: 'Managing God\'s gifts and resources', duration: '35 min', status: 'locked', content: 'Understand biblical stewardship of time, talents, and treasures...' },
        { id: 12, day: 12, title: 'Perseverance & Endurance', description: 'Staying faithful through trials and challenges', duration: '40 min', status: 'locked', content: 'Learn how to persevere through difficulties and trials...' },
        { id: 13, day: 13, title: 'Kingdom Living', description: 'Living as citizens of God\'s kingdom', duration: '45 min', status: 'locked', content: 'Understand what it means to live as citizens of God\'s kingdom...' },
        { id: 14, day: 14, title: 'Graduation & Commissioning', description: 'Preparing for ministry and service', duration: '60 min', status: 'locked', content: 'Final preparation for ministry and commissioning to serve...' }
      ];

      const assessments = [
        { id: 1, moduleId: 1, title: 'Discipleship Fundamentals Quiz', questions: 10, timeLimit: 15, status: 'locked' },
        { id: 2, moduleId: 2, title: 'Prayer Life Assessment', questions: 8, timeLimit: 12, status: 'locked' },
        { id: 3, moduleId: 3, title: 'Bible Study Methods Test', questions: 12, timeLimit: 18, status: 'locked' },
        { id: 4, moduleId: 4, title: 'Worship Understanding Quiz', questions: 10, timeLimit: 15, status: 'locked' },
        { id: 5, moduleId: 5, title: 'Community & Fellowship Assessment', questions: 8, timeLimit: 12, status: 'locked' },
        { id: 6, moduleId: 6, title: 'Spiritual Gifts Discovery', questions: 15, timeLimit: 20, status: 'locked' },
        { id: 7, moduleId: 7, title: 'Evangelism Skills Test', questions: 10, timeLimit: 15, status: 'locked' },
        { id: 8, moduleId: 8, title: 'Leadership Principles Quiz', questions: 12, timeLimit: 18, status: 'locked' },
        { id: 9, moduleId: 9, title: 'Spiritual Warfare Assessment', questions: 10, timeLimit: 15, status: 'locked' },
        { id: 10, moduleId: 10, title: 'Multiplication Methods Test', questions: 8, timeLimit: 12, status: 'locked' },
        { id: 11, moduleId: 11, title: 'Stewardship Principles Quiz', questions: 10, timeLimit: 15, status: 'locked' },
        { id: 12, moduleId: 12, title: 'Endurance & Perseverance Test', questions: 8, timeLimit: 12, status: 'locked' },
        { id: 13, moduleId: 13, title: 'Kingdom Living Assessment', questions: 10, timeLimit: 15, status: 'locked' },
        { id: 14, moduleId: 14, title: 'Final Comprehensive Exam', questions: 20, timeLimit: 30, status: 'locked' }
      ];

      function getModuleProgress() {
        return JSON.parse(localStorage.getItem('module_progress') || '{}');
      }
      function setModuleProgress(moduleId, status) {
        const progress = getModuleProgress();
        progress[moduleId] = status;
        localStorage.setItem('module_progress', JSON.stringify(progress));
      }
      function getAssessmentResults() {
        return JSON.parse(localStorage.getItem('assessment_results') || '{}');
      }
      function setAssessmentResult(assessmentId, score) {
        const results = getAssessmentResults();
        results[assessmentId] = score;
        localStorage.setItem('assessment_results', JSON.stringify(results));
      }

      function renderModules() {
        const progress = getModuleProgress();
        const curriculumProgress = getCurriculumProgress();
        const modulesDiv = document.getElementById('modules-list');
        if (!modulesDiv) return;
        
        modulesDiv.innerHTML = modules.map(module => {
          const isUnlocked = curriculumProgress[module.day - 1] === 'complete';
          const isCompleted = progress[module.id] === 'complete';
          const isInProgress = progress[module.id] === 'in-progress';
          
          let statusClass = 'bg-gray-200 text-gray-600';
          let statusText = 'Locked';
          let actionBtn = '';
          
          if (isCompleted) {
            statusClass = 'bg-green-200 text-green-700';
            statusText = 'Completed';
            actionBtn = `<button onclick="reviewModule(${module.id})" class="px-3 py-1 bg-[#7C3AED] text-white rounded text-sm font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition">Review</button>`;
          } else if (isInProgress) {
            statusClass = 'bg-[#FDBA17]/20 text-[#FDBA17]';
            statusText = 'In Progress';
            actionBtn = `<button onclick="continueModule(${module.id})" class="px-3 py-1 bg-[#7C3AED] text-white rounded text-sm font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition">Continue</button>`;
          } else if (isUnlocked) {
            statusClass = 'bg-[#7C3AED]/20 text-[#7C3AED]';
            statusText = 'Available';
            actionBtn = `<button onclick="startModule(${module.id})" class="px-3 py-1 bg-[#7C3AED] text-white rounded text-sm font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition">Start</button>`;
          } else {
            actionBtn = `<span class="px-3 py-1 bg-gray-300 text-gray-500 rounded text-sm font-bold cursor-not-allowed">Locked</span>`;
          }
          
          return `
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <h4 class="font-semibold text-[#2046B3]">Day ${module.day}: ${module.title}</h4>
                  <p class="text-sm text-gray-600 mb-2">${module.description}</p>
                  <div class="flex items-center gap-4 text-xs text-gray-500">
                    <span>â±ï¸ ${module.duration}</span>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-bold ${statusClass}">${statusText}</span>
            </div>
                </div>
                <div class="ml-4">
                  ${actionBtn}
                </div>
              </div>
            </div>
          `;
        }).join('');
      }

      function renderAssessments() {
        const results = getAssessmentResults();
        const progress = getModuleProgress();
        const assessmentsDiv = document.getElementById('assessments-list');
        if (!assessmentsDiv) return;
        
        assessmentsDiv.innerHTML = assessments.map(assessment => {
          const moduleCompleted = progress[assessment.moduleId] === 'complete';
          const isCompleted = results[assessment.id] !== undefined;
          const score = results[assessment.id];
          
          let statusClass = 'bg-gray-200 text-gray-600';
          let statusText = 'Locked';
          let actionBtn = '';
          
          if (isCompleted) {
            statusClass = 'bg-green-200 text-green-700';
            statusText = `Completed (${score}%)`;
            actionBtn = `<button onclick="reviewAssessment(${assessment.id})" class="px-3 py-1 bg-[#7C3AED] text-white rounded text-sm font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition">Review</button>`;
          } else if (moduleCompleted) {
            statusClass = 'bg-[#FDBA17]/20 text-[#FDBA17]';
            statusText = 'Available';
            actionBtn = `<button onclick="startAssessment(${assessment.id})" class="px-3 py-1 bg-[#FDBA17] text-[#2046B3] rounded text-sm font-bold hover:bg-[#7C3AED] hover:text-white transition">Start</button>`;
          } else {
            actionBtn = `<span class="px-3 py-1 bg-gray-300 text-gray-500 rounded text-sm font-bold cursor-not-allowed">Locked</span>`;
          }
          
          return `
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <h4 class="font-semibold text-[#2046B3]">${assessment.title}</h4>
                  <div class="flex items-center gap-4 text-xs text-gray-500 mt-2">
                    <span>ðŸ“ ${assessment.questions} questions</span>
                    <span>â±ï¸ ${assessment.timeLimit} min</span>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-bold ${statusClass}">${statusText}</span>
          </div>
            </div>
                <div class="ml-4">
                  ${actionBtn}
          </div>
            </div>
          </div>
          `;
        }).join('');
      }

      function startModule(moduleId) {
        const module = modules.find(m => m.id === moduleId);
        if (!module) return;
        
        setModuleProgress(moduleId, 'in-progress');
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        modal.innerHTML = `
          <div class='bg-white rounded-2xl shadow-2xl max-w-4xl w-full p-8 relative max-h-[90vh] overflow-y-auto'>
            <button class='absolute top-4 right-4 text-2xl text-[#7C3AED] hover:text-[#FDBA17] focus:outline-none' onclick='this.closest(`.fixed`).remove()' aria-label='Close'>&times;</button>
            <h3 class='text-2xl font-bold text-[#7C3AED] mb-4'>${module.title}</h3>
            <div class='prose max-w-none'>
              <p class='text-gray-700 mb-6'>${module.content}</p>
              <div class='bg-[#F3E8FF] rounded-lg p-4 mb-6'>
                <h4 class='font-semibold text-[#7C3AED] mb-2'>Key Points:</h4>
                <ul class='list-disc list-inside space-y-1 text-gray-700'>
                  <li>Understanding the fundamentals of discipleship</li>
                  <li>Developing a personal relationship with Christ</li>
                  <li>Commitment to spiritual growth and transformation</li>
                </ul>
            </div>
              <div class='bg-[#FEF3C7] rounded-lg p-4 mb-6'>
                <h4 class='font-semibold text-[#FDBA17] mb-2'>Reflection Questions:</h4>
                <ol class='list-decimal list-inside space-y-2 text-gray-700'>
                  <li>What does discipleship mean to you personally?</li>
                  <li>How can you apply these principles in your daily life?</li>
                  <li>What areas of your spiritual life need growth?</li>
                </ol>
            </div>
            </div>
            <div class='flex gap-4 mt-8'>
              <button onclick='completeModule(${moduleId})' class='px-6 py-3 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition'>
                Mark as Complete
              </button>
              <button onclick='this.closest(`.fixed`).remove()' class='px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition'>
                Save Progress
              </button>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
      }

      function completeModule(moduleId) {
        setModuleProgress(moduleId, 'complete');
        document.querySelector('.fixed').remove();
        renderModules();
        renderAssessments();
        updateProgressSection();
      }

      function startAssessment(assessmentId) {
        const assessment = assessments.find(a => a.id === assessmentId);
        if (!assessment) return;
        
        // Demo questions for the assessment
        const demoQuestions = [
          { question: 'What is the primary goal of discipleship?', options: ['To gain knowledge', 'To become like Christ', 'To attend church regularly', 'To read the Bible'], correct: 1 },
          { question: 'Which of the following is NOT a characteristic of a disciple?', options: ['Faithfulness', 'Obedience', 'Selfishness', 'Humility'], correct: 2 },
          { question: 'How often should a disciple pray?', options: ['Only on Sundays', 'Only when in trouble', 'Daily and continuously', 'Only before meals'], correct: 2 },
          { question: 'What is the role of the Holy Spirit in discipleship?', options: ['To make us perfect', 'To guide and teach us', 'To replace our efforts', 'To judge our mistakes'], correct: 1 },
          { question: 'Which Bible verse emphasizes the cost of discipleship?', options: ['John 3:16', 'Luke 9:23', 'Matthew 28:19', 'Acts 2:38'], correct: 1 }
        ];
        
        let currentQuestion = 0;
        let score = 0;
        
        function showQuestion() {
          const question = demoQuestions[currentQuestion];
          const modal = document.createElement('div');
          modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
          modal.innerHTML = `
            <div class='bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-8 relative'>
              <div class='mb-6'>
                <div class='flex justify-between items-center mb-4'>
                  <h3 class='text-xl font-bold text-[#7C3AED]'>${assessment.title}</h3>
                  <span class='text-sm text-gray-500'>Question ${currentQuestion + 1} of ${demoQuestions.length}</span>
            </div>
                <div class='w-full bg-gray-200 rounded-full h-2'>
                  <div class='bg-[#7C3AED] h-2 rounded-full transition-all duration-300' style='width: ${((currentQuestion + 1) / demoQuestions.length) * 100}%'></div>
            </div>
            </div>
              <div class='mb-6'>
                <h4 class='text-lg font-semibold text-[#2046B3] mb-4'>${question.question}</h4>
                <div class='space-y-3'>
                  ${question.options.map((option, index) => `
                    <label class='flex items-center p-3 border rounded-lg hover:bg-[#F3E8FF] cursor-pointer transition'>
                      <input type='radio' name='answer' value='${index}' class='mr-3'>
                      <span class='text-gray-700'>${option}</span>
                    </label>
                  `).join('')}
            </div>
          </div>
              <div class='flex justify-between'>
                <button onclick='this.closest(`.fixed`).remove()' class='px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition'>
                  Exit
                </button>
                <button onclick='submitAnswer()' class='px-6 py-2 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition'>
                  ${currentQuestion === demoQuestions.length - 1 ? 'Finish' : 'Next'}
                </button>
        </div>
            </div>
          `;
          document.body.appendChild(modal);
        }
        
        window.submitAnswer = function() {
          const selected = document.querySelector('input[name="answer"]:checked');
          if (!selected) {
            alert('Please select an answer.');
            return;
          }
          
          const answer = parseInt(selected.value);
          const question = demoQuestions[currentQuestion];
          if (answer === question.correct) score++;
          
          currentQuestion++;
          
          if (currentQuestion < demoQuestions.length) {
            document.querySelector('.fixed').remove();
            showQuestion();
          } else {
            // Show results
            const finalScore = Math.round((score / demoQuestions.length) * 100);
            setAssessmentResult(assessmentId, finalScore);
            
            document.querySelector('.fixed').remove();
            const resultsModal = document.createElement('div');
            resultsModal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
            resultsModal.innerHTML = `
              <div class='bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative text-center'>
                <h3 class='text-2xl font-bold text-[#7C3AED] mb-4'>Assessment Complete!</h3>
                <div class='text-6xl font-bold text-[#FDBA17] mb-4'>${finalScore}%</div>
                <p class='text-gray-700 mb-6'>You scored ${score} out of ${demoQuestions.length} questions correctly.</p>
                <div class='mb-6'>
                  ${finalScore >= 80 ? '<span class="text-green-600 font-bold">ðŸŽ‰ Excellent! You passed!</span>' : 
                    finalScore >= 60 ? '<span class="text-yellow-600 font-bold">ðŸ‘ Good effort! Keep studying.</span>' : 
                    '<span class="text-red-600 font-bold">ðŸ“š Review the material and try again.</span>'}
            </div>
                <button onclick='this.closest(`.fixed`).remove(); renderAssessments();' class='px-6 py-3 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition'>
                  Continue
                </button>
            </div>
            `;
            document.body.appendChild(resultsModal);
          }
        };
        
        showQuestion();
      }

      function continueModule(moduleId) {
        startModule(moduleId);
      }

      function reviewModule(moduleId) {
        startModule(moduleId);
      }

      function reviewAssessment(assessmentId) {
        const assessment = assessments.find(a => a.id === assessmentId);
        const results = getAssessmentResults();
        const score = results[assessmentId];
        
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        modal.innerHTML = `
          <div class='bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative text-center'>
            <h3 class='text-xl font-bold text-[#7C3AED] mb-4'>${assessment.title}</h3>
            <div class='text-4xl font-bold text-[#FDBA17] mb-4'>${score}%</div>
            <p class='text-gray-700 mb-6'>Your previous score</p>
            <button onclick='this.closest(`.fixed`).remove()' class='px-6 py-3 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition'>
              Close
            </button>
          </div>
        `;
        document.body.appendChild(modal);
      }

      document.addEventListener('DOMContentLoaded', () => {
        renderModules();
        renderAssessments();
      });
      </script>
      <!-- End Learning Modules & Assessments Section -->
      <!-- Graduation & Certification Section -->
      <section id="section-graduation" class="dashboard-section rounded-xl shadow p-6 mb-8 hidden">
        <h2 class="text-2xl font-bold text-[#7C3AED] mb-4">Graduation & Certification</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Graduation Requirements -->
          <div class="bg-gradient-to-br from-[#F3E8FF] to-[#FEF3C7] rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#7C3AED] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Graduation Requirements
            </h3>
            <div id="graduation-requirements" class="space-y-3">
              <!-- Requirements will be populated by JS -->
            </div>
            </div>

          <!-- Certificate & Status -->
          <div class="bg-gradient-to-br from-[#FEF3C7] to-[#F3E8FF] rounded-xl p-6">
            <h3 class="text-lg font-bold text-[#FDBA17] mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              Your Certificate
            </h3>
            <div id="certificate-status" class="space-y-4">
              <!-- Certificate status will be populated by JS -->
            </div>
          </div>
        </div>
      </section>
      <script>
      // --- Graduation & Certification System ---
      const graduationRequirements = [
        { id: 'curriculum', name: 'Complete 14-Day Curriculum', description: 'All curriculum days must be marked complete', weight: 30 },
        { id: 'modules', name: 'Complete Learning Modules', description: 'All 14 learning modules must be finished', weight: 25 },
        { id: 'assessments', name: 'Pass All Assessments', description: 'Score 70% or higher on all assessments', weight: 25 },
        { id: 'mentor', name: 'Mentor Meetings', description: 'Attend at least 3 mentor meetings', weight: 10 },
        { id: 'community', name: 'Community Participation', description: 'Participate in group discussions and activities', weight: 10 }
      ];

      function getGraduationProgress() {
        return JSON.parse(localStorage.getItem('graduation_progress') || '{}');
      }
      function setGraduationProgress(requirementId, status) {
        const progress = getGraduationProgress();
        progress[requirementId] = status;
        localStorage.setItem('graduation_progress', JSON.stringify(progress));
      }
      function getGraduationStatus() {
        return JSON.parse(localStorage.getItem('graduation_status') || 'null');
      }
      function setGraduationStatus(status) {
        localStorage.setItem('graduation_status', JSON.stringify(status));
      }

      function renderGraduationRequirements() {
        const progress = getGraduationProgress();
        const curriculumProgress = getCurriculumProgress();
        const moduleProgress = getModuleProgress();
        const assessmentResults = getAssessmentResults();
        const mentorMeetings = JSON.parse(localStorage.getItem('mentor_meetings') || '[]');
        
        const requirementsDiv = document.getElementById('graduation-requirements');
        if (!requirementsDiv) return;
        
        let totalCompleted = 0;
        let totalWeight = 0;
        
        requirementsDiv.innerHTML = graduationRequirements.map(req => {
          let isCompleted = false;
          let statusText = 'Incomplete';
          let statusClass = 'bg-red-200 text-red-700';
          
          switch(req.id) {
            case 'curriculum':
              isCompleted = curriculumProgress.filter(x => x === 'complete').length === 14;
              break;
            case 'modules':
              isCompleted = Object.values(moduleProgress).filter(x => x === 'complete').length === 14;
              break;
            case 'assessments':
              const passedAssessments = Object.values(assessmentResults).filter(score => score >= 70).length;
              isCompleted = passedAssessments === 14;
              break;
            case 'mentor':
              isCompleted = mentorMeetings.length >= 3;
              break;
            case 'community':
              // Demo: assume community participation is tracked
              isCompleted = Math.random() > 0.3; // 70% chance of completion for demo
              break;
          }
          
          if (isCompleted) {
            statusText = 'Complete';
            statusClass = 'bg-green-200 text-green-700';
            totalCompleted++;
          }
          totalWeight += req.weight;
          
          return `
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <h4 class="font-semibold text-[#2046B3]">${req.name}</h4>
                  <p class="text-sm text-gray-600 mb-2">${req.description}</p>
                  <div class="flex items-center gap-4">
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-bold ${statusClass}">${statusText}</span>
                    <span class="text-xs text-gray-500">Weight: ${req.weight}%</span>
            </div>
          </div>
                <div class="ml-4">
                  ${isCompleted ? 
                    '<svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>' : 
                    '<svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>'
                  }
        </div>
              </div>
            </div>
          `;
        }).join('');
        
        // Update overall progress
        const overallProgress = Math.round((totalCompleted / graduationRequirements.length) * 100);
        const certificateDiv = document.getElementById('certificate-status');
        if (certificateDiv) {
          if (overallProgress === 100) {
            certificateDiv.innerHTML = `
              <div class="text-center py-8">
                <div class="w-20 h-20 bg-[#FDBA17] rounded-full mx-auto mb-4 flex items-center justify-center">
                  <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
          </div>
                <h4 class="text-lg font-semibold text-[#2046B3] mb-2">ðŸŽ‰ Congratulations!</h4>
                <p class="text-gray-600 mb-4">You have completed all graduation requirements!</p>
                <button onclick="generateCertificate()" class="px-6 py-3 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition">
                  Generate Certificate
                </button>
        </div>
            `;
            setGraduationStatus('eligible');
          } else {
            certificateDiv.innerHTML = `
              <div class="text-center py-8">
                <div class="w-20 h-20 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center">
                  <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
                <h4 class="text-lg font-semibold text-gray-700 mb-2">Progress: ${overallProgress}%</h4>
                <p class="text-gray-600 mb-4">Complete all requirements to graduate</p>
                <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                  <div class="bg-[#7C3AED] h-2 rounded-full transition-all duration-500" style="width: ${overallProgress}%"></div>
                  </div>
                <p class="text-sm text-gray-500">${totalCompleted} of ${graduationRequirements.length} requirements complete</p>
                </div>
            `;
          }
        }
      }

      function generateCertificate() {
        const graduationStatus = getGraduationStatus();
        if (graduationStatus !== 'eligible') {
          alert('You must complete all requirements to generate a certificate.');
          return;
        }
        
        const certificateModal = document.createElement('div');
        certificateModal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        certificateModal.innerHTML = `
          <div class='bg-white rounded-2xl shadow-2xl max-w-4xl w-full p-8 relative'>
            <button class='absolute top-4 right-4 text-2xl text-[#7C3AED] hover:text-[#FDBA17] focus:outline-none' onclick='this.closest(`.fixed`).remove()' aria-label='Close'>&times;</button>
            <div class='text-center'>
              <h3 class='text-2xl font-bold text-[#7C3AED] mb-6'>Certificate of Completion</h3>
              <div class='bg-gradient-to-br from-[#F3E8FF] to-[#FEF3C7] rounded-xl p-8 border-4 border-[#7C3AED]'>
                <div class='mb-6'>
                  <img src="assets/images/WhatsApp Image 2025-07-04 at 17.27.34_37ced412.jpg" alt="Ministry Logo" class="w-20 h-20 rounded-full mx-auto mb-4 border-4 border-[#FDBA17]" />
                  <h4 class='text-3xl font-bold text-[#2046B3] mb-2'>Hearts After God Ministry</h4>
                  <p class='text-lg text-gray-600'>Discipleship Training Program</p>
                  </div>
                <div class='mb-6'>
                  <p class='text-lg text-gray-700 mb-4'>This is to certify that</p>
                  <h5 class='text-2xl font-bold text-[#7C3AED] mb-2'>[Your Name]</h5>
                  <p class='text-lg text-gray-700'>has successfully completed the</p>
                  <h6 class='text-xl font-bold text-[#FDBA17] mb-4'>14-Day Discipleship Training Program</h6>
                </div>
                <div class='mb-6'>
                  <p class='text-gray-700 mb-2'>Including:</p>
                  <ul class='text-sm text-gray-600 space-y-1'>
                    <li>â€¢ Complete curriculum study and application</li>
                    <li>â€¢ All learning modules and assessments</li>
                    <li>â€¢ Mentorship and community participation</li>
                    <li>â€¢ Spiritual growth and transformation</li>
            </ul>
          </div>
                <div class='flex justify-between items-center'>
                  <div class='text-left'>
                    <p class='text-sm text-gray-500'>Date of Completion</p>
                    <p class='font-semibold text-[#2046B3]'>${new Date().toLocaleDateString()}</p>
              </div>
                  <div class='text-right'>
                    <p class='text-sm text-gray-500'>Certificate ID</p>
                    <p class='font-semibold text-[#7C3AED]'>HAG-${Date.now().toString().slice(-6)}</p>
              </div>
          </div>
        </div>
              <div class='flex gap-4 mt-8 justify-center'>
                <button onclick='downloadCertificate()' class='px-6 py-3 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition'>
                  Download Certificate
                </button>
                <button onclick='shareCertificate()' class='px-6 py-3 bg-[#FDBA17] text-[#2046B3] rounded-lg font-bold hover:bg-[#7C3AED] hover:text-white transition'>
                  Share Certificate
                </button>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(certificateModal);
        setGraduationStatus('graduated');
      }

      function downloadCertificate() {
        // In a real implementation, this would generate a PDF
        alert('Certificate download feature would generate a PDF in production.');
      }

      function shareCertificate() {
        // In a real implementation, this would share to social media
        alert('Certificate sharing feature would integrate with social media platforms.');
      }

      // Update graduation requirements when other sections change
      const origUpdateProgressSection = updateProgressSection;
      updateProgressSection = function() {
        if (origUpdateProgressSection) origUpdateProgressSection();
        renderGraduationRequirements();
      };

      document.addEventListener('DOMContentLoaded', renderGraduationRequirements);
      </script>
      <!-- End Graduation & Certification Section -->
      <!-- Advanced Discipleship Pathways Section -->
      <section id="section-pathways" class="dashboard-section rounded-xl shadow p-6 mb-8 hidden">
        <h2 class="text-2xl font-bold text-[#7C3AED] mb-4">Advanced Discipleship Pathways</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Leadership Pathway -->
          <div class="bg-gradient-to-br from-[#F3E8FF] to-[#FEF3C7] rounded-xl p-6">
            <div class="text-center mb-4">
              <div class="w-16 h-16 bg-[#7C3AED] rounded-full mx-auto mb-3 flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
              </svg>
              </div>
              <h3 class="text-lg font-bold text-[#7C3AED]">Leadership Development</h3>
              <p class="text-sm text-gray-600 mb-4">Develop leadership skills for ministry and community service</p>
            </div>
            <div class="space-y-3 mb-4">
              <div class="flex items-center justify-between text-sm">
                <span>Servant Leadership</span>
                <span class="text-[#7C3AED] font-bold">3 modules</span>
          </div>
              <div class="flex items-center justify-between text-sm">
                <span>Team Building</span>
                <span class="text-[#7C3AED] font-bold">4 modules</span>
            </div>
              <div class="flex items-center justify-between text-sm">
                <span>Vision Casting</span>
                <span class="text-[#7C3AED] font-bold">2 modules</span>
                </div>
              </div>
            <button onclick="enrollPathway('leadership')" class="w-full px-4 py-2 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition">
              Enroll Now
            </button>
            </div>

          <!-- Evangelism Pathway -->
          <div class="bg-gradient-to-br from-[#FEF3C7] to-[#F3E8FF] rounded-xl p-6">
            <div class="text-center mb-4">
              <div class="w-16 h-16 bg-[#FDBA17] rounded-full mx-auto mb-3 flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
              </svg>
              </div>
              <h3 class="text-lg font-bold text-[#FDBA17]">Evangelism & Outreach</h3>
              <p class="text-sm text-gray-600 mb-4">Learn effective methods for sharing the gospel</p>
            </div>
            <div class="space-y-3 mb-4">
              <div class="flex items-center justify-between text-sm">
                <span>Personal Evangelism</span>
                <span class="text-[#FDBA17] font-bold">5 modules</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>Street Ministry</span>
                <span class="text-[#FDBA17] font-bold">3 modules</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>Digital Evangelism</span>
                <span class="text-[#FDBA17] font-bold">4 modules</span>
              </div>
            </div>
            <button onclick="enrollPathway('evangelism')" class="w-full px-4 py-2 bg-[#FDBA17] text-[#2046B3] rounded-lg font-bold hover:bg-[#7C3AED] hover:text-white transition">
              Enroll Now
            </button>
        </div>

          <!-- Prayer & Intercession Pathway -->
          <div class="bg-gradient-to-br from-[#7C3AED]/10 to-[#FDBA17]/10 rounded-xl p-6">
            <div class="text-center mb-4">
              <div class="w-16 h-16 bg-[#2046B3] rounded-full mx-auto mb-3 flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"/>
              </svg>
            </div>
              <h3 class="text-lg font-bold text-[#2046B3]">Prayer & Intercession</h3>
              <p class="text-sm text-gray-600 mb-4">Deepen your prayer life and intercessory ministry</p>
            </div>
            <div class="space-y-3 mb-4">
              <div class="flex items-center justify-between text-sm">
                <span>Prayer Fundamentals</span>
                <span class="text-[#2046B3] font-bold">6 modules</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>Intercessory Prayer</span>
                <span class="text-[#2046B3] font-bold">4 modules</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>Spiritual Warfare</span>
                <span class="text-[#2046B3] font-bold">3 modules</span>
              </div>
            </div>
            <button onclick="enrollPathway('prayer')" class="w-full px-4 py-2 bg-[#2046B3] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition">
              Enroll Now
            </button>
        </div>
        
          <!-- Bible Teaching Pathway -->
          <div class="bg-gradient-to-br from-[#F3E8FF] to-[#7C3AED]/10 rounded-xl p-6">
            <div class="text-center mb-4">
              <div class="w-16 h-16 bg-green-500 rounded-full mx-auto mb-3 flex items-center justify-center">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
              </svg>
          </div>
              <h3 class="text-lg font-bold text-green-600">Bible Teaching</h3>
              <p class="text-sm text-gray-600 mb-4">Develop skills for effective Bible teaching and preaching</p>
          </div>
            <div class="space-y-3 mb-4">
              <div class="flex items-center justify-between text-sm">
                <span>Hermeneutics</span>
                <span class="text-green-600 font-bold">4 modules</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>Preaching Skills</span>
                <span class="text-green-600 font-bold">5 modules</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>Small Group Teaching</span>
                <span class="text-green-600 font-bold">3 modules</span>
              </div>
            </div>
            <button onclick="enrollPathway('teaching')" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 transition">
              Enroll Now
            </button>
        </div>

          <!-- Worship & Music Pathway -->
          <div class="bg-gradient-to-br from-[#FDBA17]/10 to-[#F3E8FF] rounded-xl p-6">
            <div class="text-center mb-4">
              <div class="w-16 h-16 bg-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
              </svg>
          </div>
              <h3 class="text-lg font-bold text-purple-600">Worship & Music</h3>
              <p class="text-sm text-gray-600 mb-4">Develop worship leading and music ministry skills</p>
          </div>
            <div class="space-y-3 mb-4">
              <div class="flex items-center justify-between text-sm">
                <span>Worship Leading</span>
                <span class="text-purple-600 font-bold">6 modules</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>Music Theory</span>
                <span class="text-purple-600 font-bold">4 modules</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>Sound & Technology</span>
                <span class="text-purple-600 font-bold">3 modules</span>
              </div>
            </div>
            <button onclick="enrollPathway('worship')" class="w-full px-4 py-2 bg-purple-500 text-white rounded-lg font-bold hover:bg-purple-600 transition">
              Enroll Now
            </button>
        </div>

          <!-- Missions Pathway -->
          <div class="bg-gradient-to-br from-[#7C3AED]/10 to-[#FDBA17]/10 rounded-xl p-6">
            <div class="text-center mb-4">
              <div class="w-16 h-16 bg-orange-500 rounded-full mx-auto mb-3 flex items-center justify-center">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              </div>
              <h3 class="text-lg font-bold text-orange-600">Missions & Cross-Cultural</h3>
              <p class="text-sm text-gray-600 mb-4">Prepare for local and international missions work</p>
              </div>
            <div class="space-y-3 mb-4">
              <div class="flex items-center justify-between text-sm">
                <span>Cross-Cultural Ministry</span>
                <span class="text-orange-600 font-bold">5 modules</span>
            </div>
              <div class="flex items-center justify-between text-sm">
                <span>Mission Strategy</span>
                <span class="text-orange-600 font-bold">4 modules</span>
        </div>
              <div class="flex items-center justify-between text-sm">
                <span>Language Learning</span>
                <span class="text-orange-600 font-bold">3 modules</span>
              </div>
            </div>
            <button onclick="enrollPathway('missions')" class="w-full px-4 py-2 bg-orange-500 text-white rounded-lg font-bold hover:bg-orange-600 transition">
              Enroll Now
            </button>
          </div>
        </div>
      </section>
      <script>
      // --- Advanced Pathways System ---
      const pathways = {
        leadership: { name: 'Leadership Development', color: '#7C3AED', modules: 9, duration: '3 months' },
        evangelism: { name: 'Evangelism & Outreach', color: '#FDBA17', modules: 12, duration: '4 months' },
        prayer: { name: 'Prayer & Intercession', color: '#2046B3', modules: 13, duration: '3 months' },
        teaching: { name: 'Bible Teaching', color: '#10B981', modules: 12, duration: '4 months' },
        worship: { name: 'Worship & Music', color: '#8B5CF6', modules: 13, duration: '3 months' },
        missions: { name: 'Missions & Cross-Cultural', color: '#F59E0B', modules: 12, duration: '4 months' }
      };

      function getEnrolledPathways() {
        return JSON.parse(localStorage.getItem('enrolled_pathways') || '[]');
      }
      function setEnrolledPathways(pathways) {
        localStorage.setItem('enrolled_pathways', JSON.stringify(pathways));
      }
      function getPathwayProgress(pathwayId) {
        return JSON.parse(localStorage.getItem(`pathway_progress_${pathwayId}`) || '{}');
      }
      function setPathwayProgress(pathwayId, progress) {
        localStorage.setItem(`pathway_progress_${pathwayId}`, JSON.stringify(progress));
      }

      function enrollPathway(pathwayId) {
        const enrolled = getEnrolledPathways();
        if (enrolled.includes(pathwayId)) {
          alert('You are already enrolled in this pathway!');
          return;
        }
        
        const pathway = pathways[pathwayId];
        if (!pathway) return;
        
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        modal.innerHTML = `
          <div class='bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative'>
            <button class='absolute top-4 right-4 text-2xl text-[#7C3AED] hover:text-[#FDBA17] focus:outline-none' onclick='this.closest(`.fixed`).remove()' aria-label='Close'>&times;</button>
            <div class='text-center'>
              <div class='w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center' style='background-color: ${pathway.color}'>
                <svg class='w-8 h-8 text-white' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                  <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'/>
              </svg>
            </div>
              <h3 class='text-xl font-bold text-[#7C3AED] mb-2'>Enroll in ${pathway.name}</h3>
              <p class='text-gray-600 mb-6'>This pathway includes ${pathway.modules} modules and takes approximately ${pathway.duration} to complete.</p>
              <div class='space-y-3 text-left mb-6'>
                <div class='flex items-center gap-2'>
                  <svg class='w-5 h-5 text-green-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                    <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7'/>
                  </svg>
                  <span class='text-sm text-gray-700'>Access to all pathway modules</span>
            </div>
                <div class='flex items-center gap-2'>
                  <svg class='w-5 h-5 text-green-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                    <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7'/>
                  </svg>
                  <span class='text-sm text-gray-700'>Specialized assessments and certificates</span>
            </div>
                <div class='flex items-center gap-2'>
                  <svg class='w-5 h-5 text-green-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                    <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7'/>
                </svg>
                  <span class='text-sm text-gray-700'>Mentor guidance in your specialization</span>
            </div>
          </div>
              <div class='flex gap-4'>
                <button onclick='confirmEnrollment("${pathwayId}")' class='flex-1 px-6 py-3 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition'>
                  Confirm Enrollment
                </button>
                <button onclick='this.closest(`.fixed`).remove()' class='flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition'>
                  Cancel
                </button>
        </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
      }

      function confirmEnrollment(pathwayId) {
        const enrolled = getEnrolledPathways();
        enrolled.push(pathwayId);
        setEnrolledPathways(enrolled);
        
        // Initialize pathway progress
        setPathwayProgress(pathwayId, {});
        
        document.querySelector('.fixed').remove();
        
        // Show success message
        const successModal = document.createElement('div');
        successModal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        successModal.innerHTML = `
          <div class='bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative text-center'>
            <div class='w-16 h-16 bg-green-500 rounded-full mx-auto mb-4 flex items-center justify-center'>
              <svg class='w-8 h-8 text-white' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7'/>
                </svg>
            </div>
            <h3 class='text-xl font-bold text-[#7C3AED] mb-2'>Enrollment Successful!</h3>
            <p class='text-gray-600 mb-6'>You are now enrolled in the ${pathways[pathwayId].name} pathway.</p>
            <button onclick='this.closest(`.fixed`).remove()' class='px-6 py-3 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition'>
              Start Learning
            </button>
              </div>
        `;
        document.body.appendChild(successModal);
      }

      // Update pathway buttons to show enrollment status
      function updatePathwayButtons() {
        const enrolled = getEnrolledPathways();
        const buttons = document.querySelectorAll('[onclick^="enrollPathway"]');
        
        buttons.forEach(button => {
          const pathwayId = button.getAttribute('onclick').match(/'([^']+)'/)[1];
          if (enrolled.includes(pathwayId)) {
            button.textContent = 'Enrolled';
            button.className = button.className.replace('bg-[#7C3AED]', 'bg-green-500').replace('bg-[#FDBA17]', 'bg-green-500').replace('bg-[#2046B3]', 'bg-green-500').replace('bg-green-500', 'bg-green-500').replace('bg-purple-500', 'bg-green-500').replace('bg-orange-500', 'bg-green-500');
            button.onclick = () => viewPathwayProgress(pathwayId);
          }
        });
      }

      function viewPathwayProgress(pathwayId) {
        const pathway = pathways[pathwayId];
        const progress = getPathwayProgress(pathwayId);
        
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        modal.innerHTML = `
          <div class='bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-8 relative'>
            <button class='absolute top-4 right-4 text-2xl text-[#7C3AED] hover:text-[#FDBA17] focus:outline-none' onclick='this.closest(`.fixed`).remove()' aria-label='Close'>&times;</button>
            <div class='text-center mb-6'>
              <h3 class='text-2xl font-bold text-[#7C3AED] mb-2'>${pathway.name}</h3>
              <p class='text-gray-600'>Your progress in this pathway</p>
            </div>
            <div class='space-y-4'>
              <div class='bg-gray-50 rounded-lg p-4'>
                <div class='flex justify-between items-center mb-2'>
                  <span class='font-semibold text-[#2046B3]'>Overall Progress</span>
                  <span class='text-[#7C3AED] font-bold'>0%</span>
          </div>
                <div class='w-full bg-gray-200 rounded-full h-2'>
                  <div class='bg-[#7C3AED] h-2 rounded-full transition-all duration-500' style='width: 0%'></div>
        </div>
          </div>
              <div class='text-center text-gray-500'>
                <p>Pathway modules will be available soon!</p>
                <p class='text-sm mt-2'>This advanced pathway is currently in development.</p>
          </div>
        </div>
      </div>
        `;
        document.body.appendChild(modal);
      }

      document.addEventListener('DOMContentLoaded', updatePathwayButtons);
      </script>
      <!-- End Advanced Discipleship Pathways Section -->
    </main>
  </div>
  <script>
  // Sidebar navigation logic
  const links = document.querySelectorAll('.sidebar-link');
  const sections = [
    'overview', 'curriculum', 'progress', 'resources', 'mentor', 'modules', 'graduation', 'pathways'
  ];
  links.forEach(link => {
    link.addEventListener('click', () => {
      links.forEach(l => l.classList.remove('active', 'bg-white', 'text-[#7C3AED]'));
      link.classList.add('active', 'bg-white', 'text-[#7C3AED]');
      sections.forEach(sec => {
        document.getElementById('section-' + sec).classList.add('hidden');
      });
      document.getElementById('section-' + link.dataset.section).classList.remove('hidden');
    });
  });
  // Set default section
  if (links[0]) links[0].click();
  </script>
  <!-- End Sidebar Navigation and Main Content -->

  <!-- Modern Footer -->
  <footer class="bg-gradient-to-r from-[#2046B3] to-[#7C3AED] text-white mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12">
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
        <!-- Ministry Info -->
        <div class="space-y-4">
          <div class="flex items-center gap-3">
            <img src="assets/images/WhatsApp Image 2025-07-04 at 17.27.34_37ced412.jpg" alt="Hearts After God Ministry Logo" class="h-12 w-12 rounded-full border-2 border-[#FDBA17]" />
            <div>
              <h3 class="text-xl font-bold">Hearts After God</h3>
              <p class="text-sm text-gray-300">Ministry</p>
            </div>
          </div>
          <p class="text-gray-300 text-sm leading-relaxed">
            Empowering believers to grow in faith, knowledge, and spiritual maturity through comprehensive discipleship programs and community support.
          </p>
          <div class="flex space-x-4">
            <a href="#" class="text-[#FDBA17] hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
              </svg>
            </a>
            <a href="#" class="text-[#FDBA17] hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/>
              </svg>
            </a>
            <a href="#" class="text-[#FDBA17] hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.746-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001 12.017.001z"/>
              </svg>
            </a>
            <a href="#" class="text-[#FDBA17] hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
              </svg>
            </a>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="space-y-4">
          <h3 class="text-lg font-bold text-[#FDBA17]">Quick Links</h3>
          <ul class="space-y-2">
            <li><a href="index.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Home</a></li>
            <li><a href="about.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">About Us</a></li>
            <li><a href="vision.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Our Vision</a></li>
            <li><a href="events.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Events</a></li>
            <li><a href="sermons.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Sermons</a></li>
            <li><a href="blog.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Blog</a></li>
            <li><a href="gallery.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Gallery</a></li>
            <li><a href="discipleship.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Discipleship</a></li>
            <li><a href="missions.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Missions</a></li>
            <li><a href="contact.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Contact</a></li>
          </ul>
        </div>

        <!-- Ministries -->
        <div class="space-y-4">
          <h3 class="text-lg font-bold text-[#FDBA17]">Ministries</h3>
          <ul class="space-y-2">
            <li><a href="discipleship.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Discipleship Program</a></li>
            <li><a href="missions.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Missions & Outreach</a></li>
            <li><a href="sermons.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Teaching & Preaching</a></li>
            <li><a href="events.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Community Events</a></li>
            <li><a href="blog.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Spiritual Resources</a></li>
            <li><a href="gallery.html" class="text-gray-300 hover:text-[#FDBA17] transition-colors">Ministry Activities</a></li>
          </ul>
        </div>

        <!-- Contact & Newsletter -->
        <div class="space-y-4">
          <h3 class="text-lg font-bold text-[#FDBA17]">Contact & Newsletter</h3>
          <div class="space-y-3">
      <div class="flex items-center gap-2">
              <svg class="w-4 h-4 text-[#FDBA17]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              <span class="text-sm text-gray-300">Nairobi, Kenya</span>
      </div>
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4 text-[#FDBA17]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              <span class="text-sm text-gray-300">heartsaftergodministries254@gmail.com</span>
      </div>
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4 text-[#FDBA17]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              <span class="text-sm text-gray-300">+254 700 000 000</span>
            </div>
          </div>
          <div class="pt-4">
            <h4 class="text-sm font-semibold text-[#FDBA17] mb-2">Stay Connected</h4>
            <p class="text-xs text-gray-300 mb-3">Subscribe to our newsletter for updates and spiritual insights.</p>
            <div class="flex">
              <input type="email" placeholder="Your email" class="flex-1 px-3 py-2 text-sm text-gray-900 bg-white rounded-l-lg focus:outline-none focus:ring-2 focus:ring-[#FDBA17]" />
              <button class="px-4 py-2 bg-[#FDBA17] text-[#2046B3] font-bold rounded-r-lg hover:bg-[#E0A615] transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Bar -->
      <div class="border-t border-gray-600 mt-8 pt-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <p class="text-sm text-gray-300">
            Â© 2024 Hearts After God Ministry. All rights reserved.
          </p>
          <div class="flex space-x-6 mt-4 md:mt-0">
            <a href="#" class="text-sm text-gray-300 hover:text-[#FDBA17] transition-colors">Privacy Policy</a>
            <a href="#" class="text-sm text-gray-300 hover:text-[#FDBA17] transition-colors">Terms of Service</a>
            <a href="#" class="text-sm text-gray-300 hover:text-[#FDBA17] transition-colors">Cookie Policy</a>
          </div>
        </div>
        <div class="mt-4 text-center">
          <p class="text-xs text-gray-400">
            Founded by <span class="text-[#FDBA17] font-semibold">Cyrilla Chikamai</span> | Empowering hearts to seek God's purpose
          </p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Profile Modal -->
  <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 relative">
      <button onclick="document.getElementById('profile-modal').classList.add('hidden')" class="absolute top-3 right-3 text-gray-400 hover:text-red-500 text-2xl transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
      <h2 class="text-2xl font-bold text-blue-900 mb-4">My Profile</h2>
      <div class="flex flex-col items-center gap-4">
        <div id="profile-cover" class="w-full h-24 rounded-lg bg-gray-200 flex items-center justify-center mb-2 relative overflow-hidden">
          <canvas id="profile-cover-cropper" width="320" height="96" class="absolute top-0 left-0 w-full h-full z-10 hidden"></canvas>
          <img id="profile-cover-img" src="" alt="Cover" class="w-full h-full object-cover hidden" />
          <span id="profile-cover-placeholder" class="text-gray-400">No cover image</span>
          <input type="file" id="profile-cover-upload" accept="image/*" class="absolute top-2 right-2 opacity-0 w-8 h-8 cursor-pointer" title="Upload cover" />
          <button id="profile-cover-upload-btn" class="absolute top-2 right-2 bg-gold text-white px-2 py-1 rounded text-xs">Upload</button>
          <div id="profile-cover-crop-controls" class="absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-2 z-20 hidden">
            <button id="crop-zoom-in" class="bg-blue-600 text-white px-2 py-1 rounded">+</button>
            <button id="crop-zoom-out" class="bg-blue-600 text-white px-2 py-1 rounded">-</button>
            <button id="crop-aspect" class="bg-blue-600 text-white px-2 py-1 rounded">Lock 4:1</button>
            <button id="crop-save" class="bg-gold text-white px-2 py-1 rounded">Save Crop</button>
          </div>
          <div id="profile-cover-preview" class="absolute top-2 left-2 w-24 h-6 rounded border-2 border-gold bg-white/80 z-30 flex items-center justify-center overflow-hidden hidden"></div>
        </div>
        <div id="profile-avatar" class="text-5xl"></div>
        <select id="profile-avatar-select" class="mb-2 px-2 py-1 border rounded">
          <option value="ðŸ§‘â€ðŸ¦±">ðŸ§‘â€ðŸ¦±</option><option value="ðŸ§‘ðŸ¾">ðŸ§‘ðŸ¾</option><option value="ðŸ‘©â€ðŸ¦°">ðŸ‘©â€ðŸ¦°</option><option value="ðŸ§‘">ðŸ§‘</option><option value="ðŸ‘¨â€ðŸ¦³">ðŸ‘¨â€ðŸ¦³</option><option value="ðŸ‘©ðŸ½">ðŸ‘©ðŸ½</option><option value="ðŸ§‘ðŸ»">ðŸ§‘ðŸ»</option><option value="ðŸ‘©â€ðŸ¦³">ðŸ‘©â€ðŸ¦³</option>
        </select>
        <input id="profile-name" class="px-2 py-1 border rounded w-full" />
        <input id="profile-email" class="px-2 py-1 border rounded w-full" disabled />
        <div id="profile-badges" class="flex flex-wrap gap-2 mt-2"></div>
        <div id="profile-ban-history" class="w-full mt-2 text-xs text-red-700"></div>
        <div id="profile-mute-history" class="w-full mt-1 text-xs text-yellow-700"></div>
        <button id="profile-save-btn" class="bg-blue-600 text-white px-4 py-2 rounded font-bold mt-4">Save Changes</button>
      </div>
    </div>
  </div>
  <!-- Admin Broadcast Modal -->
  <div id="broadcast-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 relative">
      <button onclick="document.getElementById('broadcast-modal').classList.add('hidden')" class="absolute top-3 right-3 text-gray-400 hover:text-red-500 text-2xl">&times;</button>
      <h2 class="text-2xl font-bold text-purple-700 mb-4">Send Broadcast Message</h2>
      <textarea id="broadcast-input" class="w-full border rounded p-2 mb-4" rows="3" placeholder="Type your message..."></textarea>
      <button id="broadcast-send-btn" class="bg-gold text-white px-4 py-2 rounded font-bold">Send</button>
    </div>
  </div>
  <div id="broadcast-banner" class="hidden fixed top-0 left-0 w-full bg-purple-700 text-white text-center py-2 z-50 font-bold"></div>

  <!-- Enhanced Moderation Modals -->
  
  <!-- User Moderation Modal -->
  <div id="user-moderation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <h3 id="user-moderation-modal-title" class="text-xl font-bold mb-4">Moderate User</h3>
      <div id="user-moderation-modal-body" class="mb-4">
        <!-- Populated by JS -->
      </div>
      <form id="user-moderation-form" class="space-y-3">
        <div>
          <label class="block font-semibold">Action</label>
          <select id="moderation-action-select" class="border px-2 py-1 rounded w-full">
            <option value="ban">Ban</option>
            <option value="mute">Mute</option>
            <option value="unban">Unban</option>
            <option value="unmute">Unmute</option>
            <option value="warn">Warn</option>
          </select>
        </div>
        <div id="moderation-duration-group">
          <label class="block font-semibold">Duration</label>
          <select id="moderation-duration-select" class="border px-2 py-1 rounded w-full">
            <option value="3600">1 hour</option>
            <option value="86400">24 hours</option>
            <option value="604800">7 days</option>
            <option value="2592000">30 days</option>
            <option value="0">Permanent</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold">Reason</label>
          <textarea id="moderation-reason-input" class="border px-2 py-1 rounded w-full" rows="3" placeholder="Enter moderation reason..." required></textarea>
        </div>
        <div class="flex gap-2 mt-4">
          <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded">Submit</button>
          <button type="button" id="user-moderation-modal-cancel" class="bg-gray-300 px-4 py-2 rounded">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Content Moderation Modal -->
  <div id="content-moderation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-2xl">
      <h3 id="content-moderation-modal-title" class="text-xl font-bold mb-4">Moderate Content</h3>
      <div id="content-moderation-modal-body" class="mb-4">
        <!-- Populated by JS -->
      </div>
      <form id="content-moderation-form" class="space-y-3">
        <div>
          <label class="block font-semibold">Action</label>
          <select id="content-action-select" class="border px-2 py-1 rounded w-full">
            <option value="approve">Approve</option>
            <option value="reject">Reject</option>
            <option value="delete">Delete</option>
            <option value="edit">Edit</option>
          </select>
        </div>
        <div>
          <label class="block font-semibold">Reason (Optional)</label>
          <textarea id="content-reason-input" class="border px-2 py-1 rounded w-full" rows="3" placeholder="Enter reason for action..."></textarea>
        </div>
        <div class="flex gap-2 mt-4">
          <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded">Submit</button>
          <button type="button" id="content-moderation-modal-cancel" class="bg-gray-300 px-4 py-2 rounded">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Moderation Logs Modal -->
  <div id="modlogs-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-8 relative">
      <button onclick="document.getElementById('modlogs-modal').classList.add('hidden')" class="absolute top-3 right-3 text-gray-400 hover:text-red-500 text-2xl">&times;</button>
      <h2 class="text-2xl font-bold text-purple-700 mb-4">Moderation Logs</h2>
      <table class="w-full text-sm"><thead><tr class="bg-purple-50"><th class="py-2 px-3 text-left">User</th><th class="py-2 px-3 text-left">Action</th><th class="py-2 px-3 text-left">Date</th><th class="py-2 px-3 text-left">Duration</th></tr></thead><tbody id="modlogs-table"></tbody></table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
  <script src="assets/js/discipleship-backend.js"></script>
  <script src="assets/js/user-simple.js"></script>
  <script src="assets/js/user-notes.js"></script>
  <script src="assets/js/user-quiz.js"></script>
  <script src="assets/js/main.js"></script>
  <script>
    // Set user name/email from localStorage if available
    document.addEventListener('DOMContentLoaded', function() {
      try {
        const user = JSON.parse(localStorage.getItem('discipleship_logged_in_user'));
        if (user && user.name) {
          document.getElementById('user-name').innerText = user.name;
          document.getElementById('nav-user-name').innerText = user.name;
        }
        if (user && user.email) {
          document.getElementById('user-email').innerText = user.email;
          document.getElementById('user-avatar').innerText = user.name ? user.name[0].toUpperCase() : 'ðŸ‘¤';
          document.getElementById('nav-user-avatar').innerText = user.name ? user.name[0].toUpperCase() : 'ðŸ‘¤';
        }
      } catch (e) {}
      document.getElementById('logout-btn').onclick = function() {
        window.location.href = 'user-dashboard.html';
      };
      // Rotating motivational quotes/verses
      const quotes = [
        '"But you will receive power when the Holy Spirit comes on you; and you will be my witnesses..." â€” Acts 1:8',
        '"I can do all things through Christ who strengthens me." â€” Philippians 4:13',
        '"Let your light shine before others." â€” Matthew 5:16',
        '"The Lord is my shepherd; I shall not want." â€” Psalm 23:1',
        '"Be strong and courageous. Do not be afraid." â€” Joshua 1:9'
      ];
      let idx = 0;
      setInterval(() => {
        idx = (idx + 1) % quotes.length;
        document.getElementById('motivation-text').innerText = quotes[idx];
      }, 7000);
      // Link lesson progress, badges, and stats from backend
      const backend = new window.DiscipleshipBackend();
      const user = getCurrentUser();
      let userId = null;
      if (user) {
        for (const [id, u] of Object.entries(backend.users)) {
          if (u.email === user.email) { userId = id; break; }
        }
        if (userId) {
          const progress = backend.getUserProgress(userId);
          const stats = backend.getUserStats(userId);
          // Update dashboard widgets
          document.getElementById('summary-lessons').innerText = stats.completedLessons;
          document.getElementById('summary-progress').innerText = stats.progressPercentage + '%';
          document.getElementById('summary-badges').innerText = progress.certificates.length;
          // Update next lesson
          const nextLessonNum = progress.completedLessons.length + 1;
          document.getElementById('next-lesson-title').innerText = 'Day ' + nextLessonNum + ': ' + (window.lessons && window.lessons[nextLessonNum-1] ? window.lessons[nextLessonNum-1].title : 'Next Lesson');
          // Update recent activity
          const recent = [];
          progress.completedLessons.slice(-3).reverse().forEach(lessonId => {
            recent.push('âœ”ï¸ Completed Day ' + lessonId);
          });
          if (progress.certificates.length) {
            recent.push('ðŸ† Earned badge: ' + progress.certificates[progress.certificates.length-1].name);
          }
          document.getElementById('recent-activity').innerHTML = recent.map(r => `<li>${r}</li>`).join('');
          // Update lesson cards (status)
          document.querySelectorAll('#lessons .group').forEach((card, idx) => {
            const lessonId = idx+1;
            const statusSpan = card.querySelector('span.bg-yellow-500, span.bg-blue-500, span.bg-purple-500, span.bg-red-500');
            if (progress.completedLessons.includes(lessonId)) {
              statusSpan.innerText = 'Completed';
              statusSpan.className = 'bg-yellow-500 text-blue-900 text-xs px-3 py-1 rounded-full font-bold shadow-sm';
            } else if (lessonId === nextLessonNum) {
              statusSpan.innerText = 'In Progress';
              statusSpan.className = 'bg-blue-500 text-white text-xs px-3 py-1 rounded-full font-bold shadow-sm';
            } else if (lessonId < nextLessonNum) {
              statusSpan.innerText = 'Review';
              statusSpan.className = 'bg-yellow-500 text-blue-900 text-xs px-3 py-1 rounded-full font-bold shadow-sm';
            } else {
              statusSpan.innerText = 'Locked';
              statusSpan.className = (lessonId%2===0 ? 'bg-purple-500' : 'bg-red-500') + ' text-white text-xs px-3 py-1 rounded-full font-bold shadow-sm';
            }
          });
          // Advanced badge logic
          const badges = [];
          if (progress.completedLessons.length >= 1) {
            badges.push({
              icon: 'fa-star',
              color: 'yellow-500',
              name: 'First Steps',
              desc: 'Completed your first lesson',
              unlocked: true
            });
          }
          if (progress.completedLessons.length >= 2 && stats.currentStreak >= 2) {
            badges.push({
              icon: 'fa-bolt',
              color: 'purple-500',
              name: 'Quick Learner',
              desc: 'Completed 2 lessons in a row',
              unlocked: true
            });
          }
          if (Object.keys(progress.quizScores).length && Object.values(progress.quizScores).some(q => q.score >= 90)) {
            badges.push({
              icon: 'fa-trophy',
              color: 'blue-500',
              name: 'Quiz Master',
              desc: 'Scored 90%+ on a quiz',
              unlocked: true
            });
          }
          if (Object.keys(progress.notes).length) {
            badges.push({
              icon: 'fa-book',
              color: 'green-500',
              name: 'Note Taker',
              desc: 'Saved a lesson note',
              unlocked: true
            });
          }
          // New badge: Streak Champion
          if (stats.currentStreak >= 3) {
            badges.push({
              icon: 'fa-fire',
              color: 'red-500',
              name: 'Streak Champion',
              desc: '3+ day learning streak',
              unlocked: true
            });
          }
          // New badge: Time Investor
          const totalTime = Object.values(progress.timeSpent).reduce((a,b)=>a+b,0);
          if (totalTime >= 120) {
            badges.push({
              icon: 'fa-hourglass-half',
              color: 'gold-500',
              name: 'Time Investor',
              desc: 'Spent 2+ hours learning',
              unlocked: true
            });
          }
          // New badge: Community Builder (simulate with progress.joinedCommunity)
          if (progress.joinedCommunity) {
            badges.push({
              icon: 'fa-users',
              color: 'blue-500',
              name: 'Community Builder',
              desc: 'Joined a study group',
              unlocked: true
            });
          }
          // Render badges
          const badgeList = document.querySelector('#achievements .flex.flex-wrap');
          if (badgeList) {
            badgeList.innerHTML = badges.map(badge => `
              <div class="flex flex-col items-center bg-gradient-to-br from-${badge.color.replace('-500','-100')} to-${badge.color.replace('-500','-200')} rounded-xl p-6 shadow w-48 relative group">
                <i class="fa ${badge.icon} text-${badge.color} text-3xl mb-2"></i>
                <div class="font-bold text-blue-900">${badge.name}</div>
                <div class="text-xs text-gray-600 mb-2">${badge.desc}</div>
                <div class="text-xs text-${badge.color} font-bold">Unlocked</div>
                <div class="absolute left-1/2 -translate-x-1/2 bottom-2 w-10/12 h-2 bg-${badge.color.replace('-500','-200')} rounded-full overflow-hidden">
                  <div class="bg-${badge.color} h-2 rounded-full" style="width:100%"></div>
                </div>
                <div class="absolute top-2 right-2 bg-${badge.color} text-white text-xs px-2 py-1 rounded shadow opacity-0 group-hover:opacity-100 transition">Unlocked!</div>
              </div>
            `).join('');
          }
          // Enhance lesson modal to show quiz scores, notes, and allow adding notes
          window.showLessonModal = function(id) {
            const lesson = window.lessons ? window.lessons.find(l => l.id === id) : null;
            let quizScore = progress.quizScores[id] ? progress.quizScores[id].score + '%' : 'N/A';
            let quizPassed = progress.quizScores[id] ? progress.quizScores[id].passed : false;
            let notes = backend.getUserNotes(userId, id);
            let checklistHtml = lesson && lesson.checklist ? lesson.checklist.map((item, idx) => `
              <li class="flex items-center gap-2 mb-2">
                <input type="checkbox" ${item.done ? 'checked' : ''} disabled class="form-checkbox h-5 w-5 text-blue-600 rounded" />
                <span class="${item.done ? 'line-through text-gray-400' : ''}">${item.text}</span>
              </li>
            `).join('') : '';
            const isCompleted = progress.completedLessons.includes(id);
            document.getElementById('lesson-modal-content').innerHTML = `
              <div id="lesson-success-msg" class="hidden mb-4 p-3 rounded bg-green-100 text-green-800 font-semibold flex items-center gap-2"><i class="fa fa-check-circle"></i> Lesson marked as complete!</div>
              <h2 class="text-xl font-bold text-blue-900 mb-2">${lesson ? lesson.title : 'Lesson ' + id}</h2>
              <div class="text-sm text-gray-600 mb-4">${lesson ? lesson.description : ''}</div>
              <div class="flex items-center gap-4 mb-4">
                <span class="bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full font-semibold">${lesson ? lesson.status : ''}</span>
                <span class="flex items-center gap-1 text-xs text-gray-600"><i class='fa fa-clipboard-check'></i> Quiz: ${quizScore} ${quizPassed ? '<span class=\'text-green-600\'>(Passed)</span>' : ''}</span>
              </div>
              <div class="mb-4">
                <h3 class="font-bold text-blue-900 mb-2">Checklist</h3>
                <ul>${checklistHtml}</ul>
              </div>
              <div class="mb-4">
                <h3 class="font-bold text-blue-900 mb-2">Your Notes</h3>
                <ul id="lesson-notes-list">${notes && notes.length ? notes.map(n => `<li class='mb-1 text-sm text-gray-700'>ðŸ“ ${n.content} <span class='text-xs text-gray-400'>(${n.date.split('T')[0]})</span></li>`).join('') : '<li class="text-gray-400">No notes yet.</li>'}</ul>
                <form id="add-note-form" class="mt-2 flex gap-2"> <input type="text" id="add-note-input" class="flex-1 px-2 py-1 border rounded" placeholder="Add a note..." required /> <button type="submit" class="bg-gold text-white px-3 py-1 rounded font-bold">Add</button> </form>
              </div>
              <button id="mark-complete-btn" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-green-700 transition text-sm" ${isCompleted ? 'disabled' : ''}>${isCompleted ? 'Completed' : 'Mark as Complete'}</button>
            `;
            document.getElementById('lesson-modal').classList.remove('hidden');
            // Add note form logic
            const addNoteForm = document.getElementById('add-note-form');
            if (addNoteForm) {
              addNoteForm.onsubmit = function(e) {
                e.preventDefault();
                const noteVal = document.getElementById('add-note-input').value.trim();
                if (noteVal) {
                  backend.saveUserNote(userId, id, noteVal);
                  // Refresh notes list
                  const updatedNotes = backend.getUserNotes(userId, id);
                  document.getElementById('lesson-notes-list').innerHTML = updatedNotes.map(n => `<li class='mb-1 text-sm text-gray-700'>ðŸ“ ${n.content} <span class='text-xs text-gray-400'>(${n.date.split('T')[0]})</span></li>`).join('');
                  document.getElementById('add-note-input').value = '';
                }
              };
            }
            // Mark as complete logic
            const markBtn = document.getElementById('mark-complete-btn');
            if (markBtn && !isCompleted) {
              markBtn.onclick = function() {
                if (confirm('Are you sure you want to mark this lesson as complete?')) {
                  backend.completeLesson(userId, id);
                  // Show success message
                  const msg = document.getElementById('lesson-success-msg');
                  if (msg) { msg.classList.remove('hidden'); }
                  setTimeout(() => { window.location.reload(); }, 1200);
                }
              };
            }
          };
          // Community join simulation
          const joinBtn = document.getElementById('join-community-btn');
          const commExpanded = document.getElementById('community-expanded');
          if (joinBtn) {
            // Show expanded features if already joined
            if (progress.joinedCommunity) {
              joinBtn.disabled = true;
              joinBtn.innerText = 'Joined!';
              if (commExpanded) commExpanded.classList.remove('hidden');
              renderCommunityFeatures();
            }
            joinBtn.onclick = function() {
              if (confirm('Join the Hearts After God Study Group?')) {
                progress.joinedCommunity = true;
                backend.updateUserProgress(userId, progress);
                joinBtn.disabled = true;
                joinBtn.innerText = 'Joined!';
                if (commExpanded) commExpanded.classList.remove('hidden');
                renderCommunityFeatures();
                // Show success message and mock group
                const commSection = joinBtn.closest('section');
                if (commSection) {
                  const msg = document.createElement('div');
                  msg.className = 'mt-4 p-3 rounded bg-green-100 text-green-800 font-semibold flex items-center gap-2';
                  msg.innerHTML = '<i class="fa fa-users"></i> Welcome to the Study Group!';
                  commSection.appendChild(msg);
                  setTimeout(() => { msg.remove(); }, 2000);
                }
              }
            };
          }
          // Community features logic
          function renderCommunityFeatures() {
            // Announcements: admin can pin, all see, admin can remove
            const annKey = 'community_announcements';
            function getAnns() { return JSON.parse(localStorage.getItem(annKey)||'[]'); }
            function setAnns(anns) { localStorage.setItem(annKey, JSON.stringify(anns)); }
            const anns = getAnns();
            const annList = document.getElementById('community-announcements');
            const user = getCurrentUser();
            const isAdmin = user && user.role === 'admin';
            if (annList) {
              annList.innerHTML = (anns.length ? anns.map((a,i) => `<li>${a} ${isAdmin?`<button class='ml-2 text-red-500' onclick='removeAnnouncement(${i})' title='Remove'>&times;</button>`:''}</li>`): [
                '<li><span class="font-bold text-gold">[New]</span> Welcome to the Hearts After God Study Group! ðŸŽ‰</li>',
                '<li>Next group devotional: <span class="font-semibold">Friday, 7pm</span> (Zoom link in chat)</li>',
                '<li>Share your testimony in the chat below!</li>'
              ]).join('');
            }
            window.removeAnnouncement = function(idx) {
              const anns = getAnns();
              anns.splice(idx,1);
              setAnns(anns);
              renderCommunityFeatures();
            };
            // Show pin form for admin
            const annForm = document.getElementById('announcement-form');
            if (annForm) {
              annForm.classList.toggle('hidden', !isAdmin);
              annForm.onsubmit = function(e) {
                e.preventDefault();
                const val = document.getElementById('announcement-input').value.trim();
                if (val) {
                  const anns = getAnns();
                  anns.unshift(`<span class='font-bold text-gold'>[Pinned]</span> ${val}`);
                  setAnns(anns);
                  renderCommunityFeatures();
                  document.getElementById('announcement-input').value = '';
                }
              };
            }
            // Leaderboard: aggregate all users, admin can promote
            const users = JSON.parse(localStorage.getItem('discipleship_users')||'[]');
            const progress = JSON.parse(localStorage.getItem('discipleship_progress')||'{}');
            const avatars = ['ðŸ§‘â€ðŸ¦±','ðŸ§‘ðŸ¾','ðŸ‘©â€ðŸ¦°','ðŸ§‘','ðŸ‘¨â€ðŸ¦³','ðŸ‘©ðŸ½','ðŸ§‘ðŸ»','ðŸ‘©â€ðŸ¦³'];
            const leaderboard = users.map((u,i)=>{
              const p = Object.values(progress).find(pr=>pr && pr.completedLessons && pr.notes && u.id && pr.userId ? pr.userId===u.id : u.email===user.email);
              return {
                name: u.name,
                email: u.email,
                lessons: p && p.completedLessons ? p.completedLessons.length : 0,
                badges: p && p.certificates ? p.certificates.length : 0,
                avatar: u.avatar || avatars[i%avatars.length],
                isCurrent: u.email===user.email,
                isAdmin: u.role==='admin',
                idx: i
              };
            });
            leaderboard.sort((a,b)=>b.lessons-a.lessons);
            const maxLessons = leaderboard.length ? leaderboard[0].lessons : 0;
            const tbody = document.getElementById('community-leaderboard');
            if (tbody) {
              tbody.innerHTML = leaderboard.map(m => `<tr${m.isCurrent ? ' class=\"bg-yellow-50 font-bold\"' : ''}><td class='py-1 px-3 text-2xl'>${m.avatar}</td><td class='py-1 px-3'>${m.name}</td><td class='py-1 px-3'>${m.lessons}</td><td class='py-1 px-3'>${m.badges}</td><td>${m.lessons===maxLessons&&m.lessons>0?'<span class=\"inline-block bg-gold text-white text-xs px-2 py-0.5 rounded-full\">Top Learner</span>':''}</td><td>${isAdmin&&!m.isAdmin?`<button class='text-blue-600 underline' onclick='promoteAdmin(${m.idx})'>Promote</button> <button class='text-red-600 underline' onclick='banUser(${m.idx},true)'>Ban</button> <button class='text-yellow-600 underline' onclick='muteUser(${m.idx},true)'>Mute</button>`:m.isAdmin?'<span class=\"text-purple-600 font-bold\">Admin</span>':''}${m.banned?`<span class=\"text-red-600 font-bold ml-2\">Banned</span> ${isAdmin?`<button class='text-green-600 underline' onclick='unbanUser(${m.idx})'>Unban</button>`:''}`:''}${m.muted?`<span class=\"text-yellow-600 font-bold ml-2\">Muted</span> ${isAdmin?`<button class='text-green-600 underline' onclick='unmuteUser(${m.idx})'>Unmute</button>`:''}`:''}</td></tr>`).join('');
            }
            window.promoteAdmin = function(idx) {
              const users = JSON.parse(localStorage.getItem('discipleship_users')||'[]');
              users[idx].role = 'admin';
              localStorage.setItem('discipleship_users', JSON.stringify(users));
              renderCommunityFeatures();
            };
            // Timed mutes/bans
            window.banUser = function(idx, timed) {
              const users = JSON.parse(localStorage.getItem('discipleship_users')||'[]');
              users[idx].banned = true;
              let duration = 'permanent';
              if (timed) {
                const mins = prompt('Ban for how many minutes? (Leave blank for permanent)');
                if (mins && !isNaN(mins)) {
                  users[idx].banUntil = Date.now() + parseInt(mins)*60000;
                  users[idx].banHistory = (users[idx].banHistory||[]).concat({date:new Date().toISOString(),duration:mins+' min'});
                  duration = mins+' min';
                } else {
                  users[idx].banUntil = null;
                  users[idx].banHistory = (users[idx].banHistory||[]).concat({date:new Date().toISOString(),duration:'permanent'});
                }
              }
              addModLog(users[idx].name,'Ban',duration);
              localStorage.setItem('discipleship_users', JSON.stringify(users));
              renderCommunityFeatures();
            };
            window.muteUser = function(idx, timed) {
              const users = JSON.parse(localStorage.getItem('discipleship_users')||'[]');
              users[idx].muted = true;
              let duration = 'permanent';
              if (timed) {
                const mins = prompt('Mute for how many minutes? (Leave blank for permanent)');
                if (mins && !isNaN(mins)) {
                  users[idx].muteUntil = Date.now() + parseInt(mins)*60000;
                  users[idx].muteHistory = (users[idx].muteHistory||[]).concat({date:new Date().toISOString(),duration:mins+' min'});
                  duration = mins+' min';
                } else {
                  users[idx].muteUntil = null;
                  users[idx].muteHistory = (users[idx].muteHistory||[]).concat({date:new Date().toISOString(),duration:'permanent'});
                }
              }
              addModLog(users[idx].name,'Mute',duration);
              localStorage.setItem('discipleship_users', JSON.stringify(users));
              renderCommunityFeatures();
            };
            // Auto-unban/unmute
            setInterval(()=>{
              const users = JSON.parse(localStorage.getItem('discipleship_users')||'[]');
              let changed = false;
              users.forEach(u=>{
                if (u.banned && u.banUntil && Date.now()>u.banUntil) { u.banned=false; u.banUntil=null; changed=true; }
                if (u.muted && u.muteUntil && Date.now()>u.muteUntil) { u.muted=false; u.muteUntil=null; changed=true; }
              });
              if (changed) localStorage.setItem('discipleship_users', JSON.stringify(users));
            }, 5000);
            window.unbanUser = function(idx) {
              const users = JSON.parse(localStorage.getItem('discipleship_users')||'[]');
              users[idx].banned = false;
              addModLog(users[idx].name,'Unban','');
              localStorage.setItem('discipleship_users', JSON.stringify(users));
              renderCommunityFeatures();
            };
            window.unmuteUser = function(idx) {
              const users = JSON.parse(localStorage.getItem('discipleship_users')||'[]');
              users[idx].muted = false;
              addModLog(users[idx].name,'Unmute','');
              localStorage.setItem('discipleship_users', JSON.stringify(users));
              renderCommunityFeatures();
            };
            // Group chat: use localStorage for demo, poll every 2s, admin can delete, emoji reactions
            const chatKey = 'community_chat_messages';
            function getChat() { return JSON.parse(localStorage.getItem(chatKey)||'[]'); }
            function setChat(msgs) { localStorage.setItem(chatKey, JSON.stringify(msgs)); }
            function renderChat() {
              const msgs = getChat();
              const box = document.getElementById('community-chat-messages');
              if (box) {
                box.innerHTML = msgs.map((m,i) => `<div class='flex gap-2 items-center'><span class='font-bold text-blue-900'>${m.name}:</span> <span>${m.text}</span> <span class='flex gap-1'>${['ðŸ‘','â¤ï¸','ðŸ™','ðŸŽ‰'].map(e=>`<button class='text-lg' onclick='reactChat(${i},\"${e}\")' title='React'>${e}${m.reactions&&m.reactions[e]?`<span class=\\"text-xs\\">${m.reactions[e]}</span>`:''}</button>`).join('')}</span> ${isAdmin?`<button class='ml-2 text-red-500' onclick='deleteChat(${i})' title='Delete'>&times;</button>`:''}</div>`).join('');
                box.scrollTop = box.scrollHeight;
              }
            }
            // Chat restriction for muted users
            const usersArr = JSON.parse(localStorage.getItem('discipleship_users')||'[]');
            const thisUser = usersArr.find(u=>u.email===user.email);
            const chatForm = document.getElementById('community-chat-form');
            if (chatForm) {
              if (thisUser && thisUser.muted) {
                chatForm.classList.add('opacity-50','pointer-events-none');
                if (!document.getElementById('muted-warning')) {
                  const warn = document.createElement('div');
                  warn.id = 'muted-warning';
                  warn.className = 'mb-2 text-yellow-700 font-bold flex items-center gap-2';
                  warn.innerHTML = '<i class="fa fa-ban"></i> You are muted and cannot send messages.';
                  chatForm.parentNode.insertBefore(warn, chatForm);
                }
              } else {
                chatForm.classList.remove('opacity-50','pointer-events-none');
                const warn = document.getElementById('muted-warning');
                if (warn) warn.remove();
              }
              chatForm.onsubmit = function(e) {
                if (thisUser && thisUser.muted) return false;
                e.preventDefault();
                const input = document.getElementById('community-chat-input');
                const val = input.value.trim();
                if (val) {
                  const msgs = getChat();
                  msgs.push({ name: user.name, text: val });
                  setChat(msgs);
                  renderChat();
                  input.value = '';
                }
              };
            }
            window.deleteChat = function(idx) {
              const msgs = getChat();
              msgs.splice(idx,1);
              setChat(msgs);
              renderChat();
            };
            window.reactChat = function(idx, emoji) {
              const msgs = getChat();
              msgs[idx].reactions = msgs[idx].reactions || {};
              msgs[idx].reactions[emoji] = (msgs[idx].reactions[emoji]||0)+1;
              setChat(msgs);
              renderChat();
            };
            renderChat();
            setInterval(renderChat, 2000);
            // Profile modal logic
            const profileBtn = document.getElementById('view-profile-btn');
            if (profileBtn) {
              profileBtn.onclick = function() {
                const users = JSON.parse(localStorage.getItem('discipleship_users')||'[]');
                const idx = users.findIndex(u=>u.email===user.email);
                const u = users[idx];
                document.getElementById('profile-modal').classList.remove('hidden');
                // Cover image
                if (u.cover) {
                  document.getElementById('profile-cover-img').src = u.cover;
                  document.getElementById('profile-cover-img').classList.remove('hidden');
                  document.getElementById('profile-cover-placeholder').classList.add('hidden');
                } else {
                  document.getElementById('profile-cover-img').classList.add('hidden');
                  document.getElementById('profile-cover-placeholder').classList.remove('hidden');
                }
                document.getElementById('profile-avatar').innerText = u.avatar || avatars[idx%avatars.length];
                document.getElementById('profile-avatar-select').value = u.avatar || avatars[idx%avatars.length];
                document.getElementById('profile-name').value = u.name;
                document.getElementById('profile-email').value = u.email;
                // Show badges
                const p = Object.values(progress).find(pr=>pr && pr.completedLessons && pr.notes && u.id && pr.userId ? pr.userId===u.id : u.email===user.email);
                const badgeBox = document.getElementById('profile-badges');
                badgeBox.innerHTML = (p && p.certificates ? p.certificates.map(b=>`<span class='inline-block bg-gold text-white text-xs px-2 py-0.5 rounded-full'>${b.name||'Badge'}</span>`).join('') : '');
                // Save changes
                document.getElementById('profile-save-btn').onclick = function() {
                  u.avatar = document.getElementById('profile-avatar-select').value;
                  u.name = document.getElementById('profile-name').value;
                  users[idx] = u;
                  localStorage.setItem('discipleship_users', JSON.stringify(users));
                  // Save cover
                  if (window._profileCoverDataUrl) {
                    u.cover = window._profileCoverDataUrl;
                    localStorage.setItem('discipleship_users', JSON.stringify(users));
                  }
                  document.getElementById('profile-modal').classList.add('hidden');
                  renderCommunityFeatures();
                };
                document.getElementById('profile-avatar-select').onchange = function() {
                  document.getElementById('profile-avatar').innerText = this.value;
                };
                // Cover upload
                document.getElementById('profile-cover-upload-btn').onclick = function() {
                  document.getElementById('profile-cover-upload').click();
                };
                document.getElementById('profile-cover-upload').onchange = function(e) {
                  const file = e.target.files[0];
                  if (file) {
                    const reader = new FileReader();
                    reader.onload = function(evt) {
                      // Center crop preview (simple, square)
                      const img = new window.Image();
                      img.onload = function() {
                        const size = Math.min(img.width, img.height);
                        const canvas = document.createElement('canvas');
                        canvas.width = canvas.height = 320;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, (img.width-size)/2, (img.height-size)/2, size, size, 0, 0, 320, 320);
                        window._profileCoverDataUrl = canvas.toDataURL('image/jpeg');
                        document.getElementById('profile-cover-img').src = window._profileCoverDataUrl;
                        document.getElementById('profile-cover-img').classList.remove('hidden');
                        document.getElementById('profile-cover-placeholder').classList.add('hidden');
                      };
                      img.src = evt.target.result;
                    };
                    reader.readAsDataURL(file);
                  }
                };
                // Ban/mute history
                document.getElementById('profile-ban-history').innerHTML = u.banHistory ? 'Ban history: ' + u.banHistory.map(b=>`${b.date.split('T')[0]} (${b.duration})`).join(', ') : '';
                document.getElementById('profile-mute-history').innerHTML = u.muteHistory ? 'Mute history: ' + u.muteHistory.map(b=>`${b.date.split('T')[0]} (${b.duration})`).join(', ') : '';
                // Advanced cropping
                document.getElementById('profile-cover-upload').onchange = function(e) {
                  const file = e.target.files[0];
                  if (file) {
                    const reader = new FileReader();
                    reader.onload = function(evt) {
                      const img = new window.Image();
                      img.onload = function() {
                        // Advanced crop: zoom/drag
                        const cropper = document.getElementById('profile-cover-cropper');
                        cropper.classList.remove('hidden');
                        document.getElementById('profile-cover-img').classList.add('hidden');
                        document.getElementById('profile-cover-placeholder').classList.add('hidden');
                        document.getElementById('profile-cover-crop-controls').classList.remove('hidden');
                        document.getElementById('profile-cover-preview').classList.remove('hidden');
                        let zoom = 1, offsetX = 0, offsetY = 0, dragging = false, dragStart = null, aspectLock = true;
                        function draw() {
                          const ctx = cropper.getContext('2d');
                          ctx.clearRect(0,0,320,96);
                          let w = img.width*zoom, h = img.height*zoom;
                          // Aspect ratio lock (4:1)
                          if (aspectLock) {
                            const targetRatio = 320/96;
                            if (w/h > targetRatio) { w = h*targetRatio; } else { h = w/targetRatio; }
                          }
                          ctx.drawImage(img, offsetX, offsetY, w, h);
                          // Live preview
                          const preview = document.getElementById('profile-cover-preview');
                          const pctx = preview.getContext('2d');
                          preview.width = 96*4; preview.height = 24;
                          pctx.clearRect(0,0,preview.width,preview.height);
                          pctx.drawImage(cropper, 0, 0, 320, 96, 0, 0, preview.width, preview.height);
                        }
                        draw();
                        cropper.onmousedown = function(e) { dragging=true; dragStart={x:e.offsetX, y:e.offsetY, ox:offsetX, oy:offsetY}; };
                        cropper.onmouseup = function(){dragging=false;};
                        cropper.onmouseleave = function(){dragging=false;};
                        cropper.onmousemove = function(e){
                          if (dragging) {
                            offsetX = dragStart.ox + (e.offsetX-dragStart.x);
                            offsetY = dragStart.oy + (e.offsetY-dragStart.y);
                            draw();
                          }
                        };
                        document.getElementById('crop-zoom-in').onclick = function(){ zoom*=1.1; draw(); };
                        document.getElementById('crop-zoom-out').onclick = function(){ zoom/=1.1; draw(); };
                        document.getElementById('crop-aspect').onclick = function(){ aspectLock=!aspectLock; this.innerText=aspectLock?'Lock 4:1':'Free'; draw(); };
                        document.getElementById('crop-save').onclick = function(){ window._profileCoverDataUrl = cropper.toDataURL('image/jpeg'); cropper.classList.add('hidden'); document.getElementById('profile-cover-img').src = window._profileCoverDataUrl; document.getElementById('profile-cover-img').classList.remove('hidden'); document.getElementById('profile-cover-crop-controls').classList.add('hidden'); document.getElementById('profile-cover-preview').classList.add('hidden'); };
                      };
                      img.src = evt.target.result;
                    };
                    reader.readAsDataURL(file);
                  }
                };
              };
            }
            // Admin broadcast
            if (isAdmin) {
              if (!document.getElementById('broadcast-btn')) {
                const btn = document.createElement('button');
                btn.id = 'broadcast-btn';
                btn.className = 'ml-4 bg-purple-700 text-white px-4 py-2 rounded-full font-bold shadow hover:scale-105 transition';
                btn.innerText = 'Broadcast Message';
                btn.onclick = function() {
                  document.getElementById('broadcast-modal').classList.remove('hidden');
                };
                document.querySelector('.flex-1').appendChild(btn);
              }
              document.getElementById('broadcast-send-btn').onclick = function() {
                const msg = document.getElementById('broadcast-input').value.trim();
                if (msg) {
                  localStorage.setItem('community_broadcast', msg);
                  document.getElementById('broadcast-modal').classList.add('hidden');
                  document.getElementById('broadcast-input').value = '';
                  showBroadcastBanner();
                }
              };
            }
            function showBroadcastBanner() {
              const msg = localStorage.getItem('community_broadcast');
              const banner = document.getElementById('broadcast-banner');
              if (msg) {
                banner.innerText = msg;
                banner.classList.remove('hidden');
                setTimeout(()=>banner.classList.add('hidden'), 8000);
              }
            }
            showBroadcastBanner();
            // ... leaderboard row ...
            if (isAdmin) {
              if (!document.getElementById('modlogs-btn')) {
                const btn = document.createElement('button');
                btn.id = 'modlogs-btn';
                btn.className = 'ml-4 bg-yellow-600 text-white px-4 py-2 rounded-full font-bold shadow hover:scale-105 transition';
                btn.innerText = 'Moderation Logs';
                btn.onclick = function() {
                  document.getElementById('modlogs-modal').classList.remove('hidden');
                  renderModLogs();
                };
                document.querySelector('.flex-1').appendChild(btn);
              }
            }
            function addModLog(user, action, duration) {
              const logs = JSON.parse(localStorage.getItem('mod_logs')||'[]');
              logs.unshift({user, action, date:new Date().toISOString(), duration});
              localStorage.setItem('mod_logs', JSON.stringify(logs));
            }
            function renderModLogs() {
              const logs = JSON.parse(localStorage.getItem('mod_logs')||'[]');
              const table = document.getElementById('modlogs-table');
              if (table) {
                table.innerHTML = logs.map(l=>`<tr><td class='py-1 px-3'>${l.user}</td><td class='py-1 px-3'>${l.action}</td><td class='py-1 px-3'>${l.date.split('T')[0]}</td><td class='py-1 px-3'>${l.duration}</td></tr>`).join('');
              }
            }
          }
        }
      }
      renderCertificates();
    });

    // Lesson Modal Logic
    const lessons = [
      {
        id: 1,
        title: 'Day 1: Foundations of Faith',
        status: 'Completed',
        description: 'Understanding salvation, grace, and your new identity in Christ.',
        time: '45 min',
        quiz: '95%',
        checklist: [
          { text: 'Read the lesson passage', done: true },
          { text: 'Watch the lesson video', done: true },
          { text: 'Complete the quiz', done: true },
        ]
      },
      {
        id: 2,
        title: 'Day 2: Prayer & Devotion',
        status: 'In Progress',
        description: 'Building a daily habit of prayer, worship, and Bible study.',
        time: '30 min',
        quiz: '60%',
        checklist: [
          { text: 'Read the lesson passage', done: true },
          { text: 'Watch the lesson video', done: false },
          { text: 'Complete the quiz', done: false },
        ]
      },
    ];
    function showLessonModal(id) {
      const lesson = lessons.find(l => l.id === id);
      if (!lesson) return;
      let checklistHtml = lesson.checklist.map((item, idx) => `
        <li class="flex items-center gap-2 mb-2">
          <input type="checkbox" ${item.done ? 'checked' : ''} disabled class="form-checkbox h-5 w-5 text-blue-600 rounded" />
          <span class="${item.done ? 'line-through text-gray-400' : ''}">${item.text}</span>
        </li>
      `).join('');
      document.getElementById('lesson-modal-content').innerHTML = `
        <h2 class="text-xl font-bold text-blue-900 mb-2">${lesson.title}</h2>
        <div class="text-sm text-gray-600 mb-4">${lesson.description}</div>
        <div class="flex items-center gap-4 mb-4">
          <span class="bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full font-semibold">${lesson.status}</span>
          <span class="flex items-center gap-1 text-xs text-gray-600"><i class='fa fa-clock'></i> ${lesson.time}</span>
          <span class="flex items-center gap-1 text-xs text-gray-600"><i class='fa fa-clipboard-check'></i> Quiz: ${lesson.quiz}</span>
        </div>
        <div class="mb-4">
          <h3 class="font-bold text-blue-900 mb-2">Checklist</h3>
          <ul>${checklistHtml}</ul>
        </div>
        <button class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-green-700 transition text-sm">Mark as Complete</button>
      `;
      document.getElementById('lesson-modal').classList.remove('hidden');
    }
    function closeLessonModal() {
      document.getElementById('lesson-modal').classList.add('hidden');
    }

    // Certificates logic for student portal
    function getCertificates() {
      return JSON.parse(localStorage.getItem('discipleship_certificates') || '[]');
    }
    function getCurrentUser() {
      try {
        return JSON.parse(localStorage.getItem('discipleship_logged_in_user'));
      } catch (e) { return null; }
    }
    function renderCertificates() {
      const user = getCurrentUser();
      const certificates = getCertificates().filter(c => c.user === user.name || c.email === user.email);
      const list = document.getElementById('certificates-list');
      if (!list) return;
      list.innerHTML = '';
      if (!certificates.length) {
        list.innerHTML = '<div class="text-gray-500">No certificates yet. Complete a course to earn your first certificate!</div>';
        return;
      }
      certificates.forEach((cert, idx) => {
        const card = document.createElement('div');
        card.className = 'bg-gradient-to-br from-gold/10 to-purple/10 border border-gold rounded-xl p-6 shadow w-80 flex flex-col gap-2';
        card.innerHTML = `
          <div class="flex items-center gap-3 mb-2">
            <i class="fa fa-certificate text-gold text-2xl"></i>
            <div class="font-bold text-blue-900 text-lg">${cert.course}</div>
          </div>
          <div class="text-sm text-gray-700">Issued: <span class="font-semibold">${cert.date}</span></div>
          <div class="text-xs text-gray-500">Certificate ID: <span class="font-mono">${cert.id || ''}</span></div>
          <div class="text-xs text-gray-500">Status: <span class="font-semibold">${cert.status}</span></div>
          <button class="btn-gold px-4 py-2 rounded-lg font-semibold mt-2" onclick="previewCertificate(${idx})"><i class='fa fa-eye'></i> View / Download</button>
        `;
        list.appendChild(card);
      });
    }
    // Certificate preview modal logic (same as admin)
    window.previewCertificate = function(idx) {
      const user = getCurrentUser();
      const certificates = getCertificates().filter(c => c.user === user.name || c.email === user.email);
      const cert = certificates[idx];
      const certificatePreviewModal = document.getElementById('certificate-preview-modal');
      const certificatePreviewContent = document.getElementById('certificate-preview-content');
      const downloadCertificateBtn = document.getElementById('download-certificate-btn');
      const downloadCertificatePdfBtn = document.getElementById('download-certificate-pdf-btn');
      certificatePreviewModal.classList.remove('hidden');
      
      // Add fallback download function for user portal
      window.downloadCertificateSimple = function() {
        const certCanvas = document.getElementById('certificate-canvas');
        if (!certCanvas) {
          alert('Certificate not found. Please try again.');
          return;
        }
        
        // Create a simple text-based certificate as fallback
        const certificateText = `
CERTIFICATE OF COMPLETION

This certifies that ${cert.user} has successfully completed the course "${cert.course}" on ${cert.date}.

Certificate ID: ${cert.id}
Status: ${cert.status}
Signature: ${cert.signature || 'Rev. John Smith'}
Title: ${cert.title || 'Director'}

Â© 2025 Hearts After God Ministry
        `;
        
        const blob = new Blob([certificateText], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `certificate-${cert.user.replace(/\s+/g,'_')}-${cert.course.replace(/\s+/g,'_')}.txt`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        window.URL.revokeObjectURL(url);
      };
      // Generate QR code with verification URL
      const baseUrl = 'https://heartsaftergod.org/verify';
      const params = new URLSearchParams({
        user: cert.user,
        course: cert.course,
        date: cert.date,
        id: cert.id
      });
      const qrUrl = `${baseUrl}?${params.toString()}`;
      // Preload the logo image
      const logoImg = new Image();
      logoImg.crossOrigin = 'anonymous';
      logoImg.onload = function() {
        console.log('Logo image loaded successfully');
        // Generate QR code after logo is loaded
        setTimeout(() => {
          const qrElement = document.getElementById('certificate-qr');
          if (qrElement && typeof QRious !== 'undefined') {
            const qr = new QRious({
              element: qrElement,
              value: qrUrl,
              size: 60,
              background: 'white',
              foreground: '#7C3AED',
              level: 'H',
            });
            console.log('QR code generated successfully');
          } else {
            console.error('QR code element or library not found');
          }
        }, 100);
      };
      logoImg.onerror = function() {
        console.log('Logo image failed to load, using fallback');
        // Show fallback logo
        const logoElement = document.getElementById('certificate-logo');
        const fallbackElement = document.getElementById('logo-fallback');
        if (logoElement && fallbackElement) {
          logoElement.style.display = 'none';
          fallbackElement.style.display = 'flex';
        }
        // Generate QR code anyway
        setTimeout(() => {
          const qrElement = document.getElementById('certificate-qr');
          if (qrElement && typeof QRious !== 'undefined') {
            const qr = new QRious({
              element: qrElement,
              value: qrUrl,
              size: 60,
              background: 'white',
              foreground: '#7C3AED',
              level: 'H',
            });
            console.log('QR code generated successfully');
          } else {
            console.error('QR code element or library not found');
          }
        }, 100);
      };
      logoImg.src = 'assets/images/WhatsApp Image 2025-07-04 at 17.27.34_37ced412.jpg';
      // Create a certificate with logo and QR code for better html2canvas compatibility
      certificatePreviewContent.innerHTML = `
        <div id="certificate-canvas" class="w-full max-w-lg bg-white border-4 border-gold rounded-lg p-8 flex flex-col items-center text-center" style="min-width:400px; min-height:500px; font-family: Arial, sans-serif;">
          <!-- Header with Logo -->
          <div class="w-full text-center mb-6">
            <div class="flex items-center justify-center mb-4">
              <img id="certificate-logo" src="assets/images/WhatsApp Image 2025-07-04 at 17.27.34_37ced412.jpg" alt="Logo" class="w-16 h-16 rounded-full border-2 border-gold mr-4" style="object-fit: cover; background: #F59E0B;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
              <div id="logo-fallback" class="w-16 h-16 rounded-full border-2 border-gold mr-4 bg-gold flex items-center justify-center text-white font-bold text-lg" style="display: none;">HAG</div>
              <div>
                <div class="text-2xl font-bold text-gold">Hearts After God Ministry</div>
                <div class="text-sm text-gray-600">Discipleship Program</div>
              </div>
            </div>
            <div class="text-3xl font-bold text-purple mb-4">Certificate of Completion</div>
          </div>
          
          <!-- Main Content -->
          <div class="flex-1 flex flex-col justify-center items-center text-center">
            <p class="text-lg mb-4">This certifies that</p>
            <div class="text-3xl font-bold text-purple mb-4">${cert.user}</div>
            <p class="text-lg mb-4">has successfully completed the course</p>
            <div class="text-2xl font-bold text-blue mb-4">${cert.course}</div>
            <p class="text-lg mb-4">on</p>
            <div class="text-xl font-bold mb-4">${cert.date}</div>
          </div>
          
          <!-- Footer with QR Code and Certificate ID -->
          <div class="w-full mt-8">
            <div class="flex justify-between items-end">
              <div class="text-center">
                <div class="text-lg font-bold text-purple mb-1">${cert.signature || 'Rev. John Smith'}</div>
                <div class="text-sm text-gray-600">${cert.title || 'Director'}</div>
              </div>
              <div class="text-center">
                <div class="text-xs text-gray-500 mb-2">Certificate ID:</div>
                <div class="text-xs font-mono text-gray-700 mb-2">${cert.id}</div>
                <canvas id="certificate-qr" style="width:60px;height:60px;border:1px solid #ddd;"></canvas>
              </div>
              <div class="text-center">
                <div class="text-xs text-gray-500 mb-2">Status:</div>
                <div class="text-xs font-bold text-green-600">${cert.status}</div>
                <div class="text-xs text-gray-500 mt-2">Verified</div>
              </div>
            </div>
            <div class="text-center mt-4">
              <div class="text-xs text-gray-500">&copy; 2025 Hearts After God Ministry</div>
            </div>
          </div>
        </div>
      `;
      // Download logic (same as admin)
      downloadCertificateBtn.onclick = function() {
        const certCanvas = document.getElementById('certificate-canvas');
        if (!certCanvas) {
          alert('Certificate canvas not found. Please try again.');
          return;
        }
        
        downloadCertificateBtn.disabled = true;
        document.getElementById('download-png-text').classList.add('opacity-50');
        document.getElementById('download-png-spinner').classList.remove('hidden');
        
        // Check if html2canvas is available
        if (typeof html2canvas === 'undefined') {
          alert('Download library not loaded. Please refresh the page and try again.');
          downloadCertificateBtn.disabled = false;
          document.getElementById('download-png-text').classList.remove('opacity-50');
          document.getElementById('download-png-spinner').classList.add('hidden');
          return;
        }
        
        html2canvas(certCanvas, {
          backgroundColor: '#ffffff',
          scale: 1,
          useCORS: true,
          allowTaint: true,
          logging: true,
          width: certCanvas.offsetWidth,
          height: certCanvas.offsetHeight,
          imageTimeout: 5000
        }).then(canvas => {
          try {
            const link = document.createElement('a');
            link.download = `certificate-${cert.user.replace(/\s+/g,'_')}-${cert.course.replace(/\s+/g,'_')}.png`;
            link.href = canvas.toDataURL('image/png', 0.9);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            downloadCertificateBtn.disabled = false;
            document.getElementById('download-png-text').classList.remove('opacity-50');
            document.getElementById('download-png-spinner').classList.add('hidden');
          } catch (error) {
            console.error('Download error:', error);
            alert('Download failed. Please try again.');
            downloadCertificateBtn.disabled = false;
            document.getElementById('download-png-text').classList.remove('opacity-50');
            document.getElementById('download-png-spinner').classList.add('hidden');
          }
        }).catch(error => {
          console.error('Canvas generation error:', error);
          alert('Failed to generate certificate image. Please try again.');
          downloadCertificateBtn.disabled = false;
          document.getElementById('download-png-text').classList.remove('opacity-50');
          document.getElementById('download-png-spinner').classList.add('hidden');
        });
      };
      downloadCertificatePdfBtn.onclick = function() {
        const certCanvas = document.getElementById('certificate-canvas');
        if (!certCanvas) {
          alert('Certificate canvas not found. Please try again.');
          return;
        }
        
        downloadCertificatePdfBtn.disabled = true;
        document.getElementById('download-pdf-text').classList.add('opacity-50');
        document.getElementById('download-pdf-spinner').classList.remove('hidden');
        
        // Check if required libraries are available
        if (typeof html2canvas === 'undefined') {
          alert('Download library not loaded. Please refresh the page and try again.');
          downloadCertificatePdfBtn.disabled = false;
          document.getElementById('download-pdf-text').classList.remove('opacity-50');
          document.getElementById('download-pdf-spinner').classList.add('hidden');
          return;
        }
        
        if (typeof window.jspdf === 'undefined') {
          alert('PDF library not loaded. Please refresh the page and try again.');
          downloadCertificatePdfBtn.disabled = false;
          document.getElementById('download-pdf-text').classList.remove('opacity-50');
          document.getElementById('download-pdf-spinner').classList.add('hidden');
          return;
        }
        
        html2canvas(certCanvas, {
          backgroundColor: '#ffffff',
          scale: 1,
          useCORS: true,
          allowTaint: true,
          logging: true,
          width: certCanvas.offsetWidth,
          height: certCanvas.offsetHeight,
          imageTimeout: 5000
        }).then(canvas => {
          try {
            const imgData = canvas.toDataURL('image/png', 0.9);
            const pdf = new window.jspdf.jsPDF({ orientation: 'landscape', unit: 'mm', format: 'a4' });
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const imgProps = pdf.getImageProperties(imgData);
            let pdfWidth = pageWidth - 20;
            let pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            if (pdfHeight > pageHeight - 20) {
              pdfHeight = pageHeight - 20;
              pdfWidth = (imgProps.width * pdfHeight) / imgProps.height;
            }
            const x = (pageWidth - pdfWidth) / 2;
            const y = (pageHeight - pdfHeight) / 2;
            pdf.addImage(imgData, 'PNG', x, y, pdfWidth, pdfHeight);
            pdf.save(`certificate-${cert.user.replace(/\s+/g,'_')}-${cert.course.replace(/\s+/g,'_')}.pdf`);
            
            downloadCertificatePdfBtn.disabled = false;
            document.getElementById('download-pdf-text').classList.remove('opacity-50');
            document.getElementById('download-pdf-spinner').classList.add('hidden');
          } catch (error) {
            console.error('PDF generation error:', error);
            alert('PDF generation failed. Please try again.');
            downloadCertificatePdfBtn.disabled = false;
            document.getElementById('download-pdf-text').classList.remove('opacity-50');
            document.getElementById('download-pdf-spinner').classList.add('hidden');
          }
        }).catch(error => {
          console.error('Canvas generation error:', error);
          alert('Failed to generate certificate image. Please try again.');
          downloadCertificatePdfBtn.disabled = false;
          document.getElementById('download-pdf-text').classList.remove('opacity-50');
          document.getElementById('download-pdf-spinner').classList.add('hidden');
        });
      };
    };
    function closeCertificatePreview() {
      document.getElementById('certificate-preview-modal').classList.add('hidden');
      document.getElementById('certificate-preview-content').innerHTML = '';
    }
    window.closeCertificatePreview = closeCertificatePreview;

    // =====================
    // User Announcements System
    // =====================
    (function() {
      let lastAnnouncementCount = 0;
      
      // Load announcements from localStorage (shared with admin)
      function loadAnnouncements() {
        return JSON.parse(localStorage.getItem('announcements') || '[]');
      }

      // Get priority color for user view
      function getPriorityColor(priority) {
        switch(priority) {
          case 'urgent': return 'bg-red-100 text-red-800 border-red-300';
          case 'high': return 'bg-orange-100 text-orange-800 border-orange-300';
          default: return 'bg-blue-100 text-blue-800 border-blue-300';
        }
      }

      // Render announcements for users
      function renderUserAnnouncements() {
        const announcements = loadAnnouncements();
        const container = document.getElementById('user-announcements-list');
        
        if (!container) return;
        
        if (announcements.length === 0) {
          container.innerHTML = `
            <div class="text-center py-8 text-gray-500">
              <i class="fa fa-bullhorn text-4xl mb-4 opacity-50"></i>
              <p class="text-lg">No announcements yet</p>
              <p class="text-sm">Check back soon for ministry updates!</p>
            </div>
          `;
          return;
        }
        
        // Filter only active announcements (not scheduled for future)
        const now = new Date();
        const activeAnnouncements = announcements.filter(announcement => {
          if (announcement.status === 'scheduled') return false;
          if (announcement.schedule && new Date(announcement.schedule) > now) return false;
          return true;
        });
        
        if (activeAnnouncements.length === 0) {
          container.innerHTML = `
            <div class="text-center py-8 text-gray-500">
              <i class="fa fa-clock text-4xl mb-4 opacity-50"></i>
              <p class="text-lg">No active announcements</p>
              <p class="text-sm">Check back later for new updates!</p>
            </div>
          `;
          return;
        }
        
        // Sort: pinned first, then by timestamp
        const sortedAnnouncements = activeAnnouncements
          .slice()
          .sort((a, b) => (b.pinned - a.pinned) || (b.timestamp - a.timestamp));
        
        container.innerHTML = sortedAnnouncements.map(announcement => {
          const priorityClass = getPriorityColor(announcement.priority || 'normal');
          
          return `
            <div class="border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow ${announcement.pinned ? 'bg-yellow-50 border-yellow-300' : 'bg-white'}">
              <div class="flex items-start justify-between mb-3">
                <div class="flex items-center gap-3">
                  <h3 class="text-xl font-bold text-blue-900">${announcement.title}</h3>
                  ${announcement.pinned ? '<span class="px-2 py-1 bg-yellow-200 text-yellow-800 rounded text-xs font-semibold">ðŸ“Œ Pinned</span>' : ''}
                  <span class="px-2 py-1 ${priorityClass} rounded text-xs font-semibold border">${announcement.priority || 'normal'}</span>
                </div>
                <div class="text-xs text-gray-500">
                  ${new Date(announcement.timestamp).toLocaleDateString()}
                </div>
              </div>
              
              <div class="text-gray-700 mb-4 leading-relaxed whitespace-pre-wrap">${announcement.message}</div>
              
              ${announcement.attachment ? `
                <div class="mb-3 p-3 bg-gray-50 rounded border">
                  <div class="flex items-center gap-2">
                    <i class="fa fa-paperclip text-gray-500"></i>
                    <a href="${announcement.attachment.data}" download="${announcement.attachment.name}" 
                       class="text-blue-600 hover:text-blue-800 font-medium">
                      ${announcement.attachment.name}
                    </a>
                    <span class="text-xs text-gray-500">(Click to download)</span>
                  </div>
                </div>
              ` : ''}
              
              <div class="flex items-center justify-between text-xs text-gray-500">
                <span>From: Hearts After God Ministry</span>
                <span>${new Date(announcement.timestamp).toLocaleTimeString()}</span>
              </div>
            </div>
          `;
        }).join('');
      }

      // Show notification for new announcements
      function showAnnouncementNotification(announcement) {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 bg-white border-l-4 border-gold shadow-lg rounded-lg p-4 max-w-sm z-50 transform transition-all duration-300 translate-x-full';
        notification.innerHTML = `
          <div class="flex items-start gap-3">
            <div class="flex-shrink-0">
              <i class="fa fa-bullhorn text-gold text-xl"></i>
            </div>
            <div class="flex-1">
              <h4 class="font-semibold text-blue-900 mb-1">${announcement.title}</h4>
              <p class="text-sm text-gray-600 mb-2">${announcement.message.substring(0, 100)}${announcement.message.length > 100 ? '...' : ''}</p>
              <div class="flex items-center justify-between">
                <span class="text-xs text-gray-500">New announcement</span>
                <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-400 hover:text-red-500">
                  <i class="fa fa-times"></i>
                </button>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
          notification.classList.remove('translate-x-full');
        }, 100);
        
        // Auto remove after 8 seconds
        setTimeout(() => {
          notification.classList.add('translate-x-full');
          setTimeout(() => notification.remove(), 300);
        }, 8000);
      }

      // Check for new announcements
      function checkForNewAnnouncements() {
        const announcements = loadAnnouncements();
        const now = new Date();
        const activeAnnouncements = announcements.filter(announcement => {
          if (announcement.status === 'scheduled') return false;
          if (announcement.schedule && new Date(announcement.schedule) > now) return false;
          return true;
        });
        
        if (activeAnnouncements.length > lastAnnouncementCount && lastAnnouncementCount > 0) {
          // New announcements found
          const newAnnouncements = activeAnnouncements.slice(0, activeAnnouncements.length - lastAnnouncementCount);
          newAnnouncements.forEach(announcement => {
            showAnnouncementNotification(announcement);
          });
        }
        
        lastAnnouncementCount = activeAnnouncements.length;
      }

      // Listen for storage changes (real-time sync)
      window.addEventListener('storage', function(e) {
        if (e.key === 'announcements') {
          renderUserAnnouncements();
          checkForNewAnnouncements();
        }
      });

      // Initialize when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Initial render
        renderUserAnnouncements();
        checkForNewAnnouncements();
        
        // Check for new announcements every 30 seconds
        setInterval(() => {
          renderUserAnnouncements();
          checkForNewAnnouncements();
        }, 30000);
      });
    })();
    // =====================
    // End User Announcements System
    // =====================

    // =====================
    // User Support Ticket System
    // =====================
    (function() {
      // Load support tickets from localStorage
      function loadSupportTickets() {
        return JSON.parse(localStorage.getItem('support_tickets') || '[]');
      }

      // Save support tickets to localStorage
      function saveSupportTickets(tickets) {
        localStorage.setItem('support_tickets', JSON.stringify(tickets));
      }

      // Get current user
      function getCurrentUser() {
        try {
          return JSON.parse(localStorage.getItem('discipleship_logged_in_user'));
        } catch (e) { return null; }
      }

      // Get priority color
      function getPriorityColor(priority) {
        switch(priority) {
          case 'Urgent': return 'bg-red-100 text-red-800 border-red-300';
          case 'High': return 'bg-orange-100 text-orange-800 border-orange-300';
          case 'Medium': return 'bg-yellow-100 text-yellow-800 border-yellow-300';
          default: return 'bg-green-100 text-green-800 border-green-300';
        }
      }

      // Get status color
      function getStatusColor(status) {
        switch(status) {
          case 'Open': return 'bg-red-100 text-red-800 border-red-300';
          case 'In Progress': return 'bg-yellow-100 text-yellow-800 border-yellow-300';
          case 'Resolved': return 'bg-green-100 text-green-800 border-green-300';
          default: return 'bg-gray-100 text-gray-800 border-gray-300';
        }
      }

      // Render user tickets
      function renderUserTickets() {
        const user = getCurrentUser();
        if (!user) return;

        const tickets = loadSupportTickets().filter(ticket => 
          ticket.user === user.name || ticket.email === user.email
        );
        
        const container = document.getElementById('user-tickets-list');
        if (!container) return;

        if (tickets.length === 0) {
          container.innerHTML = `
            <div class="text-center py-8 text-gray-500">
              <i class="fa fa-ticket text-4xl mb-4 opacity-50"></i>
              <p class="text-lg">No support tickets yet</p>
              <p class="text-sm">Create your first ticket to get help!</p>
            </div>
          `;
          return;
        }

        // Sort by timestamp (newest first)
        tickets.sort((a, b) => b.timestamp - a.timestamp);

        container.innerHTML = tickets.map(ticket => {
          const priorityClass = getPriorityColor(ticket.priority || 'Low');
          const statusClass = getStatusColor(ticket.status || 'Open');
          
          return `
            <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow">
              <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                  <h4 class="text-lg font-semibold text-blue-900 mb-1">${ticket.subject || 'No subject'}</h4>
                  <p class="text-gray-600 mb-2">${(ticket.description || '').substring(0, 150)}${(ticket.description || '').length > 150 ? '...' : ''}</p>
                </div>
                <div class="flex gap-2 ml-4">
                  <span class="px-2 py-1 rounded text-xs border ${priorityClass}">${ticket.priority || 'Low'}</span>
                  <span class="px-2 py-1 rounded text-xs border ${statusClass}">${ticket.status || 'Open'}</span>
                </div>
              </div>
              
              <div class="flex items-center justify-between text-sm text-gray-500 mb-3">
                <span>Created: ${new Date(ticket.timestamp).toLocaleDateString()}</span>
                <span>${new Date(ticket.timestamp).toLocaleTimeString()}</span>
              </div>

              ${ticket.replies && ticket.replies.length > 0 ? `
                <div class="bg-gray-50 p-3 rounded mb-3">
                  <div class="text-sm text-gray-600 mb-1">
                    <strong>Latest Reply:</strong> ${new Date(ticket.replies[ticket.replies.length - 1].timestamp).toLocaleString()}
                  </div>
                  <div class="text-gray-800">${ticket.replies[ticket.replies.length - 1].message}</div>
                </div>
              ` : ''}

              <button onclick="viewTicketDetails('${ticket.id}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                <i class="fa fa-eye mr-1"></i>View Details
              </button>
            </div>
          `;
        }).join('');
      }

      // Show support tickets section
      window.showSupportTickets = function() {
        document.getElementById('support-tickets-section').classList.remove('hidden');
        document.getElementById('faqs-section').classList.add('hidden');
        document.getElementById('resources-section').classList.add('hidden');
        renderUserTickets();
      };

      // Show FAQs section
      window.showFAQs = function() {
        document.getElementById('faqs-section').classList.remove('hidden');
        document.getElementById('support-tickets-section').classList.add('hidden');
        document.getElementById('resources-section').classList.add('hidden');
      };

      // Show resources section
      window.showResources = function() {
        document.getElementById('resources-section').classList.remove('hidden');
        document.getElementById('support-tickets-section').classList.add('hidden');
        document.getElementById('faqs-section').classList.add('hidden');
      };

      // View ticket details
      window.viewTicketDetails = function(ticketId) {
        const tickets = loadSupportTickets();
        const ticket = tickets.find(t => t.id === ticketId);
        if (!ticket) return;

        const modal = document.getElementById('ticket-detail-modal');
        const content = document.getElementById('ticket-detail-content');
        
        content.innerHTML = `
          <div class="space-y-4">
            <div class="bg-gray-50 p-4 rounded">
              <div class="grid md:grid-cols-2 gap-4 text-sm mb-3">
                <div><strong>Subject:</strong> ${ticket.subject || 'No subject'}</div>
                <div><strong>Priority:</strong> <span class="px-2 py-1 rounded text-xs ${getPriorityColor(ticket.priority || 'Low')}">${ticket.priority || 'Low'}</span></div>
                <div><strong>Status:</strong> <span class="px-2 py-1 rounded text-xs ${getStatusColor(ticket.status || 'Open')}">${ticket.status || 'Open'}</span></div>
                <div><strong>Created:</strong> ${new Date(ticket.timestamp).toLocaleString()}</div>
              </div>
              <div>
                <strong>Description:</strong>
                <div class="mt-1 p-2 bg-white rounded border">${ticket.description || 'No description'}</div>
              </div>
            </div>

            ${ticket.replies && ticket.replies.length > 0 ? `
              <div>
                <h4 class="font-semibold text-blue-900 mb-2">Admin Replies</h4>
                ${ticket.replies.map(reply => `
                  <div class="bg-blue-50 p-3 rounded mb-2">
                    <div class="text-sm text-gray-600 mb-1">
                      <strong>Admin Reply</strong> - ${new Date(reply.timestamp).toLocaleString()}
                    </div>
                    <div class="text-gray-800">${reply.message}</div>
                  </div>
                `).join('')}
              </div>
            ` : '<p class="text-gray-500 text-sm">No replies yet</p>'}
          </div>
        `;
        
        modal.classList.remove('hidden');
      };

      // Initialize when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        // New ticket button
        const newTicketBtn = document.getElementById('new-ticket-btn');
        if (newTicketBtn) {
          newTicketBtn.onclick = function() {
            document.getElementById('new-ticket-form').classList.remove('hidden');
          };
        }

        // Cancel ticket button
        const cancelTicketBtn = document.getElementById('cancel-ticket-btn');
        if (cancelTicketBtn) {
          cancelTicketBtn.onclick = function() {
            document.getElementById('new-ticket-form').classList.add('hidden');
            document.getElementById('support-ticket-form').reset();
          };
        }

        // Close ticket modal
        const closeTicketModal = document.getElementById('close-ticket-modal');
        if (closeTicketModal) {
          closeTicketModal.onclick = function() {
            document.getElementById('ticket-detail-modal').classList.add('hidden');
          };
        }

        // Support ticket form submission
        const ticketForm = document.getElementById('support-ticket-form');
        if (ticketForm) {
          ticketForm.onsubmit = function(e) {
            e.preventDefault();
            
            const user = getCurrentUser();
            if (!user) {
              alert('Please log in to create a support ticket');
              return;
            }

            const subject = document.getElementById('ticket-subject').value.trim();
            const priority = document.getElementById('ticket-priority').value;
            const description = document.getElementById('ticket-description').value.trim();

            if (!subject || !description) {
              alert('Please fill in all required fields');
              return;
            }

            const newTicket = {
              id: 'ticket_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
              user: user.name,
              email: user.email,
              subject: subject,
              description: description,
              priority: priority,
              status: 'Open',
              timestamp: Date.now(),
              replies: []
            };

            const tickets = loadSupportTickets();
            tickets.unshift(newTicket);
            saveSupportTickets(tickets);

            // Reset form and hide
            ticketForm.reset();
            document.getElementById('new-ticket-form').classList.add('hidden');
            
            // Refresh tickets list
            renderUserTickets();
            
            alert('Support ticket created successfully! We will respond soon.');
          };
        }

        // Listen for storage changes (real-time updates)
        window.addEventListener('storage', function(e) {
          if (e.key === 'support_tickets') {
            renderUserTickets();
          }
        });
      });
    })();
    // =====================
    // End User Support Ticket System
    // =====================

    // Community logic for users (no admin controls)
    (function() {
      function getCurrentUser() {
        return JSON.parse(localStorage.getItem('discipleship_logged_in_user'));
      }
      function getAllUsers() {
        return JSON.parse(localStorage.getItem('discipleship_users') || '[]');
      }
      function getUserStatus(user) {
        if (user.banned) return 'Banned';
        if (user.muted) return 'Muted';
        return 'Active';
      }
      // Announcements
      const annKey = 'community_announcements';
      function getAnns() { return JSON.parse(localStorage.getItem(annKey)||'[]'); }
      // Chat
      const chatKey = 'community_chat_messages';
      function getChat() { return JSON.parse(localStorage.getItem(chatKey)||'[]'); }
      function setChat(msgs) { localStorage.setItem(chatKey, JSON.stringify(msgs)); }
      // Leaderboard
      function renderLeaderboard() {
        const users = getAllUsers();
        const progress = JSON.parse(localStorage.getItem('discipleship_progress')||'{}');
        const avatars = ['ðŸ§‘â€ðŸ¦±','ðŸ§‘ðŸ¾','ðŸ‘©â€ðŸ¦°','ðŸ§‘','ðŸ‘¨â€ðŸ¦³','ðŸ‘©ï¿½ï¿½','ðŸ§‘ðŸ»','ðŸ‘©â€ðŸ¦³'];
        const tbody = document.getElementById('community-leaderboard');
        if (!tbody) return;
        tbody.innerHTML = users.map((u,i)=>{
          const p = Object.values(progress).find(pr=>pr && pr.completedLessons && pr.userId ? pr.userId===u.id : u.email===getCurrentUser().email);
          const lessons = p && p.completedLessons ? p.completedLessons.length : 0;
          const badges = p && p.certificates ? p.certificates.length : 0;
          const status = getUserStatus(u);
          return `<tr${u.banned?" class='bg-red-50'":""}><td class='py-1 px-3 text-2xl'>${u.avatar||avatars[i%avatars.length]}</td><td class='py-1 px-3'>${u.name}</td><td class='py-1 px-3'>${lessons}</td><td class='py-1 px-3'>${badges}</td><td class='py-1 px-3'>${status}</td></tr>`;
        }).join('');
      }
      // Announcements
      function renderAnnouncements() {
        const anns = getAnns();
        const annList = document.getElementById('community-announcements');
        if (!annList) return;
        annList.innerHTML = anns.map((a) => `<li>${a.text} ${a.pinned?'<span class=\"text-gold font-bold ml-2\">[Pinned]</span>':''}</li>`).join('');
      }
      // Chat
      function renderChat() {
        const msgs = getChat();
        const user = getCurrentUser();
        const users = getAllUsers();
        const box = document.getElementById('community-chat-messages');
        if (!box) return;
        box.innerHTML = msgs.map((m) => {
          const u = users.find(u=>u.email===m.email);
          const status = u ? getUserStatus(u) : 'Active';
          return `<div class='flex gap-2 items-center${status==='Muted'?' opacity-50 pointer-events-none':''}${status==='Banned'?' hidden':''}'>
            <span class='font-bold text-blue-900'>${m.name}:</span>
            <span>${m.text}</span>
          </div>`;
        }).join('');
        box.scrollTop = box.scrollHeight;
      }
      document.addEventListener('DOMContentLoaded', function() {
        renderLeaderboard();
        renderAnnouncements();
        renderChat();
        const chatForm = document.getElementById('community-chat-form');
        if (chatForm) {
          chatForm.onsubmit = function(e) {
            e.preventDefault();
            const user = getCurrentUser();
            if (!user) return false;
            const users = getAllUsers();
            const thisUser = users.find(u=>u.email===user.email);
            if (thisUser && (thisUser.muted || thisUser.banned)) return false;
            const input = document.getElementById('community-chat-input');
            const val = input.value.trim();
            if (val) {
              const msgs = getChat();
              msgs.push({ name: user.name, email: user.email, text: val });
              setChat(msgs);
              renderChat();
              input.value = '';
            }
          };
        }
      });
    })();

    // Authentication check
    document.addEventListener('DOMContentLoaded', function() {
      // Check if user is logged in
      const loggedInUser = localStorage.getItem('discipleship_logged_in_user');
      
      if (!loggedInUser) {
        console.log('No user logged in, redirecting to login');
        window.location.href = 'user-dashboard.html';
        return;
      }
      
      const user = JSON.parse(loggedInUser);
      console.log('Logged in user:', user);
      
      // Update user info in header
      const userNameElement = document.getElementById('nav-user-name');
      const userAvatarElement = document.getElementById('nav-user-avatar');
      
      if (userNameElement) {
        userNameElement.textContent = user.name;
      }
      
      if (userAvatarElement) {
        userAvatarElement.textContent = user.name.charAt(0).toUpperCase();
      }
      
      // Logout functionality
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          if (confirm('Are you sure you want to logout?')) {
            localStorage.removeItem('discipleship_logged_in_user');
            window.location.href = 'user-dashboard.html';
          }
        });
      }
    });

    // Animated underline logic
    const navLinks = document.querySelectorAll('#nav-links .nav-link');
    const navUnderline = document.getElementById('nav-underline');
    function moveUnderline(el) {
      if (!el) return;
      const rect = el.getBoundingClientRect();
      const parentRect = el.parentElement.parentElement.getBoundingClientRect();
      navUnderline.style.width = rect.width + 'px';
      navUnderline.style.left = (rect.left - parentRect.left) + 'px';
    }
    navLinks.forEach(link => {
      link.addEventListener('mouseenter', e => moveUnderline(e.target));
      link.addEventListener('focus', e => moveUnderline(e.target));
      link.addEventListener('mouseleave', () => {
        const active = document.querySelector('#nav-links .nav-link.active');
        moveUnderline(active);
      });
    });
    window.addEventListener('DOMContentLoaded', () => {
      const active = document.querySelector('#nav-links .nav-link.active');
      moveUnderline(active);
    });

    // --- 14-Day Curriculum Data ---
    const curriculum = [
      { day: 1, topic: 'Foundations of Faith', content: 'Understanding salvation, grace, and your new identity in Christ.' },
      { day: 2, topic: 'Prayer & Devotion', content: 'Building a daily habit of prayer, worship, and Bible study.' },
      { day: 3, topic: 'Community & Fellowship', content: 'The importance of spiritual family and accountability.' },
      { day: 4, topic: 'Spiritual Gifts & Calling', content: 'Discovering your spiritual gifts and God\'s purpose for your life.' },
      { day: 5, topic: 'Hearing God\'s Voice', content: 'How to discern God\'s guidance and direction.' },
      { day: 6, topic: 'Obedience & Holiness', content: 'Living a life set apart for God.' },
      { day: 7, topic: 'Evangelism & Witnessing', content: 'Sharing your faith with others.' },
      { day: 8, topic: 'Overcoming Temptation', content: 'Strategies for spiritual victory.' },
      { day: 9, topic: 'Forgiveness & Reconciliation', content: 'Healing relationships and letting go.' },
      { day: 10, topic: 'Serving Others', content: 'Living out your faith through service.' },
      { day: 11, topic: 'Faith & Trust', content: 'Growing in confidence in God.' },
      { day: 12, topic: 'Spiritual Warfare', content: 'Understanding and overcoming spiritual battles.' },
      { day: 13, topic: 'Fruit of the Spirit', content: 'Cultivating Christlike character.' },
      { day: 14, topic: 'Living on Mission', content: 'Embracing your calling and next steps.' },
    ];
    // --- Progress Tracking ---
    function getCurriculumProgress() {
      return JSON.parse(localStorage.getItem('curriculum_progress') || '[]');
    }
    function setCurriculumProgress(progress) {
      localStorage.setItem('curriculum_progress', JSON.stringify(progress));
    }
    function renderCurriculumTable() {
      const tbody = document.getElementById('curriculum-table-body');
      if (!tbody) return;
      let progress = getCurriculumProgress();
      if (!Array.isArray(progress) || progress.length !== curriculum.length) {
        progress = Array(curriculum.length).fill('locked');
        progress[0] = 'in_progress'; // Unlock Day 1 by default
        setCurriculumProgress(progress);
      }
      tbody.innerHTML = '';
      curriculum.forEach((item, idx) => {
        const status = progress[idx];
        let statusLabel = '';
        let actionBtn = '';
        if (status === 'complete') {
          statusLabel = '<span class="inline-block bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold">Complete</span>';
          actionBtn = `<button class='px-4 py-2 bg-gray-300 text-gray-500 rounded-lg font-bold cursor-not-allowed' disabled>Done</button>`;
        } else if (status === 'in_progress') {
          statusLabel = '<span class="inline-block bg-blue-500 text-white px-3 py-1 rounded-full text-xs font-bold">In Progress</span>';
          actionBtn = `<button class='px-4 py-2 bg-[#7C3AED] text-white rounded-lg font-bold hover:bg-[#FDBA17] hover:text-[#2046B3] transition' onclick='openCurriculumModal(${idx})'>View & Complete</button>`;
        } else {
          statusLabel = '<span class="inline-block bg-gray-300 text-gray-600 px-3 py-1 rounded-full text-xs font-bold">Locked</span>';
          actionBtn = `<button class='px-4 py-2 bg-gray-200 text-gray-400 rounded-lg font-bold cursor-not-allowed' disabled>Locked</button>`;
        }
        tbody.innerHTML += `
          <tr>
            <td class='p-3 font-bold text-[#7C3AED]'>Day ${item.day}</td>
            <td class='p-3 text-[#2046B3]'>${item.topic}</td>
            <td class='p-3'>${statusLabel}</td>
            <td class='p-3'>${actionBtn}</td>
          </tr>
        `;
      });
    }
    // --- Modal for Curriculum Content ---
    function openCurriculumModal(idx) {
      const item = curriculum[idx];
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
      modal.innerHTML = `
        <div class='bg-white rounded-2xl shadow-2xl max-w-lg w-full p-8 relative'>
          <button class='absolute top-4 right-4 text-2xl text-[#7C3AED] hover:text-[#FDBA17] focus:outline-none' onclick='this.closest(`.fixed`).remove()' aria-label='Close'>&times;</button>
          <h3 class='text-xl font-bold text-[#7C3AED] mb-2'>Day ${item.day}: ${item.topic}</h3>
          <p class='text-gray-700 mb-6'>${item.content}</p>
          <button class='px-6 py-2 bg-[#FDBA17] text-[#2046B3] font-bold rounded-lg shadow hover:bg-[#7C3AED] hover:text-white transition' onclick='completeCurriculumDay(${idx}); this.closest(`.fixed`).remove()'>Mark as Complete</button>
        </div>
      `;
      document.body.appendChild(modal);
    }
    function completeCurriculumDay(idx) {
      let progress = getCurriculumProgress();
      progress[idx] = 'complete';
      if (idx + 1 < progress.length && progress[idx + 1] === 'locked') {
        progress[idx + 1] = 'in_progress';
      }
      setCurriculumProgress(progress);
      renderCurriculumTable();
    }
    document.addEventListener('DOMContentLoaded', renderCurriculumTable);
  </script>
</body>
</html> 