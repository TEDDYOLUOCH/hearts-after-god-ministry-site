<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Admin User - Hearts After God Ministry</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold text-center mb-6">Create Admin User</h1>
        
        <div id="status" class="mb-4 p-3 rounded-lg bg-blue-50">
            <p class="text-center text-blue-800">Loading backend...</p>
        </div>

        <div class="space-y-4">
            <button onclick="createAdminUser()" 
                    class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">
                Create Admin User
            </button>

            <button onclick="testAdminLogin()" 
                    class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700">
                Test Admin Login
            </button>

            <button onclick="clearAllData()" 
                    class="w-full bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700">
                Clear All Data (Reset)
            </button>

            <div class="p-3 bg-yellow-50 rounded-lg">
                <h3 class="font-semibold text-yellow-900">Admin Credentials:</h3>
                <p class="text-sm text-yellow-800">
                    Email: <strong>admin@heartsaftergod.org</strong><br>
                    Password: <strong>admin123</strong>
                </p>
            </div>

            <a href="discipleship-admin.html" 
               class="block w-full bg-purple-600 text-white text-center py-3 rounded-lg font-semibold hover:bg-purple-700">
                Go to Admin Dashboard
            </a>
        </div>

        <div id="console-output" class="mt-4 p-3 bg-gray-100 rounded-lg">
            <h3 class="font-semibold mb-2">Console Output:</h3>
            <div id="output" class="text-sm text-gray-700 max-h-40 overflow-y-auto"></div>
        </div>
    </div>

    <script src="assets/js/discipleship-backend.js"></script>
    <script>
        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            const colors = {
                info: 'bg-blue-50 text-blue-800',
                success: 'bg-green-50 text-green-800',
                error: 'bg-red-50 text-red-800',
                warning: 'bg-yellow-50 text-yellow-800'
            };
            status.className = `mb-4 p-3 rounded-lg ${colors[type]}`;
            status.innerHTML = `<p class="text-center">${message}</p>`;
        }

        function createAdminUser() {
            log('Creating admin user...');
            
            if (!window.DiscipleshipBackend) {
                log('❌ Backend not available');
                updateStatus('Backend not available', 'error');
                return;
            }

            try {
                // Clear existing admin user if exists
                const existingUsers = window.DiscipleshipBackend.getAllUsers();
                const existingAdmin = existingUsers.find(u => u.email === 'admin@heartsaftergod.org');
                
                if (existingAdmin) {
                    log(`Found existing admin user: ${existingAdmin.name}`);
                    delete window.DiscipleshipBackend.users[existingAdmin.id];
                }

                // Create new admin user
                const adminUser = window.DiscipleshipBackend.createAdminUser();
                log(`✅ Admin user created: ${adminUser.name} (${adminUser.email})`);
                
                // Verify creation
                const users = window.DiscipleshipBackend.getAllUsers();
                const newAdmin = users.find(u => u.email === 'admin@heartsaftergod.org');
                
                if (newAdmin) {
                    log(`✅ Admin user verified in database`);
                    log(`Admin ID: ${newAdmin.id}`);
                    log(`Admin Role: ${newAdmin.role}`);
                    updateStatus('Admin user created successfully!', 'success');
                } else {
                    log('❌ Admin user not found after creation');
                    updateStatus('Failed to create admin user', 'error');
                }

            } catch (error) {
                log(`❌ Error creating admin user: ${error.message}`);
                updateStatus('Error creating admin user', 'error');
            }
        }

        function testAdminLogin() {
            log('Testing admin login...');
            
            if (!window.DiscipleshipBackend) {
                log('❌ Backend not available');
                updateStatus('Backend not available', 'error');
                return;
            }

            try {
                const email = 'admin@heartsaftergod.org';
                const password = 'admin123';
                
                log(`Attempting login with: ${email}`);
                
                const user = window.DiscipleshipBackend.authenticateUser(email, password);
                
                if (user) {
                    log(`✅ Login successful!`);
                    log(`User: ${user.name}`);
                    log(`Role: ${user.role}`);
                    log(`ID: ${user.id}`);
                    updateStatus('Admin login test successful!', 'success');
                } else {
                    log('❌ Login failed');
                    
                    // Check if admin user exists
                    const users = window.DiscipleshipBackend.getAllUsers();
                    const adminUser = users.find(u => u.email === email);
                    
                    if (adminUser) {
                        log(`Admin user exists but login failed`);
                        log(`Admin user data:`, adminUser);
                    } else {
                        log(`Admin user not found`);
                    }
                    
                    updateStatus('Admin login test failed', 'error');
                }

            } catch (error) {
                log(`❌ Error testing login: ${error.message}`);
                updateStatus('Error testing login', 'error');
            }
        }

        function clearAllData() {
            log('Clearing all data...');
            
            if (confirm('Are you sure you want to clear all data? This will reset everything.')) {
                try {
                    localStorage.clear();
                    log('✅ All localStorage data cleared');
                    updateStatus('All data cleared. Please refresh the page.', 'warning');
                    
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } catch (error) {
                    log(`❌ Error clearing data: ${error.message}`);
                    updateStatus('Error clearing data', 'error');
                }
            }
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            log('Page loaded');
            
            if (window.DiscipleshipBackend) {
                log('✅ Backend loaded successfully');
                updateStatus('Backend loaded successfully', 'success');
                
                // Check if admin user exists
                const users = window.DiscipleshipBackend.getAllUsers();
                const adminUser = users.find(u => u.email === 'admin@heartsaftergod.org');
                
                if (adminUser) {
                    log(`✅ Admin user found: ${adminUser.name}`);
                    updateStatus('Admin user exists', 'success');
                } else {
                    log('⚠️ Admin user not found');
                    updateStatus('Admin user not found. Click "Create Admin User" to create one.', 'warning');
                }
            } else {
                log('❌ Backend not loaded');
                updateStatus('Backend not loaded', 'error');
            }
        });
    </script>
</body>
</html> 